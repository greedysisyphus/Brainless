<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¡ƒåœ’æ©Ÿå ´ D11-D18 ç™»æ©Ÿé–€èˆªç­è³‡è¨Š</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }

    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .last-updated {
      opacity: 0.9;
      font-size: 0.9em;
    }

    .gate-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-bottom: 30px;
    }

    .gate-btn {
      padding: 10px 20px;
      background: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      font-weight: 600;
      transition: all 0.3s;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .gate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }

    .gate-btn.active {
      background: #4CAF50;
      color: white;
    }

    .gate-btn.all {
      background: #2196F3;
      color: white;
    }

    .loading {
      text-align: center;
      color: white;
      font-size: 1.2em;
      padding: 40px;
    }

    .error {
      background: #f44336;
      color: white;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      text-align: center;
    }

    .flight-section {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .section-title {
      font-size: 1.5em;
      margin-bottom: 15px;
      color: #333;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }

    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .summary-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }

    .summary-card h3 {
      font-size: 0.9em;
      opacity: 0.9;
      margin-bottom: 10px;
    }

    .summary-card .number {
      font-size: 2em;
      font-weight: bold;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    th {
      background: #f5f5f5;
      padding: 12px;
      text-align: left;
      font-weight: 600;
      color: #333;
      border-bottom: 2px solid #ddd;
    }

    td {
      padding: 12px;
      border-bottom: 1px solid #eee;
    }

    tr:hover {
      background: #f9f9f9;
    }

    .status {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.85em;
      font-weight: 600;
    }

    .status-ontime {
      background: #4CAF50;
      color: white;
    }

    .status-departed {
      background: #2196F3;
      color: white;
    }

    .status-arrived {
      background: #FF9800;
      color: white;
    }

    .flight-code {
      font-weight: 600;
      color: #667eea;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 1.8em;
      }

      table {
        font-size: 0.9em;
      }

      th, td {
        padding: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>âœˆï¸ æ¡ƒåœ’æ©Ÿå ´ D11-D18 ç™»æ©Ÿé–€èˆªç­è³‡è¨Š</h1>
      <div class="last-updated" id="lastUpdated">è¼‰å…¥ä¸­...</div>
    </header>

    <div class="gate-selector">
      <button class="gate-btn all" onclick="loadAllGates()">å…¨éƒ¨ç™»æ©Ÿé–€</button>
      <button class="gate-btn" onclick="loadGate('D11')">D11</button>
      <button class="gate-btn" onclick="loadGate('D12')">D12</button>
      <button class="gate-btn" onclick="loadGate('D13')">D13</button>
      <button class="gate-btn" onclick="loadGate('D14')">D14</button>
      <button class="gate-btn" onclick="loadGate('D15')">D15</button>
      <button class="gate-btn" onclick="loadGate('D16')">D16</button>
      <button class="gate-btn" onclick="loadGate('D17')">D17</button>
      <button class="gate-btn" onclick="loadGate('D18')">D18</button>
    </div>

    <div id="content">
      <div class="loading">è¼‰å…¥ä¸­...</div>
    </div>
  </div>

  <script src="flight-data-reader.js"></script>
  <script>
    const reader = new FlightDataReader('./data');
    let currentGate = null;

    // è¼‰å…¥æŒ‡å®šç™»æ©Ÿé–€
    async function loadGate(gate) {
      currentGate = gate;
      updateActiveButton(gate);
      
      const content = document.getElementById('content');
      content.innerHTML = '<div class="loading">è¼‰å…¥ä¸­...</div>';

      try {
        const data = await reader.getGateData(gate);
        displayGateData(data);
        updateLastUpdated(data.timestamp);
      } catch (error) {
        content.innerHTML = `<div class="error">âŒ è¼‰å…¥å¤±æ•—: ${error.message}</div>`;
      }
    }

    // è¼‰å…¥æ‰€æœ‰ç™»æ©Ÿé–€
    async function loadAllGates() {
      currentGate = 'all';
      updateActiveButton('all');
      
      const content = document.getElementById('content');
      content.innerHTML = '<div class="loading">è¼‰å…¥ä¸­...</div>';

      try {
        const allData = await reader.getAllGatesData();
        displayAllGatesData(allData);
        
        // æ›´æ–°æœ€å¾Œæ›´æ–°æ™‚é–“
        if (allData.length > 0 && allData[0].timestamp) {
          updateLastUpdated(allData[0].timestamp);
        }
      } catch (error) {
        content.innerHTML = `<div class="error">âŒ è¼‰å…¥å¤±æ•—: ${error.message}</div>`;
      }
    }

    // é¡¯ç¤ºå–®å€‹ç™»æ©Ÿé–€çš„è³‡æ–™
    function displayGateData(data) {
      const content = document.getElementById('content');
      
      let html = `
        <div class="summary">
          <div class="summary-card">
            <h3>å‡ºç™¼èˆªç­</h3>
            <div class="number">${data.summary.departure_count}</div>
          </div>
          <div class="summary-card">
            <h3>æŠµé”èˆªç­</h3>
            <div class="number">${data.summary.arrival_count}</div>
          </div>
          <div class="summary-card">
            <h3>ç¸½è¨ˆ</h3>
            <div class="number">${data.summary.total_count}</div>
          </div>
        </div>
      `;

      // å‡ºç™¼èˆªç­è¡¨æ ¼
      if (data.departure.data.length > 0) {
        html += `
          <div class="flight-section">
            <h2 class="section-title">ğŸ›« å‡ºç™¼èˆªç­</h2>
            ${createTable(data.departure)}
          </div>
        `;
      }

      // æŠµé”èˆªç­è¡¨æ ¼
      if (data.arrival.data.length > 0) {
        html += `
          <div class="flight-section">
            <h2 class="section-title">ğŸ›¬ æŠµé”èˆªç­</h2>
            ${createTable(data.arrival)}
          </div>
        `;
      }

      content.innerHTML = html;
    }

    // é¡¯ç¤ºæ‰€æœ‰ç™»æ©Ÿé–€çš„è³‡æ–™
    function displayAllGatesData(allData) {
      const content = document.getElementById('content');
      
      // è¨ˆç®—ç¸½è¨ˆ
      const totalDepartures = allData.reduce((sum, d) => sum + (d.summary?.departure_count || 0), 0);
      const totalArrivals = allData.reduce((sum, d) => sum + (d.summary?.arrival_count || 0), 0);
      
      let html = `
        <div class="summary">
          <div class="summary-card">
            <h3>ç™»æ©Ÿé–€æ•¸é‡</h3>
            <div class="number">${allData.length}</div>
          </div>
          <div class="summary-card">
            <h3>ç¸½å‡ºç™¼èˆªç­</h3>
            <div class="number">${totalDepartures}</div>
          </div>
          <div class="summary-card">
            <h3>ç¸½æŠµé”èˆªç­</h3>
            <div class="number">${totalArrivals}</div>
          </div>
          <div class="summary-card">
            <h3>ç¸½èˆªç­æ•¸</h3>
            <div class="number">${totalDepartures + totalArrivals}</div>
          </div>
        </div>
      `;

      // é¡¯ç¤ºæ¯å€‹ç™»æ©Ÿé–€çš„è³‡æ–™
      allData.forEach(gateData => {
        if (gateData.error) {
          html += `
            <div class="flight-section">
              <h2 class="section-title">ç™»æ©Ÿé–€ ${gateData.gate}</h2>
              <div class="error">âŒ ${gateData.error}</div>
            </div>
          `;
        } else {
          html += `
            <div class="flight-section">
              <h2 class="section-title">ç™»æ©Ÿé–€ ${gateData.gate} (${gateData.summary.total_count} ç­)</h2>
              ${gateData.departure.data.length > 0 ? `
                <h3 style="margin: 15px 0 10px 0; color: #667eea;">ğŸ›« å‡ºç™¼èˆªç­ (${gateData.summary.departure_count})</h3>
                ${createTable(gateData.departure, true)}
              ` : ''}
              ${gateData.arrival.data.length > 0 ? `
                <h3 style="margin: 15px 0 10px 0; color: #667eea;">ğŸ›¬ æŠµé”èˆªç­ (${gateData.arrival_count})</h3>
                ${createTable(gateData.arrival, true)}
              ` : ''}
            </div>
          `;
        }
      });

      content.innerHTML = html;
    }

    // å»ºç«‹è¡¨æ ¼
    function createTable(flightData, showGate = false) {
      if (flightData.data.length === 0) {
        return '<p>æš«ç„¡è³‡æ–™</p>';
      }

      let html = '<table><thead><tr>';
      
      if (showGate) {
        html += '<th>ç™»æ©Ÿé–€</th>';
      }
      
      flightData.headers.forEach(header => {
        html += `<th>${header}</th>`;
      });
      
      html += '</tr></thead><tbody>';

      flightData.data.forEach(flight => {
        html += '<tr>';
        
        if (showGate) {
          html += `<td><strong>${flight.gate}</strong></td>`;
        }
        
        html += `<td>${flight.time}</td>`;
        html += `<td><span class="flight-code">${flight.flight_code}</span> ${flight.airline ? `(${flight.airline})` : ''}</td>`;
        html += `<td>${flight.terminal}</td>`;
        html += `<td><strong>${flight.gate}</strong></td>`;
        html += `<td>${flight.city || ''} ${flight.airport_code ? `(${flight.airport_code})` : ''}</td>`;
        
        // ç‹€æ…‹æ¨£å¼
        const statusClass = getStatusClass(flight.status);
        html += `<td><span class="status ${statusClass}">${flight.status}</span></td>`;
        
        html += '</tr>';
      });

      html += '</tbody></table>';
      return html;
    }

    // å–å¾—ç‹€æ…‹æ¨£å¼é¡åˆ¥
    function getStatusClass(status) {
      if (!status) return '';
      const statusLower = status.toLowerCase();
      if (statusLower.includes('æº–æ™‚') || statusLower.includes('ontime')) {
        return 'status-ontime';
      } else if (statusLower.includes('å‡ºç™¼') || statusLower.includes('departed')) {
        return 'status-departed';
      } else if (statusLower.includes('å·²åˆ°') || statusLower.includes('arrived')) {
        return 'status-arrived';
      }
      return '';
    }

    // æ›´æ–°æœ€å¾Œæ›´æ–°æ™‚é–“
    function updateLastUpdated(timestamp) {
      if (!timestamp) return;
      const date = new Date(timestamp);
      const lastUpdated = document.getElementById('lastUpdated');
      lastUpdated.textContent = `æœ€å¾Œæ›´æ–°: ${date.toLocaleString('zh-TW')}`;
    }

    // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
    function updateActiveButton(gate) {
      document.querySelectorAll('.gate-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      if (gate === 'all') {
        document.querySelector('.gate-btn.all').classList.add('active');
      } else {
        document.querySelectorAll('.gate-btn').forEach(btn => {
          if (btn.textContent === gate) {
            btn.classList.add('active');
          }
        });
      }
    }

    // é é¢è¼‰å…¥æ™‚è‡ªå‹•è¼‰å…¥æ‰€æœ‰ç™»æ©Ÿé–€
    window.addEventListener('DOMContentLoaded', () => {
      loadAllGates();
    });
  </script>
</body>
</html>
