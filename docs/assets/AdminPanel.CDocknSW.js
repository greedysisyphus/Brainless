const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.CE3AVWnB.js","assets/index.DDtoVjVE.css"])))=>i.map(i=>d[i]);
import{r as o,j as n,aW as he,aX as Qe,aY as Ze,aZ as Wn,a_ as Un,a$ as _n,b0 as et,b1 as Ce,b2 as ye,b3 as Xn,b4 as Hn,b5 as _t,b6 as Vn,b7 as Yn,b8 as Kn,b9 as Gn,ba as gn,bb as Jn,bc as xn,bd as Ue,be as Zn,bf as bn,_ as pn,bg as Qn}from"./index.CE3AVWnB.js";function es({title:e,titleId:t,...s},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?o.createElement("title",{id:t},e):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"}))}const ts=o.forwardRef(es);function ns({title:e,titleId:t,...s},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?o.createElement("title",{id:t},e):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const ss=o.forwardRef(ns);function rs({title:e,titleId:t,...s},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?o.createElement("title",{id:t},e):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"}))}const as=o.forwardRef(rs),is=({children:e,className:t="",maxWidth:s="container-custom",padding:r="py-4 sm:py-6 lg:py-8",center:a=!0})=>n.jsx("div",{className:`${s} ${r} ${a?"mx-auto":""} ${t}`,children:e}),We=({children:e,className:t="",padding:s="p-4 sm:p-6",hover:r=!0})=>n.jsx("div",{className:`
      bg-surface rounded-xl shadow-lg border border-white/5 
      ${s} 
      ${r?"hover:shadow-xl hover:border-white/10 transition-all duration-200":""} 
      ${t}
    `,children:e}),H=({children:e,onClick:t,variant:s="primary",size:r="md",disabled:a=!1,loading:l=!1,className:c="",...d})=>{const u=()=>{switch(s){case"primary":return"bg-primary text-white hover:bg-primary/80 disabled:bg-primary/50";case"secondary":return"bg-white/10 text-white hover:bg-white/20 disabled:bg-white/5";case"danger":return"bg-red-500/20 text-red-400 hover:bg-red-500/30 border border-red-500/30 disabled:bg-red-500/10";case"ghost":return"text-text-secondary hover:text-text-primary hover:bg-white/5 disabled:text-gray-500";default:return"bg-primary text-white hover:bg-primary/80 disabled:bg-primary/50"}},h=()=>{switch(r){case"sm":return"px-3 py-2 text-sm";case"md":return"px-4 py-2";case"lg":return"px-6 py-3 text-lg";default:return"px-4 py-2"}};return n.jsx("button",{onClick:t,disabled:a||l,className:`
        ${u()}
        ${h()}
        rounded-lg transition-all duration-200
        disabled:opacity-50 disabled:cursor-not-allowed
        focus:outline-none focus:ring-2 focus:ring-primary/50
        ${c}
      `,...d,children:l?n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),"載入中..."]}):e})},ie=({value:e,onChange:t,placeholder:s="",type:r="text",disabled:a=!1,error:l=!1,className:c="",...d})=>n.jsx("input",{type:r,value:e,onChange:t,placeholder:s,disabled:a,className:`
        w-full p-3 sm:p-4
        bg-white/10 border rounded-lg
        text-white placeholder-gray-400
        focus:outline-none focus:ring-2 focus:ring-primary/50
        disabled:opacity-50 disabled:cursor-not-allowed
        ${l?"border-red-500/50 focus:ring-red-500/50":"border-white/20"}
        ${c}
      `,...d}),B=({children:e,htmlFor:t,className:s="",required:r=!1})=>n.jsx("label",{htmlFor:t,className:`
        block text-sm sm:text-base text-white mb-2
        ${r?'after:content-["*"] after:text-red-400 after:ml-1':""}
        ${s}
      `,children:e}),le=({children:e,level:t=1,className:s="",gradient:r=!1})=>{const a=()=>{switch(t){case 1:return"text-2xl sm:text-3xl lg:text-4xl";case 2:return"text-xl sm:text-2xl lg:text-3xl";case 3:return"text-lg sm:text-xl lg:text-2xl";case 4:return"text-base sm:text-lg lg:text-xl";case 5:return"text-sm sm:text-base lg:text-lg";case 6:return"text-xs sm:text-sm lg:text-base";default:return"text-xl sm:text-2xl lg:text-3xl"}},l=()=>r?"bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent":"text-white",c=`h${t}`;return n.jsx(c,{className:`font-bold ${a()} ${l()} ${s}`,children:e})},p=({children:e,size:t="base",color:s="white",className:r="",...a})=>{const l=()=>{switch(t){case"xs":return"text-xs";case"sm":return"text-sm";case"base":return"text-base";case"lg":return"text-lg";case"xl":return"text-xl";default:return"text-base"}},c=()=>{switch(s){case"white":return"text-white";case"secondary":return"text-text-secondary";case"primary":return"text-primary";case"danger":return"text-red-400";case"success":return"text-green-400";default:return"text-white"}};return n.jsx("p",{className:`${l()} ${c()} ${r}`,...a,children:e})};function ls(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return o.useMemo(()=>r=>{t.forEach(a=>a(r))},t)}const Dt=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Xe(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function Xt(e){return"nodeType"in e}function fe(e){var t,s;return e?Xe(e)?e:Xt(e)&&(t=(s=e.ownerDocument)==null?void 0:s.defaultView)!=null?t:window:window}function Ht(e){const{Document:t}=fe(e);return e instanceof t}function ot(e){return Xe(e)?!1:e instanceof fe(e).HTMLElement}function vn(e){return e instanceof fe(e).SVGElement}function He(e){return e?Xe(e)?e.document:Xt(e)?Ht(e)?e:ot(e)||vn(e)?e.ownerDocument:document:document:document}const De=Dt?o.useLayoutEffect:o.useEffect;function Vt(e){const t=o.useRef(e);return De(()=>{t.current=e}),o.useCallback(function(){for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return t.current==null?void 0:t.current(...r)},[])}function os(){const e=o.useRef(null),t=o.useCallback((r,a)=>{e.current=setInterval(r,a)},[]),s=o.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,s]}function rt(e,t){t===void 0&&(t=[e]);const s=o.useRef(e);return De(()=>{s.current!==e&&(s.current=e)},t),s}function ct(e,t){const s=o.useRef();return o.useMemo(()=>{const r=e(s.current);return s.current=r,r},[...t])}function wt(e){const t=Vt(e),s=o.useRef(null),r=o.useCallback(a=>{a!==s.current&&(t==null||t(a,s.current)),s.current=a},[]);return[s,r]}function Pt(e){const t=o.useRef();return o.useEffect(()=>{t.current=e},[e]),t.current}let At={};function dt(e,t){return o.useMemo(()=>{if(t)return t;const s=At[e]==null?0:At[e]+1;return At[e]=s,e+"-"+s},[e,t])}function yn(e){return function(t){for(var s=arguments.length,r=new Array(s>1?s-1:0),a=1;a<s;a++)r[a-1]=arguments[a];return r.reduce((l,c)=>{const d=Object.entries(c);for(const[u,h]of d){const m=l[u];m!=null&&(l[u]=m+e*h)}return l},{...t})}}const _e=yn(1),at=yn(-1);function cs(e){return"clientX"in e&&"clientY"in e}function Yt(e){if(!e)return!1;const{KeyboardEvent:t}=fe(e.target);return t&&e instanceof t}function ds(e){if(!e)return!1;const{TouchEvent:t}=fe(e.target);return t&&e instanceof t}function Bt(e){if(ds(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:s}=e.touches[0];return{x:t,y:s}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:s}=e.changedTouches[0];return{x:t,y:s}}}return cs(e)?{x:e.clientX,y:e.clientY}:null}const it=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:s}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(s?Math.round(s):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:s}=e;return"scaleX("+t+") scaleY("+s+")"}},Transform:{toString(e){if(e)return[it.Translate.toString(e),it.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:s,easing:r}=e;return t+" "+s+"ms "+r}}}),en="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function us(e){return e.matches(en)?e:e.querySelector(en)}const hs={display:"none"};function fs(e){let{id:t,value:s}=e;return he.createElement("div",{id:t,style:hs},s)}function ms(e){let{id:t,announcement:s,ariaLiveType:r="assertive"}=e;const a={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return he.createElement("div",{id:t,style:a,role:"status","aria-live":r,"aria-atomic":!0},s)}function gs(){const[e,t]=o.useState("");return{announce:o.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const wn=o.createContext(null);function xs(e){const t=o.useContext(wn);o.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function bs(){const[e]=o.useState(()=>new Set),t=o.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[o.useCallback(r=>{let{type:a,event:l}=r;e.forEach(c=>{var d;return(d=c[a])==null?void 0:d.call(c,l)})},[e]),t]}const ps={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},vs={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:s}=e;return s?"Draggable item "+t.id+" was moved over droppable area "+s.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:s}=e;return s?"Draggable item "+t.id+" was dropped over droppable area "+s.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function ys(e){let{announcements:t=vs,container:s,hiddenTextDescribedById:r,screenReaderInstructions:a=ps}=e;const{announce:l,announcement:c}=gs(),d=dt("DndLiveRegion"),[u,h]=o.useState(!1);if(o.useEffect(()=>{h(!0)},[]),xs(o.useMemo(()=>({onDragStart(f){let{active:w}=f;l(t.onDragStart({active:w}))},onDragMove(f){let{active:w,over:b}=f;t.onDragMove&&l(t.onDragMove({active:w,over:b}))},onDragOver(f){let{active:w,over:b}=f;l(t.onDragOver({active:w,over:b}))},onDragEnd(f){let{active:w,over:b}=f;l(t.onDragEnd({active:w,over:b}))},onDragCancel(f){let{active:w,over:b}=f;l(t.onDragCancel({active:w,over:b}))}}),[l,t])),!u)return null;const m=he.createElement(he.Fragment,null,he.createElement(fs,{id:r,value:a.draggable}),he.createElement(ms,{id:d,announcement:c}));return s?Qe.createPortal(m,s):m}var Z;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(Z||(Z={}));function jt(){}function tn(e,t){return o.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function ws(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return o.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const we=Object.freeze({x:0,y:0});function jn(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Nn(e,t){let{data:{value:s}}=e,{data:{value:r}}=t;return s-r}function js(e,t){let{data:{value:s}}=e,{data:{value:r}}=t;return r-s}function nn(e){let{left:t,top:s,height:r,width:a}=e;return[{x:t,y:s},{x:t+a,y:s},{x:t,y:s+r},{x:t+a,y:s+r}]}function Cn(e,t){if(!e||e.length===0)return null;const[s]=e;return s[t]}function sn(e,t,s){return t===void 0&&(t=e.left),s===void 0&&(s=e.top),{x:t+e.width*.5,y:s+e.height*.5}}const Ns=e=>{let{collisionRect:t,droppableRects:s,droppableContainers:r}=e;const a=sn(t,t.left,t.top),l=[];for(const c of r){const{id:d}=c,u=s.get(d);if(u){const h=jn(sn(u),a);l.push({id:d,data:{droppableContainer:c,value:h}})}}return l.sort(Nn)},Cs=e=>{let{collisionRect:t,droppableRects:s,droppableContainers:r}=e;const a=nn(t),l=[];for(const c of r){const{id:d}=c,u=s.get(d);if(u){const h=nn(u),m=a.reduce((w,b,k)=>w+jn(h[k],b),0),f=Number((m/4).toFixed(4));l.push({id:d,data:{droppableContainer:c,value:f}})}}return l.sort(Nn)};function Ds(e,t){const s=Math.max(t.top,e.top),r=Math.max(t.left,e.left),a=Math.min(t.left+t.width,e.left+e.width),l=Math.min(t.top+t.height,e.top+e.height),c=a-r,d=l-s;if(r<a&&s<l){const u=t.width*t.height,h=e.width*e.height,m=c*d,f=m/(u+h-m);return Number(f.toFixed(4))}return 0}const Ss=e=>{let{collisionRect:t,droppableRects:s,droppableContainers:r}=e;const a=[];for(const l of r){const{id:c}=l,d=s.get(c);if(d){const u=Ds(d,t);u>0&&a.push({id:c,data:{droppableContainer:l,value:u}})}}return a.sort(js)};function Rs(e,t,s){return{...e,scaleX:t&&s?t.width/s.width:1,scaleY:t&&s?t.height/s.height:1}}function Dn(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:we}function Es(e){return function(s){for(var r=arguments.length,a=new Array(r>1?r-1:0),l=1;l<r;l++)a[l-1]=arguments[l];return a.reduce((c,d)=>({...c,top:c.top+e*d.y,bottom:c.bottom+e*d.y,left:c.left+e*d.x,right:c.right+e*d.x}),{...s})}}const Ts=Es(1);function ks(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Ms(e,t,s){const r=ks(t);if(!r)return e;const{scaleX:a,scaleY:l,x:c,y:d}=r,u=e.left-c-(1-a)*parseFloat(s),h=e.top-d-(1-l)*parseFloat(s.slice(s.indexOf(" ")+1)),m=a?e.width/a:e.width,f=l?e.height/l:e.height;return{width:m,height:f,top:h,right:u+m,bottom:h+f,left:u}}const Is={ignoreTransform:!1};function Ve(e,t){t===void 0&&(t=Is);let s=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:h,transformOrigin:m}=fe(e).getComputedStyle(e);h&&(s=Ms(s,h,m))}const{top:r,left:a,width:l,height:c,bottom:d,right:u}=s;return{top:r,left:a,width:l,height:c,bottom:d,right:u}}function rn(e){return Ve(e,{ignoreTransform:!0})}function Os(e){const t=e.innerWidth,s=e.innerHeight;return{top:0,left:0,right:t,bottom:s,width:t,height:s}}function zs(e,t){return t===void 0&&(t=fe(e).getComputedStyle(e)),t.position==="fixed"}function As(e,t){t===void 0&&(t=fe(e).getComputedStyle(e));const s=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(a=>{const l=t[a];return typeof l=="string"?s.test(l):!1})}function St(e,t){const s=[];function r(a){if(t!=null&&s.length>=t||!a)return s;if(Ht(a)&&a.scrollingElement!=null&&!s.includes(a.scrollingElement))return s.push(a.scrollingElement),s;if(!ot(a)||vn(a)||s.includes(a))return s;const l=fe(e).getComputedStyle(a);return a!==e&&As(a,l)&&s.push(a),zs(a,l)?s:r(a.parentNode)}return e?r(e):s}function Sn(e){const[t]=St(e,1);return t??null}function Lt(e){return!Dt||!e?null:Xe(e)?e:Xt(e)?Ht(e)||e===He(e).scrollingElement?window:ot(e)?e:null:null}function Rn(e){return Xe(e)?e.scrollX:e.scrollLeft}function En(e){return Xe(e)?e.scrollY:e.scrollTop}function qt(e){return{x:Rn(e),y:En(e)}}var ne;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(ne||(ne={}));function Tn(e){return!Dt||!e?!1:e===document.scrollingElement}function kn(e){const t={x:0,y:0},s=Tn(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-s.width,y:e.scrollHeight-s.height},a=e.scrollTop<=t.y,l=e.scrollLeft<=t.x,c=e.scrollTop>=r.y,d=e.scrollLeft>=r.x;return{isTop:a,isLeft:l,isBottom:c,isRight:d,maxScroll:r,minScroll:t}}const Ls={x:.2,y:.2};function $s(e,t,s,r,a){let{top:l,left:c,right:d,bottom:u}=s;r===void 0&&(r=10),a===void 0&&(a=Ls);const{isTop:h,isBottom:m,isLeft:f,isRight:w}=kn(e),b={x:0,y:0},k={x:0,y:0},j={height:t.height*a.y,width:t.width*a.x};return!h&&l<=t.top+j.height?(b.y=ne.Backward,k.y=r*Math.abs((t.top+j.height-l)/j.height)):!m&&u>=t.bottom-j.height&&(b.y=ne.Forward,k.y=r*Math.abs((t.bottom-j.height-u)/j.height)),!w&&d>=t.right-j.width?(b.x=ne.Forward,k.x=r*Math.abs((t.right-j.width-d)/j.width)):!f&&c<=t.left+j.width&&(b.x=ne.Backward,k.x=r*Math.abs((t.left+j.width-c)/j.width)),{direction:b,speed:k}}function Fs(e){if(e===document.scrollingElement){const{innerWidth:l,innerHeight:c}=window;return{top:0,left:0,right:l,bottom:c,width:l,height:c}}const{top:t,left:s,right:r,bottom:a}=e.getBoundingClientRect();return{top:t,left:s,right:r,bottom:a,width:e.clientWidth,height:e.clientHeight}}function Mn(e){return e.reduce((t,s)=>_e(t,qt(s)),we)}function Ps(e){return e.reduce((t,s)=>t+Rn(s),0)}function Bs(e){return e.reduce((t,s)=>t+En(s),0)}function qs(e,t){if(t===void 0&&(t=Ve),!e)return;const{top:s,left:r,bottom:a,right:l}=t(e);Sn(e)&&(a<=0||l<=0||s>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Ws=[["x",["left","right"],Ps],["y",["top","bottom"],Bs]];class Kt{constructor(t,s){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=St(s),a=Mn(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[l,c,d]of Ws)for(const u of c)Object.defineProperty(this,u,{get:()=>{const h=d(r),m=a[l]-h;return this.rect[u]+m},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class tt{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(s=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...s)})},this.target=t}add(t,s,r){var a;(a=this.target)==null||a.addEventListener(t,s,r),this.listeners.push([t,s,r])}}function Us(e){const{EventTarget:t}=fe(e);return e instanceof t?e:He(e)}function $t(e,t){const s=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(s**2+r**2)>t:"x"in t&&"y"in t?s>t.x&&r>t.y:"x"in t?s>t.x:"y"in t?r>t.y:!1}var pe;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(pe||(pe={}));function an(e){e.preventDefault()}function _s(e){e.stopPropagation()}var P;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(P||(P={}));const In={start:[P.Space,P.Enter],cancel:[P.Esc],end:[P.Space,P.Enter,P.Tab]},Xs=(e,t)=>{let{currentCoordinates:s}=t;switch(e.code){case P.Right:return{...s,x:s.x+25};case P.Left:return{...s,x:s.x-25};case P.Down:return{...s,y:s.y+25};case P.Up:return{...s,y:s.y-25}}};class Gt{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:s}}=t;this.props=t,this.listeners=new tt(He(s)),this.windowListeners=new tt(fe(s)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(pe.Resize,this.handleCancel),this.windowListeners.add(pe.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(pe.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:s}=this.props,r=t.node.current;r&&qs(r),s(we)}handleKeyDown(t){if(Yt(t)){const{active:s,context:r,options:a}=this.props,{keyboardCodes:l=In,coordinateGetter:c=Xs,scrollBehavior:d="smooth"}=a,{code:u}=t;if(l.end.includes(u)){this.handleEnd(t);return}if(l.cancel.includes(u)){this.handleCancel(t);return}const{collisionRect:h}=r.current,m=h?{x:h.left,y:h.top}:we;this.referenceCoordinates||(this.referenceCoordinates=m);const f=c(t,{active:s,context:r.current,currentCoordinates:m});if(f){const w=at(f,m),b={x:0,y:0},{scrollableAncestors:k}=r.current;for(const j of k){const C=t.code,{isTop:z,isRight:E,isLeft:T,isBottom:M,maxScroll:L,minScroll:v}=kn(j),I=Fs(j),D={x:Math.min(C===P.Right?I.right-I.width/2:I.right,Math.max(C===P.Right?I.left:I.left+I.width/2,f.x)),y:Math.min(C===P.Down?I.bottom-I.height/2:I.bottom,Math.max(C===P.Down?I.top:I.top+I.height/2,f.y))},_=C===P.Right&&!E||C===P.Left&&!T,$=C===P.Down&&!M||C===P.Up&&!z;if(_&&D.x!==f.x){const W=j.scrollLeft+w.x,X=C===P.Right&&W<=L.x||C===P.Left&&W>=v.x;if(X&&!w.y){j.scrollTo({left:W,behavior:d});return}X?b.x=j.scrollLeft-W:b.x=C===P.Right?j.scrollLeft-L.x:j.scrollLeft-v.x,b.x&&j.scrollBy({left:-b.x,behavior:d});break}else if($&&D.y!==f.y){const W=j.scrollTop+w.y,X=C===P.Down&&W<=L.y||C===P.Up&&W>=v.y;if(X&&!w.x){j.scrollTo({top:W,behavior:d});return}X?b.y=j.scrollTop-W:b.y=C===P.Down?j.scrollTop-L.y:j.scrollTop-v.y,b.y&&j.scrollBy({top:-b.y,behavior:d});break}}this.handleMove(t,_e(at(f,this.referenceCoordinates),b))}}}handleMove(t,s){const{onMove:r}=this.props;t.preventDefault(),r(s)}handleEnd(t){const{onEnd:s}=this.props;t.preventDefault(),this.detach(),s()}handleCancel(t){const{onCancel:s}=this.props;t.preventDefault(),this.detach(),s()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Gt.activators=[{eventName:"onKeyDown",handler:(e,t,s)=>{let{keyboardCodes:r=In,onActivation:a}=t,{active:l}=s;const{code:c}=e.nativeEvent;if(r.start.includes(c)){const d=l.activatorNode.current;return d&&e.target!==d?!1:(e.preventDefault(),a==null||a({event:e.nativeEvent}),!0)}return!1}}];function ln(e){return!!(e&&"distance"in e)}function on(e){return!!(e&&"delay"in e)}class Jt{constructor(t,s,r){var a;r===void 0&&(r=Us(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=s;const{event:l}=t,{target:c}=l;this.props=t,this.events=s,this.document=He(c),this.documentListeners=new tt(this.document),this.listeners=new tt(r),this.windowListeners=new tt(fe(c)),this.initialCoordinates=(a=Bt(l))!=null?a:we,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:s,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(pe.Resize,this.handleCancel),this.windowListeners.add(pe.DragStart,an),this.windowListeners.add(pe.VisibilityChange,this.handleCancel),this.windowListeners.add(pe.ContextMenu,an),this.documentListeners.add(pe.Keydown,this.handleKeydown),s){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(on(s)){this.timeoutId=setTimeout(this.handleStart,s.delay),this.handlePending(s);return}if(ln(s)){this.handlePending(s);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,s){const{active:r,onPending:a}=this.props;a(r,t,this.initialCoordinates,s)}handleStart(){const{initialCoordinates:t}=this,{onStart:s}=this.props;t&&(this.activated=!0,this.documentListeners.add(pe.Click,_s,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(pe.SelectionChange,this.removeTextSelection),s(t))}handleMove(t){var s;const{activated:r,initialCoordinates:a,props:l}=this,{onMove:c,options:{activationConstraint:d}}=l;if(!a)return;const u=(s=Bt(t))!=null?s:we,h=at(a,u);if(!r&&d){if(ln(d)){if(d.tolerance!=null&&$t(h,d.tolerance))return this.handleCancel();if($t(h,d.distance))return this.handleStart()}if(on(d)&&$t(h,d.tolerance))return this.handleCancel();this.handlePending(d,h);return}t.cancelable&&t.preventDefault(),c(u)}handleEnd(){const{onAbort:t,onEnd:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleCancel(){const{onAbort:t,onCancel:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleKeydown(t){t.code===P.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const Hs={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Zt extends Jt{constructor(t){const{event:s}=t,r=He(s.target);super(t,Hs,r)}}Zt.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:r}=t;return!s.isPrimary||s.button!==0?!1:(r==null||r({event:s}),!0)}}];const Vs={move:{name:"mousemove"},end:{name:"mouseup"}};var Wt;(function(e){e[e.RightClick=2]="RightClick"})(Wt||(Wt={}));class Ys extends Jt{constructor(t){super(t,Vs,He(t.event.target))}}Ys.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:r}=t;return s.button===Wt.RightClick?!1:(r==null||r({event:s}),!0)}}];const Ft={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Ks extends Jt{constructor(t){super(t,Ft)}static setup(){return window.addEventListener(Ft.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Ft.move.name,t)};function t(){}}}Ks.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:r}=t;const{touches:a}=s;return a.length>1?!1:(r==null||r({event:s}),!0)}}];var nt;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(nt||(nt={}));var Nt;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(Nt||(Nt={}));function Gs(e){let{acceleration:t,activator:s=nt.Pointer,canScroll:r,draggingRect:a,enabled:l,interval:c=5,order:d=Nt.TreeOrder,pointerCoordinates:u,scrollableAncestors:h,scrollableAncestorRects:m,delta:f,threshold:w}=e;const b=Zs({delta:f,disabled:!l}),[k,j]=os(),C=o.useRef({x:0,y:0}),z=o.useRef({x:0,y:0}),E=o.useMemo(()=>{switch(s){case nt.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case nt.DraggableRect:return a}},[s,a,u]),T=o.useRef(null),M=o.useCallback(()=>{const v=T.current;if(!v)return;const I=C.current.x*z.current.x,D=C.current.y*z.current.y;v.scrollBy(I,D)},[]),L=o.useMemo(()=>d===Nt.TreeOrder?[...h].reverse():h,[d,h]);o.useEffect(()=>{if(!l||!h.length||!E){j();return}for(const v of L){if((r==null?void 0:r(v))===!1)continue;const I=h.indexOf(v),D=m[I];if(!D)continue;const{direction:_,speed:$}=$s(v,D,E,t,w);for(const W of["x","y"])b[W][_[W]]||($[W]=0,_[W]=0);if($.x>0||$.y>0){j(),T.current=v,k(M,c),C.current=$,z.current=_;return}}C.current={x:0,y:0},z.current={x:0,y:0},j()},[t,M,r,j,l,c,JSON.stringify(E),JSON.stringify(b),k,h,L,m,JSON.stringify(w)])}const Js={x:{[ne.Backward]:!1,[ne.Forward]:!1},y:{[ne.Backward]:!1,[ne.Forward]:!1}};function Zs(e){let{delta:t,disabled:s}=e;const r=Pt(t);return ct(a=>{if(s||!r||!a)return Js;const l={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[ne.Backward]:a.x[ne.Backward]||l.x===-1,[ne.Forward]:a.x[ne.Forward]||l.x===1},y:{[ne.Backward]:a.y[ne.Backward]||l.y===-1,[ne.Forward]:a.y[ne.Forward]||l.y===1}}},[s,t,r])}function Qs(e,t){const s=t!=null?e.get(t):void 0,r=s?s.node.current:null;return ct(a=>{var l;return t==null?null:(l=r??a)!=null?l:null},[r,t])}function er(e,t){return o.useMemo(()=>e.reduce((s,r)=>{const{sensor:a}=r,l=a.activators.map(c=>({eventName:c.eventName,handler:t(c.handler,r)}));return[...s,...l]},[]),[e,t])}var lt;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(lt||(lt={}));var Ut;(function(e){e.Optimized="optimized"})(Ut||(Ut={}));const cn=new Map;function tr(e,t){let{dragging:s,dependencies:r,config:a}=t;const[l,c]=o.useState(null),{frequency:d,measure:u,strategy:h}=a,m=o.useRef(e),f=C(),w=rt(f),b=o.useCallback(function(z){z===void 0&&(z=[]),!w.current&&c(E=>E===null?z:E.concat(z.filter(T=>!E.includes(T))))},[w]),k=o.useRef(null),j=ct(z=>{if(f&&!s)return cn;if(!z||z===cn||m.current!==e||l!=null){const E=new Map;for(let T of e){if(!T)continue;if(l&&l.length>0&&!l.includes(T.id)&&T.rect.current){E.set(T.id,T.rect.current);continue}const M=T.node.current,L=M?new Kt(u(M),M):null;T.rect.current=L,L&&E.set(T.id,L)}return E}return z},[e,l,s,f,u]);return o.useEffect(()=>{m.current=e},[e]),o.useEffect(()=>{f||b()},[s,f]),o.useEffect(()=>{l&&l.length>0&&c(null)},[JSON.stringify(l)]),o.useEffect(()=>{f||typeof d!="number"||k.current!==null||(k.current=setTimeout(()=>{b(),k.current=null},d))},[d,f,b,...r]),{droppableRects:j,measureDroppableContainers:b,measuringScheduled:l!=null};function C(){switch(h){case lt.Always:return!1;case lt.BeforeDragging:return s;default:return!s}}}function On(e,t){return ct(s=>e?s||(typeof t=="function"?t(e):e):null,[t,e])}function nr(e,t){return On(e,t)}function sr(e){let{callback:t,disabled:s}=e;const r=Vt(t),a=o.useMemo(()=>{if(s||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:l}=window;return new l(r)},[r,s]);return o.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function Rt(e){let{callback:t,disabled:s}=e;const r=Vt(t),a=o.useMemo(()=>{if(s||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:l}=window;return new l(r)},[s]);return o.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function rr(e){return new Kt(Ve(e),e)}function dn(e,t,s){t===void 0&&(t=rr);const[r,a]=o.useState(null);function l(){a(u=>{if(!e)return null;if(e.isConnected===!1){var h;return(h=u??s)!=null?h:null}const m=t(e);return JSON.stringify(u)===JSON.stringify(m)?u:m})}const c=sr({callback(u){if(e)for(const h of u){const{type:m,target:f}=h;if(m==="childList"&&f instanceof HTMLElement&&f.contains(e)){l();break}}}}),d=Rt({callback:l});return De(()=>{l(),e?(d==null||d.observe(e),c==null||c.observe(document.body,{childList:!0,subtree:!0})):(d==null||d.disconnect(),c==null||c.disconnect())},[e]),r}function ar(e){const t=On(e);return Dn(e,t)}const un=[];function ir(e){const t=o.useRef(e),s=ct(r=>e?r&&r!==un&&e&&t.current&&e.parentNode===t.current.parentNode?r:St(e):un,[e]);return o.useEffect(()=>{t.current=e},[e]),s}function lr(e){const[t,s]=o.useState(null),r=o.useRef(e),a=o.useCallback(l=>{const c=Lt(l.target);c&&s(d=>d?(d.set(c,qt(c)),new Map(d)):null)},[]);return o.useEffect(()=>{const l=r.current;if(e!==l){c(l);const d=e.map(u=>{const h=Lt(u);return h?(h.addEventListener("scroll",a,{passive:!0}),[h,qt(h)]):null}).filter(u=>u!=null);s(d.length?new Map(d):null),r.current=e}return()=>{c(e),c(l)};function c(d){d.forEach(u=>{const h=Lt(u);h==null||h.removeEventListener("scroll",a)})}},[a,e]),o.useMemo(()=>e.length?t?Array.from(t.values()).reduce((l,c)=>_e(l,c),we):Mn(e):we,[e,t])}function hn(e,t){t===void 0&&(t=[]);const s=o.useRef(null);return o.useEffect(()=>{s.current=null},t),o.useEffect(()=>{const r=e!==we;r&&!s.current&&(s.current=e),!r&&s.current&&(s.current=null)},[e]),s.current?at(e,s.current):we}function or(e){o.useEffect(()=>{if(!Dt)return;const t=e.map(s=>{let{sensor:r}=s;return r.setup==null?void 0:r.setup()});return()=>{for(const s of t)s==null||s()}},e.map(t=>{let{sensor:s}=t;return s}))}function cr(e,t){return o.useMemo(()=>e.reduce((s,r)=>{let{eventName:a,handler:l}=r;return s[a]=c=>{l(c,t)},s},{}),[e,t])}function zn(e){return o.useMemo(()=>e?Os(e):null,[e])}const fn=[];function dr(e,t){t===void 0&&(t=Ve);const[s]=e,r=zn(s?fe(s):null),[a,l]=o.useState(fn);function c(){l(()=>e.length?e.map(u=>Tn(u)?r:new Kt(t(u),u)):fn)}const d=Rt({callback:c});return De(()=>{d==null||d.disconnect(),c(),e.forEach(u=>d==null?void 0:d.observe(u))},[e]),a}function ur(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return ot(t)?t:e}function hr(e){let{measure:t}=e;const[s,r]=o.useState(null),a=o.useCallback(h=>{for(const{target:m}of h)if(ot(m)){r(f=>{const w=t(m);return f?{...f,width:w.width,height:w.height}:w});break}},[t]),l=Rt({callback:a}),c=o.useCallback(h=>{const m=ur(h);l==null||l.disconnect(),m&&(l==null||l.observe(m)),r(m?t(m):null)},[t,l]),[d,u]=wt(c);return o.useMemo(()=>({nodeRef:d,rect:s,setRef:u}),[s,d,u])}const fr=[{sensor:Zt,options:{}},{sensor:Gt,options:{}}],mr={current:{}},yt={draggable:{measure:rn},droppable:{measure:rn,strategy:lt.WhileDragging,frequency:Ut.Optimized},dragOverlay:{measure:Ve}};class st extends Map{get(t){var s;return t!=null&&(s=super.get(t))!=null?s:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:s}=t;return!s})}getNodeFor(t){var s,r;return(s=(r=this.get(t))==null?void 0:r.node.current)!=null?s:void 0}}const gr={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new st,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:jt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:yt,measureDroppableContainers:jt,windowRect:null,measuringScheduled:!1},xr={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:jt,draggableNodes:new Map,over:null,measureDroppableContainers:jt},Et=o.createContext(xr),An=o.createContext(gr);function br(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new st}}}function pr(e,t){switch(t.type){case Z.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case Z.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case Z.DragEnd:case Z.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Z.RegisterDroppable:{const{element:s}=t,{id:r}=s,a=new st(e.droppable.containers);return a.set(r,s),{...e,droppable:{...e.droppable,containers:a}}}case Z.SetDroppableDisabled:{const{id:s,key:r,disabled:a}=t,l=e.droppable.containers.get(s);if(!l||r!==l.key)return e;const c=new st(e.droppable.containers);return c.set(s,{...l,disabled:a}),{...e,droppable:{...e.droppable,containers:c}}}case Z.UnregisterDroppable:{const{id:s,key:r}=t,a=e.droppable.containers.get(s);if(!a||r!==a.key)return e;const l=new st(e.droppable.containers);return l.delete(s),{...e,droppable:{...e.droppable,containers:l}}}default:return e}}function vr(e){let{disabled:t}=e;const{active:s,activatorEvent:r,draggableNodes:a}=o.useContext(Et),l=Pt(r),c=Pt(s==null?void 0:s.id);return o.useEffect(()=>{if(!t&&!r&&l&&c!=null){if(!Yt(l)||document.activeElement===l.target)return;const d=a.get(c);if(!d)return;const{activatorNode:u,node:h}=d;if(!u.current&&!h.current)return;requestAnimationFrame(()=>{for(const m of[u.current,h.current]){if(!m)continue;const f=us(m);if(f){f.focus();break}}})}},[r,t,a,c,l]),null}function yr(e,t){let{transform:s,...r}=t;return e!=null&&e.length?e.reduce((a,l)=>l({transform:a,...r}),s):s}function wr(e){return o.useMemo(()=>({draggable:{...yt.draggable,...e==null?void 0:e.draggable},droppable:{...yt.droppable,...e==null?void 0:e.droppable},dragOverlay:{...yt.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function jr(e){let{activeNode:t,measure:s,initialRect:r,config:a=!0}=e;const l=o.useRef(!1),{x:c,y:d}=typeof a=="boolean"?{x:a,y:a}:a;De(()=>{if(!c&&!d||!t){l.current=!1;return}if(l.current||!r)return;const h=t==null?void 0:t.node.current;if(!h||h.isConnected===!1)return;const m=s(h),f=Dn(m,r);if(c||(f.x=0),d||(f.y=0),l.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const w=Sn(h);w&&w.scrollBy({top:f.y,left:f.x})}},[t,c,d,r,s])}const Ln=o.createContext({...we,scaleX:1,scaleY:1});var $e;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})($e||($e={}));const Nr=o.memo(function(t){var s,r,a,l;let{id:c,accessibility:d,autoScroll:u=!0,children:h,sensors:m=fr,collisionDetection:f=Ss,measuring:w,modifiers:b,...k}=t;const j=o.useReducer(pr,void 0,br),[C,z]=j,[E,T]=bs(),[M,L]=o.useState($e.Uninitialized),v=M===$e.Initialized,{draggable:{active:I,nodes:D,translate:_},droppable:{containers:$}}=C,W=I!=null?D.get(I):null,X=o.useRef({initial:null,translated:null}),Q=o.useMemo(()=>{var y;return I!=null?{id:I,data:(y=W==null?void 0:W.data)!=null?y:mr,rect:X}:null},[I,W]),ee=o.useRef(null),[F,N]=o.useState(null),[S,U]=o.useState(null),oe=rt(k,Object.values(k)),K=dt("DndDescribedBy",c),Ee=o.useMemo(()=>$.getEnabled(),[$]),V=wr(w),{droppableRects:me,measureDroppableContainers:ge,measuringScheduled:Te}=tr(Ee,{dragging:v,dependencies:[_.x,_.y],config:V.droppable}),se=Qs(D,I),xe=o.useMemo(()=>S?Bt(S):null,[S]),re=x(),ce=nr(se,V.draggable.measure);jr({activeNode:I!=null?D.get(I):null,config:re.layoutShiftCompensation,initialRect:ce,measure:V.draggable.measure});const q=dn(se,V.draggable.measure,ce),ke=dn(se?se.parentElement:null),be=o.useRef({activatorEvent:null,active:null,activeNode:se,collisionRect:null,collisions:null,droppableRects:me,draggableNodes:D,draggingNode:null,draggingNodeRect:null,droppableContainers:$,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Se=$.getNodeFor((s=be.current.over)==null?void 0:s.id),ve=hr({measure:V.dragOverlay.measure}),Me=(r=ve.nodeRef.current)!=null?r:se,Ie=v?(a=ve.rect)!=null?a:q:null,ut=!!(ve.nodeRef.current&&ve.rect),ht=ar(ut?null:q),Be=zn(Me?fe(Me):null),de=ir(v?Se??se:null),qe=dr(de),Fe=yr(b,{transform:{x:_.x-ht.x,y:_.y-ht.y,scaleX:1,scaleY:1},activatorEvent:S,active:Q,activeNodeRect:q,containerNodeRect:ke,draggingNodeRect:Ie,over:be.current.over,overlayNodeRect:ve.rect,scrollableAncestors:de,scrollableAncestorRects:qe,windowRect:Be}),G=xe?_e(xe,_):null,ft=lr(de),Tt=hn(ft),kt=hn(ft,[q]),Oe=_e(Fe,Tt),ze=Ie?Ts(Ie,Fe):null,Pe=Q&&ze?f({active:Q,collisionRect:ze,droppableRects:me,droppableContainers:Ee,pointerCoordinates:G}):null,mt=Cn(Pe,"id"),[je,gt]=o.useState(null),Mt=ut?Fe:_e(Fe,kt),It=Rs(Mt,(l=je==null?void 0:je.rect)!=null?l:null,q),Ye=o.useRef(null),xt=o.useCallback((y,A)=>{let{sensor:R,options:O}=A;if(ee.current==null)return;const te=D.get(ee.current);if(!te)return;const ae=y.nativeEvent,J=new R({active:ee.current,activeNode:te,event:ae,options:O,context:be,onAbort(Y){if(!D.get(Y))return;const{onDragAbort:Ne}=oe.current,Re={id:Y};Ne==null||Ne(Re),E({type:"onDragAbort",event:Re})},onPending(Y,Ae,Ne,Re){if(!D.get(Y))return;const{onDragPending:Ge}=oe.current,Le={id:Y,constraint:Ae,initialCoordinates:Ne,offset:Re};Ge==null||Ge(Le),E({type:"onDragPending",event:Le})},onStart(Y){const Ae=ee.current;if(Ae==null)return;const Ne=D.get(Ae);if(!Ne)return;const{onDragStart:Re}=oe.current,Ke={activatorEvent:ae,active:{id:Ae,data:Ne.data,rect:X}};Qe.unstable_batchedUpdates(()=>{Re==null||Re(Ke),L($e.Initializing),z({type:Z.DragStart,initialCoordinates:Y,active:Ae}),E({type:"onDragStart",event:Ke}),N(Ye.current),U(ae)})},onMove(Y){z({type:Z.DragMove,coordinates:Y})},onEnd:ue(Z.DragEnd),onCancel:ue(Z.DragCancel)});Ye.current=J;function ue(Y){return async function(){const{active:Ne,collisions:Re,over:Ke,scrollAdjustedTranslate:Ge}=be.current;let Le=null;if(Ne&&Ge){const{cancelDrop:Je}=oe.current;Le={activatorEvent:ae,active:Ne,collisions:Re,delta:Ge,over:Ke},Y===Z.DragEnd&&typeof Je=="function"&&await Promise.resolve(Je(Le))&&(Y=Z.DragCancel)}ee.current=null,Qe.unstable_batchedUpdates(()=>{z({type:Y}),L($e.Uninitialized),gt(null),N(null),U(null),Ye.current=null;const Je=Y===Z.DragEnd?"onDragEnd":"onDragCancel";if(Le){const zt=oe.current[Je];zt==null||zt(Le),E({type:Je,event:Le})}})}}},[D]),Ot=o.useCallback((y,A)=>(R,O)=>{const te=R.nativeEvent,ae=D.get(O);if(ee.current!==null||!ae||te.dndKit||te.defaultPrevented)return;const J={active:ae};y(R,A.options,J)===!0&&(te.dndKit={capturedBy:A.sensor},ee.current=O,xt(R,A))},[D,xt]),bt=er(m,Ot);or(m),De(()=>{q&&M===$e.Initializing&&L($e.Initialized)},[q,M]),o.useEffect(()=>{const{onDragMove:y}=oe.current,{active:A,activatorEvent:R,collisions:O,over:te}=be.current;if(!A||!R)return;const ae={active:A,activatorEvent:R,collisions:O,delta:{x:Oe.x,y:Oe.y},over:te};Qe.unstable_batchedUpdates(()=>{y==null||y(ae),E({type:"onDragMove",event:ae})})},[Oe.x,Oe.y]),o.useEffect(()=>{const{active:y,activatorEvent:A,collisions:R,droppableContainers:O,scrollAdjustedTranslate:te}=be.current;if(!y||ee.current==null||!A||!te)return;const{onDragOver:ae}=oe.current,J=O.get(mt),ue=J&&J.rect.current?{id:J.id,rect:J.rect.current,data:J.data,disabled:J.disabled}:null,Y={active:y,activatorEvent:A,collisions:R,delta:{x:te.x,y:te.y},over:ue};Qe.unstable_batchedUpdates(()=>{gt(ue),ae==null||ae(Y),E({type:"onDragOver",event:Y})})},[mt]),De(()=>{be.current={activatorEvent:S,active:Q,activeNode:se,collisionRect:ze,collisions:Pe,droppableRects:me,draggableNodes:D,draggingNode:Me,draggingNodeRect:Ie,droppableContainers:$,over:je,scrollableAncestors:de,scrollAdjustedTranslate:Oe},X.current={initial:Ie,translated:ze}},[Q,se,Pe,ze,D,Me,Ie,me,$,je,de,Oe]),Gs({...re,delta:_,draggingRect:ze,pointerCoordinates:G,scrollableAncestors:de,scrollableAncestorRects:qe});const i=o.useMemo(()=>({active:Q,activeNode:se,activeNodeRect:q,activatorEvent:S,collisions:Pe,containerNodeRect:ke,dragOverlay:ve,draggableNodes:D,droppableContainers:$,droppableRects:me,over:je,measureDroppableContainers:ge,scrollableAncestors:de,scrollableAncestorRects:qe,measuringConfiguration:V,measuringScheduled:Te,windowRect:Be}),[Q,se,q,S,Pe,ke,ve,D,$,me,je,ge,de,qe,V,Te,Be]),g=o.useMemo(()=>({activatorEvent:S,activators:bt,active:Q,activeNodeRect:q,ariaDescribedById:{draggable:K},dispatch:z,draggableNodes:D,over:je,measureDroppableContainers:ge}),[S,bt,Q,q,z,K,D,je,ge]);return he.createElement(wn.Provider,{value:T},he.createElement(Et.Provider,{value:g},he.createElement(An.Provider,{value:i},he.createElement(Ln.Provider,{value:It},h)),he.createElement(vr,{disabled:(d==null?void 0:d.restoreFocus)===!1})),he.createElement(ys,{...d,hiddenTextDescribedById:K}));function x(){const y=(F==null?void 0:F.autoScrollEnabled)===!1,A=typeof u=="object"?u.enabled===!1:u===!1,R=v&&!y&&!A;return typeof u=="object"?{...u,enabled:R}:{enabled:R}}}),Cr=o.createContext(null),mn="button",Dr="Draggable";function Sr(e){let{id:t,data:s,disabled:r=!1,attributes:a}=e;const l=dt(Dr),{activators:c,activatorEvent:d,active:u,activeNodeRect:h,ariaDescribedById:m,draggableNodes:f,over:w}=o.useContext(Et),{role:b=mn,roleDescription:k="draggable",tabIndex:j=0}=a??{},C=(u==null?void 0:u.id)===t,z=o.useContext(C?Ln:Cr),[E,T]=wt(),[M,L]=wt(),v=cr(c,t),I=rt(s);De(()=>(f.set(t,{id:t,key:l,node:E,activatorNode:M,data:I}),()=>{const _=f.get(t);_&&_.key===l&&f.delete(t)}),[f,t]);const D=o.useMemo(()=>({role:b,tabIndex:j,"aria-disabled":r,"aria-pressed":C&&b===mn?!0:void 0,"aria-roledescription":k,"aria-describedby":m.draggable}),[r,b,j,C,k,m.draggable]);return{active:u,activatorEvent:d,activeNodeRect:h,attributes:D,isDragging:C,listeners:r?void 0:v,node:E,over:w,setNodeRef:T,setActivatorNodeRef:L,transform:z}}function Rr(){return o.useContext(An)}const Er="Droppable",Tr={timeout:25};function kr(e){let{data:t,disabled:s=!1,id:r,resizeObserverConfig:a}=e;const l=dt(Er),{active:c,dispatch:d,over:u,measureDroppableContainers:h}=o.useContext(Et),m=o.useRef({disabled:s}),f=o.useRef(!1),w=o.useRef(null),b=o.useRef(null),{disabled:k,updateMeasurementsFor:j,timeout:C}={...Tr,...a},z=rt(j??r),E=o.useCallback(()=>{if(!f.current){f.current=!0;return}b.current!=null&&clearTimeout(b.current),b.current=setTimeout(()=>{h(Array.isArray(z.current)?z.current:[z.current]),b.current=null},C)},[C]),T=Rt({callback:E,disabled:k||!c}),M=o.useCallback((D,_)=>{T&&(_&&(T.unobserve(_),f.current=!1),D&&T.observe(D))},[T]),[L,v]=wt(M),I=rt(t);return o.useEffect(()=>{!T||!L.current||(T.disconnect(),f.current=!1,T.observe(L.current))},[L,T]),o.useEffect(()=>(d({type:Z.RegisterDroppable,element:{id:r,key:l,disabled:s,node:L,rect:w,data:I}}),()=>d({type:Z.UnregisterDroppable,key:l,id:r})),[r]),o.useEffect(()=>{s!==m.current.disabled&&(d({type:Z.SetDroppableDisabled,id:r,key:l,disabled:s}),m.current.disabled=s)},[r,l,s,d]),{active:c,rect:w,isOver:(u==null?void 0:u.id)===r,node:L,over:u,setNodeRef:v}}function Qt(e,t,s){const r=e.slice();return r.splice(s<0?r.length+s:s,0,r.splice(t,1)[0]),r}function Mr(e,t){return e.reduce((s,r,a)=>{const l=t.get(r);return l&&(s[a]=l),s},Array(e.length))}function pt(e){return e!==null&&e>=0}function Ir(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}function Or(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const $n=e=>{let{rects:t,activeIndex:s,overIndex:r,index:a}=e;const l=Qt(t,r,s),c=t[a],d=l[a];return!d||!c?null:{x:d.left-c.left,y:d.top-c.top,scaleX:d.width/c.width,scaleY:d.height/c.height}},vt={scaleX:1,scaleY:1},zr=e=>{var t;let{activeIndex:s,activeNodeRect:r,index:a,rects:l,overIndex:c}=e;const d=(t=l[s])!=null?t:r;if(!d)return null;if(a===s){const h=l[c];return h?{x:0,y:s<c?h.top+h.height-(d.top+d.height):h.top-d.top,...vt}:null}const u=Ar(l,a,s);return a>s&&a<=c?{x:0,y:-d.height-u,...vt}:a<s&&a>=c?{x:0,y:d.height+u,...vt}:{x:0,y:0,...vt}};function Ar(e,t,s){const r=e[t],a=e[t-1],l=e[t+1];return r?s<t?a?r.top-(a.top+a.height):l?l.top-(r.top+r.height):0:l?l.top-(r.top+r.height):a?r.top-(a.top+a.height):0:0}const Fn="Sortable",Pn=he.createContext({activeIndex:-1,containerId:Fn,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:$n,disabled:{draggable:!1,droppable:!1}});function Lr(e){let{children:t,id:s,items:r,strategy:a=$n,disabled:l=!1}=e;const{active:c,dragOverlay:d,droppableRects:u,over:h,measureDroppableContainers:m}=Rr(),f=dt(Fn,s),w=d.rect!==null,b=o.useMemo(()=>r.map(v=>typeof v=="object"&&"id"in v?v.id:v),[r]),k=c!=null,j=c?b.indexOf(c.id):-1,C=h?b.indexOf(h.id):-1,z=o.useRef(b),E=!Ir(b,z.current),T=C!==-1&&j===-1||E,M=Or(l);De(()=>{E&&k&&m(b)},[E,b,k,m]),o.useEffect(()=>{z.current=b},[b]);const L=o.useMemo(()=>({activeIndex:j,containerId:f,disabled:M,disableTransforms:T,items:b,overIndex:C,useDragOverlay:w,sortedRects:Mr(b,u),strategy:a}),[j,f,M.draggable,M.droppable,T,b,C,u,w,a]);return he.createElement(Pn.Provider,{value:L},t)}const $r=e=>{let{id:t,items:s,activeIndex:r,overIndex:a}=e;return Qt(s,r,a).indexOf(t)},Fr=e=>{let{containerId:t,isSorting:s,wasDragging:r,index:a,items:l,newIndex:c,previousItems:d,previousContainerId:u,transition:h}=e;return!h||!r||d!==l&&a===c?!1:s?!0:c!==a&&t===u},Pr={duration:200,easing:"ease"},Bn="transform",Br=it.Transition.toString({property:Bn,duration:0,easing:"linear"}),qr={roleDescription:"sortable"};function Wr(e){let{disabled:t,index:s,node:r,rect:a}=e;const[l,c]=o.useState(null),d=o.useRef(s);return De(()=>{if(!t&&s!==d.current&&r.current){const u=a.current;if(u){const h=Ve(r.current,{ignoreTransform:!0}),m={x:u.left-h.left,y:u.top-h.top,scaleX:u.width/h.width,scaleY:u.height/h.height};(m.x||m.y)&&c(m)}}s!==d.current&&(d.current=s)},[t,s,r,a]),o.useEffect(()=>{l&&c(null)},[l]),l}function Ur(e){let{animateLayoutChanges:t=Fr,attributes:s,disabled:r,data:a,getNewIndex:l=$r,id:c,strategy:d,resizeObserverConfig:u,transition:h=Pr}=e;const{items:m,containerId:f,activeIndex:w,disabled:b,disableTransforms:k,sortedRects:j,overIndex:C,useDragOverlay:z,strategy:E}=o.useContext(Pn),T=_r(r,b),M=m.indexOf(c),L=o.useMemo(()=>({sortable:{containerId:f,index:M,items:m},...a}),[f,a,M,m]),v=o.useMemo(()=>m.slice(m.indexOf(c)),[m,c]),{rect:I,node:D,isOver:_,setNodeRef:$}=kr({id:c,data:L,disabled:T.droppable,resizeObserverConfig:{updateMeasurementsFor:v,...u}}),{active:W,activatorEvent:X,activeNodeRect:Q,attributes:ee,setNodeRef:F,listeners:N,isDragging:S,over:U,setActivatorNodeRef:oe,transform:K}=Sr({id:c,data:L,attributes:{...qr,...s},disabled:T.draggable}),Ee=ls($,F),V=!!W,me=V&&!k&&pt(w)&&pt(C),ge=!z&&S,Te=ge&&me?K:null,xe=me?Te??(d??E)({rects:j,activeNodeRect:Q,activeIndex:w,overIndex:C,index:M}):null,re=pt(w)&&pt(C)?l({id:c,items:m,activeIndex:w,overIndex:C}):M,ce=W==null?void 0:W.id,q=o.useRef({activeId:ce,items:m,newIndex:re,containerId:f}),ke=m!==q.current.items,be=t({active:W,containerId:f,isDragging:S,isSorting:V,id:c,index:M,items:m,newIndex:q.current.newIndex,previousItems:q.current.items,previousContainerId:q.current.containerId,transition:h,wasDragging:q.current.activeId!=null}),Se=Wr({disabled:!be,index:M,node:D,rect:I});return o.useEffect(()=>{V&&q.current.newIndex!==re&&(q.current.newIndex=re),f!==q.current.containerId&&(q.current.containerId=f),m!==q.current.items&&(q.current.items=m)},[V,re,f,m]),o.useEffect(()=>{if(ce===q.current.activeId)return;if(ce!=null&&q.current.activeId==null){q.current.activeId=ce;return}const Me=setTimeout(()=>{q.current.activeId=ce},50);return()=>clearTimeout(Me)},[ce]),{active:W,activeIndex:w,attributes:ee,data:L,rect:I,index:M,newIndex:re,items:m,isOver:_,isSorting:V,isDragging:S,listeners:N,node:D,overIndex:C,over:U,setNodeRef:Ee,setActivatorNodeRef:oe,setDroppableNodeRef:$,setDraggableNodeRef:F,transform:Se??xe,transition:ve()};function ve(){if(Se||ke&&q.current.newIndex===M)return Br;if(!(ge&&!Yt(X)||!h)&&(V||be))return it.Transition.toString({...h,property:Bn})}}function _r(e,t){var s,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(s=e==null?void 0:e.draggable)!=null?s:t.draggable,droppable:(r=e==null?void 0:e.droppable)!=null?r:t.droppable}}function Ct(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const Xr=[P.Down,P.Right,P.Up,P.Left],Hr=(e,t)=>{let{context:{active:s,collisionRect:r,droppableRects:a,droppableContainers:l,over:c,scrollableAncestors:d}}=t;if(Xr.includes(e.code)){if(e.preventDefault(),!s||!r)return;const u=[];l.getEnabled().forEach(f=>{if(!f||f!=null&&f.disabled)return;const w=a.get(f.id);if(w)switch(e.code){case P.Down:r.top<w.top&&u.push(f);break;case P.Up:r.top>w.top&&u.push(f);break;case P.Left:r.left>w.left&&u.push(f);break;case P.Right:r.left<w.left&&u.push(f);break}});const h=Cs({active:s,collisionRect:r,droppableRects:a,droppableContainers:u,pointerCoordinates:null});let m=Cn(h,"id");if(m===(c==null?void 0:c.id)&&h.length>1&&(m=h[1].id),m!=null){const f=l.get(s.id),w=l.get(m),b=w?a.get(w.id):null,k=w==null?void 0:w.node.current;if(k&&b&&f&&w){const C=St(k).some((v,I)=>d[I]!==v),z=qn(f,w),E=Vr(f,w),T=C||!z?{x:0,y:0}:{x:E?r.width-b.width:0,y:E?r.height-b.height:0},M={x:b.left,y:b.top};return T.x&&T.y?M:at(M,T)}}}};function qn(e,t){return!Ct(e)||!Ct(t)?!1:e.data.current.sortable.containerId===t.data.current.sortable.containerId}function Vr(e,t){return!Ct(e)||!Ct(t)||!qn(e,t)?!1:e.data.current.sortable.index<t.data.current.sortable.index}const Yr=({msg:e,index:t,onDelete:s})=>{const{attributes:r,listeners:a,setNodeRef:l,transform:c,transition:d,isDragging:u}=Ur({id:e.id||t}),h={transform:it.Transform.toString(c),transition:d,opacity:u?.5:1};return n.jsxs("div",{ref:l,style:h,className:`border rounded-lg p-3 cursor-move hover:bg-white/10 transition-all ${e.isCurrentlyTriggered?"bg-green-500/10 border-green-400/30":"bg-white/5 border-white/10"}`,...r,...a,children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:`w-6 h-6 rounded -full flex items-center justify-center text-xs text-white ${e.isCurrentlyTriggered?"bg-green-600":"bg-gray-600"}`,children:t+1}),n.jsxs(p,{size:"sm",className:`font-bold ${e.isCurrentlyTriggered?"text-green-400":"text-gray-400"}`,children:[e.source,e.isCurrentlyTriggered&&n.jsx("span",{className:"ml-1 text-xs",children:"(當前觸發)"})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:`px-2 py-1 rounded text-xs ${e.type==="custom"?"bg-purple-500/20 text-purple-400":e.type==="schedule"?"bg-blue-500/20 text-blue-400":e.type==="normal"?"bg-orange-500/20 text-orange-400":"bg-gray-500/20 text-gray-400"}`,children:e.type==="custom"?"自定義規則":e.type==="schedule"?"班表模板":e.type==="normal"?"普通對話":"其他"}),s&&n.jsx(H,{onClick:m=>{m.stopPropagation(),m.preventDefault(),s(t,e.id)},variant:"ghost",size:"sm",className:"p-1 text-red-400 hover:text-red-300",title:"刪除",children:n.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),n.jsx(p,{className:`${e.isCurrentlyTriggered?"text-green-200":"text-white"}`,children:e.message})]})},Kr=({customRules:e=[],scheduleTemplates:t=[],onRulesChange:s,onTemplatesChange:r,isSaving:a=!1,scheduleData:l=null,speechTexts:c=[],onSpeechTextsChange:d,showBubble:u=!1,onShowBubbleChange:h,intervalSeconds:m=4,onIntervalSecondsChange:f,smartMode:w=!1,onSmartModeChange:b})=>{const[k,j]=o.useState(!1),[C,z]=o.useState(null),[E,T]=o.useState("custom"),[M,L]=o.useState(!1),[v,I]=o.useState({name:"",type:"timeRange",startTime:"08:00",endTime:"10:00",day:"一",month:1,date:1,allDay:!1,messages:[""],enabled:!0}),[D,_]=o.useState(null),[$,W]=o.useState({}),[X,Q]=o.useState(!1),[ee,F]=o.useState(!1),[N,S]=o.useState(new Set);o.useEffect(()=>{l?_(l):(async()=>{try{Q(!0);const g=await et(Ce(ye,"schedule","currentMonth")),x=await et(Ce(ye,"schedule","nextMonth"));let y=null;g.exists()?y=g.data():x.exists()&&(y=x.data()),_(y)}catch(g){console.error("載入班表資料失敗:",g)}finally{Q(!1)}})()},[l]),o.useEffect(()=>{(async()=>{try{F(!0);const g=await Xn(Hn(ye,"names")),x={};g.forEach(y=>{const A=y.data();A.name&&(x[y.id]=A.name)}),W(x)}catch(g){console.error("載入同事姓名資料失敗:",g)}finally{F(!1)}})()},[]),o.useEffect(()=>{(async()=>{try{const g=await et(Ce(ye,"catSpeech","dialogueOrder"));if(g.exists()){const y=g.data();if(y.dialogues&&Array.isArray(y.dialogues)){xe(y.dialogues),ke(y.lastUpdated?new Date(y.lastUpdated).toLocaleString():"未知");return}}const x=localStorage.getItem("dialogueOrder");if(x){const y=JSON.parse(x);xe(y)}}catch(g){console.error("載入對話排序失敗:",g);try{const x=localStorage.getItem("dialogueOrder");if(x){const y=JSON.parse(x);xe(y)}}catch(x){console.error("本地備份載入也失敗:",x)}}})()},[]);const U=o.useMemo(()=>{const i=Ze(D,e,t,$),g=[];i.forEach((R,O)=>{g.push({...R,id:R.id||`${R.type}-${R.message.substring(0,10)}`,priority:3,isCurrentlyTriggered:!0})}),c.filter(R=>R.trim()!=="").forEach((R,O)=>{g.push({id:`normal-${R}`,type:"normal",priority:999,message:R,source:"普通對話",isNormal:!0,isCurrentlyTriggered:!1})});const y=[],A=new Set;return g.forEach(R=>{!A.has(R.id)&&!N.has(R.id)&&(A.add(R.id),y.push(R))}),y},[e,t,D,$,c,N]);o.useEffect(()=>{U.length>0&&xe(i=>{if(i.length===0)return U;const g=new Set(i.map(R=>R.id)),x=new Set(U.map(R=>R.id)),y=i.filter(R=>!N.has(R.id)&&x.has(R.id)),A=U.filter(R=>!g.has(R.id));return[...y,...A]})},[U,N]);const oe=i=>{if(!i||typeof i!="object")return[];const g=[],x=new Date,y=x.getFullYear(),A=x.getMonth()+1,R=x.getDate();for(const[O,te]of Object.entries(i))if(O!=="_lastUpdated"&&te&&typeof te=="object"){for(const[ae,J]of Object.entries(te))if(J&&J.trim()&&J!=="休假"&&J!=="特休"&&J!=="月休"){const ue=parseInt(ae);ue===R&&g.push({id:`${O}_${ue}`,date:`${y}-${String(A).padStart(2,"0")}-${String(ue).padStart(2,"0")}`,shift:J,employee:O})}}return g},[K,Ee]=o.useState({name:"",message:"",enabled:!0,timeRestriction:!1,startTime:"08:00",endTime:"10:00"}),[V,me]=o.useState(null),[ge,Te]=o.useState(""),[se,xe]=o.useState([]),[re,ce]=o.useState(""),[q,ke]=o.useState(""),be=ws(tn(Zt),tn(Gt,{coordinateGetter:Hr})),Se=async()=>{if(ge.trim()&&d){const i=[...c,ge.trim()];try{await d(i),Te("")}catch(g){console.error("添加對話失敗:",g)}}},ve=async i=>{if(d){const g=c.filter((x,y)=>y!==i);try{await d(g)}catch(x){console.error("刪除對話失敗:",x)}}},Me=i=>{const{active:g,over:x}=i;g.id!==x.id&&xe(y=>{const A=y.findIndex(O=>O.id===g.id),R=y.findIndex(O=>O.id===x.id);return Qt(y,A,R)})},Ie=(i,g)=>{!g&&se[i]&&(g=se[i].id),g&&(S(x=>new Set([...x,g])),xe(x=>x.filter((y,A)=>A!==i)))},ut=async()=>{try{ce("保存中...");const i={dialogues:se,lastUpdated:new Date().toISOString(),version:"1.0"};await _t(Ce(ye,"catSpeech","dialogueOrder"),i),localStorage.setItem("dialogueOrder",JSON.stringify(se)),ce("保存成功！"),ke(new Date().toLocaleString()),setTimeout(()=>{ce("")},3e3)}catch(i){ce("保存失敗"),console.error("保存對話排序失敗:",i),setTimeout(()=>{ce("")},3e3)}},ht=()=>{S(new Set);const i=Ze(D,e,t,$),g=i.map(O=>O.message).filter(O=>O&&typeof O=="string"&&O.trim()!==""),x=c.filter(O=>O&&typeof O=="string"&&O.trim()!==""&&!g.includes(O)),y=[...i.map(O=>({...O,id:`smart-${O.source}-${O.message.substring(0,10)}`,isNormal:!1})),...x.map(O=>({id:`normal-${O.substring(0,10)}`,type:"normal",priority:999,message:O,source:"普通對話",isNormal:!0}))],A=[],R=new Set;for(const O of y)R.has(O.message)||(A.push(O),R.add(O.message));xe(A)},Be=()=>{Ee({name:"",message:"",enabled:!0,timeRestriction:!1,startTime:"08:00",endTime:"10:00"}),me(null),j(!1)},de=(i,g)=>{Ee(x=>({...x,[i]:g}))},qe=(i,g)=>{const x=new Date,y=x.getHours(),A=x.getMinutes(),R=y*60+A,[O,te]=i.split(":").map(Number),[ae,J]=g.split(":").map(Number),ue=O*60+te,Y=ae*60+J;return Y<ue?R>=ue||R<=Y:R>=ue&&R<=Y},Fe=()=>{I({name:"",type:"timeRange",startTime:"08:00",endTime:"10:00",day:"一",month:1,date:1,allDay:!1,messages:[""],enabled:!0}),z(null),j(!1)},G=(i,g)=>{I(x=>({...x,[i]:g}))},ft=(i,g)=>{const x=[...v.messages];x[i]=g,I(y=>({...y,messages:x}))},Tt=()=>{I(i=>({...i,messages:[...i.messages,""]}))},kt=i=>{if(v.messages.length>1){const g=v.messages.filter((x,y)=>y!==i);I(x=>({...x,messages:g}))}},Oe=()=>{if(!v.name.trim()){alert("請填寫規則名稱");return}const i=v.messages.filter(y=>y&&typeof y=="string"&&y.trim()!=="");if(i.length===0){alert("請至少添加一個對話內容");return}const g={id:C?C.id:Date.now().toString(),...v,messages:i};if(!Vn(g)){alert("規則設定有誤，請檢查時間格式");return}let x;C?x=e.map(y=>y.id===C.id?g:y):x=[...e,g],s(x),Fe()},ze=i=>{if(window.confirm("確定要刪除這個規則嗎？")){const g=e.filter(x=>x.id!==i);s(g)}},Pe=i=>{const g=e.map(x=>x.id===i?{...x,enabled:!x.enabled}:x);s(g)},mt=i=>{I({name:i.name,type:i.type,startTime:i.startTime||"08:00",endTime:i.endTime||"10:00",day:i.day||"一",month:i.month||1,date:i.date||1,allDay:i.allDay||!1,messages:i.messages||[""],enabled:i.enabled}),z(i),j(!0)},je=()=>{window.confirm("確定要載入預設規則嗎？這會覆蓋現有的自定義規則。")&&s(Yn())},gt=()=>{if(!K.name.trim()){alert("請填寫模板名稱");return}if(!K.message.trim()){alert("請填寫問候語內容");return}const i={id:V?V.id:Date.now().toString(),...K};if(!Kn(i)){alert("模板設定有誤，請檢查內容");return}let g;V?g=t.map(x=>x.id===V.id?i:x):g=[...t,i],r(g),Be()},Mt=i=>{if(window.confirm("確定要刪除這個模板嗎？")){const g=t.filter(x=>x.id!==i);r(g)}},It=i=>{const g=t.map(x=>x.id===i?{...x,enabled:!x.enabled}:x);r(g)},Ye=i=>{Ee({name:i.name,message:i.message,enabled:i.enabled,timeRestriction:i.timeRestriction||!1,startTime:i.startTime||"08:00",endTime:i.endTime||"10:00"}),me(i),j(!0)},xt=()=>{const i=Gn();r(i)},Ot=()=>{if(X){alert("請稍候，正在載入班表資料...");return}if(ee){alert("請稍候，正在載入姓名資料...");return}if(!D){alert("無班表資料，無法預覽所有智能對話。");return}Object.keys($).length===0&&alert("無姓名資料，將顯示職員編號。");const i=Ze(D,e,t,$),g=i.map((x,y)=>`${y+1}. [${x.source}] ${x.message}`).join(`

`);i.length===0?alert(`目前沒有觸發的智能對話。

只會播放您設定的普通對話。`):alert(`智能對話預覽 (共${i.length}條)：

${g}

注意：這些對話會與您設定的普通對話一起輪流播放。`)},bt=()=>{switch(v.type){case"timeRange":return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",id:"allDay",checked:v.allDay,onChange:i=>G("allDay",i.target.checked),disabled:a,className:"w-5 h-5 disabled:opacity-50"}),n.jsx(B,{htmlFor:"allDay",className:"!mb-0",children:"全天（24小時）"})]}),!v.allDay&&n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx(B,{htmlFor:"startTime",required:!0,children:"開始時間"}),n.jsx(ie,{id:"startTime",type:"time",value:v.startTime,onChange:i=>G("startTime",i.target.value),disabled:a})]}),n.jsxs("div",{children:[n.jsx(B,{htmlFor:"endTime",required:!0,children:"結束時間"}),n.jsx(ie,{id:"endTime",type:"time",value:v.endTime,onChange:i=>G("endTime",i.target.value),disabled:a})]})]})]});case"dayOfWeek":return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(B,{htmlFor:"daySelect",required:!0,children:"星期幾"}),n.jsxs("select",{id:"daySelect",value:v.day,onChange:i=>G("day",i.target.value),disabled:a,className:"w-full p-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary/50 disabled:opacity-50",children:[n.jsx("option",{value:"一",children:"星期一"}),n.jsx("option",{value:"二",children:"星期二"}),n.jsx("option",{value:"三",children:"星期三"}),n.jsx("option",{value:"四",children:"星期四"}),n.jsx("option",{value:"五",children:"星期五"}),n.jsx("option",{value:"六",children:"星期六"}),n.jsx("option",{value:"日",children:"星期日"})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",id:"allDay",checked:v.allDay,onChange:i=>G("allDay",i.target.checked),disabled:a,className:"w-5 h-5 disabled:opacity-50"}),n.jsx(B,{htmlFor:"allDay",className:"!mb-0",children:"全天（24小時）"})]}),!v.allDay&&n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx(B,{htmlFor:"startTime",required:!0,children:"開始時間"}),n.jsx(ie,{id:"startTime",type:"time",value:v.startTime,onChange:i=>G("startTime",i.target.value),disabled:a})]}),n.jsxs("div",{children:[n.jsx(B,{htmlFor:"endTime",required:!0,children:"結束時間"}),n.jsx(ie,{id:"endTime",type:"time",value:v.endTime,onChange:i=>G("endTime",i.target.value),disabled:a})]})]})]});case"specificDate":return n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx(B,{htmlFor:"month",required:!0,children:"月份"}),n.jsx(ie,{id:"month",type:"number",min:"1",max:"12",value:v.month||"",onChange:i=>{const g=i.target.value,x=g===""?1:parseInt(g);G("month",isNaN(x)?1:x)},disabled:a})]}),n.jsxs("div",{children:[n.jsx(B,{htmlFor:"date",required:!0,children:"日期"}),n.jsx(ie,{id:"date",type:"number",min:"1",max:"31",value:v.date||"",onChange:i=>{const g=i.target.value,x=g===""?1:parseInt(g);G("date",isNaN(x)?1:x)},disabled:a})]})]});case"monthlyDate":return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(B,{htmlFor:"monthlyDate",required:!0,children:"每月幾號"}),n.jsx("div",{className:"grid grid-cols-7 gap-1 bg-white/5 rounded-lg p-3 border border-white/10",children:Array.from({length:31},(i,g)=>g+1).map(i=>n.jsx("button",{type:"button",onClick:()=>G("date",i),disabled:a,className:`p-2 text-sm rounded transition-colors ${v.date===i?"bg-primary text-white":"bg-white/10 text-gray-300 hover:bg-white/20"} disabled:opacity-50`,children:i},i))})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",id:"allDay",checked:v.allDay,onChange:i=>G("allDay",i.target.checked),disabled:a,className:"w-5 h-5 disabled:opacity-50"}),n.jsx(B,{htmlFor:"allDay",className:"!mb-0",children:"全天（24小時）"})]}),!v.allDay&&n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx(B,{htmlFor:"startTime",required:!0,children:"開始時間"}),n.jsx(ie,{id:"startTime",type:"time",value:v.startTime,onChange:i=>G("startTime",i.target.value),disabled:a})]}),n.jsxs("div",{children:[n.jsx(B,{htmlFor:"endTime",required:!0,children:"結束時間"}),n.jsx(ie,{id:"endTime",type:"time",value:v.endTime,onChange:i=>G("endTime",i.target.value),disabled:a})]})]})]});default:return null}};return n.jsxs(We,{children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx(le,{level:2,gradient:!0,children:"智能對話規則管理"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(H,{onClick:Ot,variant:"secondary",size:"sm",disabled:a||X||ee,children:"預覽所有對話"}),n.jsx(H,{onClick:()=>j(!0),variant:"primary",size:"sm",disabled:a,children:"添加規則"})]})]}),n.jsxs("div",{className:"bg-orange-500/10 border border-orange-500/20 rounded-lg p-4 mb-6",children:[n.jsx(le,{level:3,className:"text-orange-400 mb-4",children:"基本設定"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",id:"bubbleToggle",checked:u,disabled:a,onChange:i=>h&&h(i.target.checked),className:"w-5 h-5 disabled:opacity-50"}),n.jsx(B,{htmlFor:"bubbleToggle",className:"!mb-0",children:"顯示對話輪播"})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",id:"smartModeToggle",checked:w,disabled:a,onChange:()=>b&&b(!w),className:"w-5 h-5 disabled:opacity-50"}),n.jsx(B,{htmlFor:"smartModeToggle",className:"!mb-0",children:"智能模式（根據自定義規則和班表問候自動顯示對話）"})]}),n.jsxs("div",{children:[n.jsxs(B,{htmlFor:"intervalSlider",children:["輪播間隔 (",m,"秒)"]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"range",id:"intervalSlider",min:"1",max:"10",value:m,disabled:a,onChange:i=>f&&f(parseInt(i.target.value)),className:"flex-1 h-2 bg-white/10 rounded-lg appearance-none cursor-pointer slider disabled:opacity-50"}),n.jsxs("span",{className:"text-white min-w-[3rem] text-center",children:[m,"s"]})]}),n.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[n.jsx("span",{children:"1秒"}),n.jsx("span",{children:"10秒"})]})]})]})]}),n.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-4 mb-6",children:[n.jsx(le,{level:3,className:"text-blue-400 mb-2",children:"資料載入狀態"}),n.jsx(p,{size:"sm",className:"text-blue-300",children:X?"載入班表中...":D?`班表資料：${Object.keys(D).filter(i=>i!=="_lastUpdated").length} 位同事`:"班表資料：未載入"}),D&&D._lastUpdated&&n.jsxs(p,{size:"sm",className:"text-blue-300 mt-1",children:["最後更新：",new Date(D._lastUpdated).toLocaleString()]}),n.jsx(p,{size:"sm",className:"text-blue-300 mt-1",children:ee?"載入姓名中...":Object.keys($).length>0?`姓名對應：${Object.keys($).length} 位同事`:"姓名對應：未載入"})]}),n.jsxs("div",{className:"flex border-b border-white/10 mb-6",children:[n.jsxs("button",{onClick:()=>T("custom"),className:`px-4 py-2 text-sm font-medium transition-colors ${E==="custom"?"text-primary border-b-2 border-primary":"text-text-secondary hover:text-text-primary"}`,children:["自定義規則 (",e.length,")"]}),n.jsxs("button",{onClick:()=>T("schedule"),className:`px-4 py-2 text-sm font-medium transition-colors ${E==="schedule"?"text-primary border-b-2 border-primary":"text-text-secondary hover:text-text-primary"}`,children:["班表問候模板 (",t.length,")"]}),n.jsxs("button",{onClick:()=>T("dialogue"),className:`px-4 py-2 text-sm font-medium transition-colors ${E==="dialogue"?"text-primary border-b-2 border-primary":"text-text-secondary hover:text-text-primary"}`,children:["對話管理 (",c.length,")"]})]}),E==="custom"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/20 rounded-lg p-4 mb-6",children:[n.jsx(le,{level:3,className:"text-purple-400 mb-2",children:"自定義規則說明"}),n.jsx(p,{size:"sm",className:"text-purple-300",children:"可以設定特定時間範圍、星期幾或特定日期的對話規則，系統會根據條件自動顯示對話。"})]}),k&&n.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4 mb-6",children:[n.jsx(le,{level:3,className:"mb-4",children:C?"編輯規則":"添加新規則"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(B,{htmlFor:"ruleName",required:!0,children:"規則名稱"}),n.jsx(ie,{id:"ruleName",value:v.name,onChange:i=>G("name",i.target.value),placeholder:"例如：早上問候",disabled:a})]}),n.jsxs("div",{children:[n.jsx(B,{htmlFor:"ruleType",required:!0,children:"規則類型"}),n.jsxs("select",{id:"ruleType",value:v.type,onChange:i=>G("type",i.target.value),disabled:a,className:"w-full p-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary/50 disabled:opacity-50",children:[n.jsx("option",{value:"timeRange",children:"時間範圍"}),n.jsx("option",{value:"dayOfWeek",children:"星期幾"}),n.jsx("option",{value:"specificDate",children:"特定日期"}),n.jsx("option",{value:"monthlyDate",children:"每月幾號"})]})]}),bt(),n.jsxs("div",{children:[n.jsxs(B,{required:!0,children:["對話內容 (",v.messages.length,"條)"]}),n.jsxs("div",{className:"space-y-2",children:[v.messages.map((i,g)=>n.jsxs("div",{className:"flex gap-2",children:[n.jsx(ie,{value:i,onChange:x=>ft(g,x.target.value),placeholder:`對話 ${g+1}...`,disabled:a}),n.jsx(H,{onClick:()=>kt(g),variant:"danger",size:"sm",disabled:a||v.messages.length<=1,className:"px-3",children:"刪除"})]},g)),n.jsx(H,{onClick:Tt,variant:"secondary",size:"sm",disabled:a,className:"w-full",children:"添加對話"})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",id:"ruleEnabled",checked:v.enabled,onChange:i=>G("enabled",i.target.checked),disabled:a,className:"w-5 h-5 disabled:opacity-50"}),n.jsx(B,{htmlFor:"ruleEnabled",className:"!mb-0",children:"啟用此規則"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(H,{onClick:Oe,variant:"primary",disabled:a,loading:a,children:C?"更新規則":"添加規則"}),n.jsx(H,{onClick:Fe,variant:"secondary",disabled:a,children:"取消"})]})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs(B,{children:["現有規則 (",e.length,"條)"]}),n.jsx(H,{onClick:je,variant:"secondary",size:"sm",disabled:a,children:"載入預設"})]}),e.length===0?n.jsx(p,{color:"secondary",className:"text-center py-8",children:"暫無自定義規則"}):e.map(i=>{var g,x;return n.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",checked:i.enabled,onChange:()=>Pe(i.id),disabled:a,className:"w-4 h-4 disabled:opacity-50"}),n.jsx(le,{level:4,className:"!mb-0",children:i.name}),n.jsx("span",{className:`px-2 py-1 rounded text-xs ${i.enabled?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,children:i.enabled?"啟用":"停用"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(H,{onClick:()=>mt(i),variant:"ghost",size:"sm",disabled:a,children:"編輯"}),n.jsx(H,{onClick:()=>ze(i.id),variant:"danger",size:"sm",disabled:a,children:"刪除"})]})]}),n.jsxs(p,{size:"sm",color:"secondary",className:"mb-2",children:["類型：",i.type==="timeRange"?"時間範圍":i.type==="dayOfWeek"?"星期幾":i.type==="specificDate"?"特定日期":i.type==="monthlyDate"?"每月幾號":"未知類型"]}),i.type==="timeRange"&&n.jsxs(p,{size:"sm",color:"secondary",className:"mb-2",children:["時間：",i.allDay?"全天":`${i.startTime} - ${i.endTime}`]}),i.type==="dayOfWeek"&&n.jsxs(p,{size:"sm",color:"secondary",className:"mb-2",children:["星期",i.day," ",i.allDay?"全天":`${i.startTime} - ${i.endTime}`]}),i.type==="specificDate"&&n.jsxs(p,{size:"sm",color:"secondary",className:"mb-2",children:[i.month,"月",i.date,"日"]}),i.type==="monthlyDate"&&n.jsxs(p,{size:"sm",color:"secondary",className:"mb-2",children:["每月",i.date,"日 ",i.allDay?"全天":`${i.startTime} - ${i.endTime}`]}),n.jsxs(p,{size:"sm",color:"secondary",className:"mb-2",children:["對話數量：",((g=i.messages)==null?void 0:g.length)||0," 條"]}),n.jsx("div",{className:"space-y-1",children:(x=i.messages)==null?void 0:x.map((y,A)=>n.jsx(p,{className:"bg-white/5 rounded p-2 text-sm",children:y},A))})]},i.id)})]})]}),E==="schedule"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"mb-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx(le,{level:3,className:"text-blue-400",children:"可用變數說明"}),n.jsxs(H,{onClick:()=>L(!M),variant:"secondary",size:"sm",className:"flex items-center gap-2",children:[M?"隱藏說明":"顯示說明",n.jsx("span",{className:"text-xs",children:M?"▼":"▶"})]})]}),M&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[n.jsx(p,{size:"sm",className:"text-blue-300 font-bold mb-3 text-center",children:"📋 班次變數"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","{早班同事}"," - 早班同事名字"]}),n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","{中班同事}"," - 中班同事名字"]}),n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","{晚班同事}"," - 晚班同事名字"]}),n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","{所有同事}"," - 所有上班同事名字"]})]}),n.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[n.jsx(p,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"💡 使用範例："}),n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","{早班同事}，早安！"," → 小明、小華，早安！"]}),n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","{所有同事}，工作辛苦了！"," → 小明、小華、小美，工作辛苦了！"]})]})]}),n.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[n.jsx(p,{size:"sm",className:"text-blue-300 font-bold mb-3 text-center",children:"👥 人數變數"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","{早班人數}"," - 早班人數"]}),n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","{中班人數}"," - 中班人數"]}),n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","{晚班人數}"," - 晚班人數"]}),n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","{總人數}"," - 總上班人數"]})]}),n.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[n.jsx(p,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"💡 使用範例："}),n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","今天有{總人數}位同事上班"," → 今天有5位同事上班"]}),n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","早班{早班人數}人，晚班{晚班人數}人"," → 早班2人，晚班3人"]})]})]})]}),n.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[n.jsx(p,{size:"sm",className:"text-blue-300 font-bold mb-4 text-center",children:"⏰ 連續上班變數"}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx(p,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"🔧 基本變數"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","{連續上班同事}"," - 連續上班4-6天的同事（顯示名字+天數）"]}),n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","{連續上班同事數量}"," - 連續上班4-6天的同事數量"]})]})]}),n.jsxs("div",{children:[n.jsx(p,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"🎯 指定天數變數"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","{連續上班X天同事}"," - 指定天數的同事名字（X為數字，只顯示名字）"]}),n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","{連續上班X天同事數量}"," - 指定天數的同事數量"]})]})]})]}),n.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[n.jsx(p,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"💡 使用範例"}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","{連續上班同事}，辛苦了！"]}),n.jsx(p,{size:"sm",className:"text-gray-400 text-xs",children:"→ 小明連續上班5天、小華連續上班4天，辛苦了！"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","{連續上班6天同事}，請務必休息"]}),n.jsx(p,{size:"sm",className:"text-gray-400 text-xs",children:"→ 紅葉，請務必休息"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs(p,{size:"sm",className:"text-blue-300",children:["• ","今天有{連續上班同事數量}位同事需要關心"]}),n.jsx(p,{size:"sm",className:"text-gray-400 text-xs",children:"→ 今天有2位同事需要關心"})]})]})]}),n.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[n.jsx(p,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"⚙️ 功能說明"}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx(p,{size:"sm",className:"text-blue-300",children:"• 自動計算：從今天開始往前計算，遇到休假為止"}),n.jsx(p,{size:"sm",className:"text-blue-300",children:"• 智能顯示：沒有符合條件的同事時，模板不會顯示"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(p,{size:"sm",className:"text-blue-300",children:"• 適用場景：關心同事、提醒休息、表揚勤奮"}),n.jsx(p,{size:"sm",className:"text-blue-300",children:"• 注意事項：需要先在姓名管理中設定同事姓名對應"})]})]})]})]}),n.jsx("div",{className:"flex justify-center",children:n.jsx(H,{onClick:()=>j(!0),variant:"primary",size:"sm",disabled:a,children:"添加規則"})})]})]}),k&&n.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4 mb-6",children:[n.jsx(le,{level:3,className:"mb-4",children:V?"編輯模板":"添加新模板"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(B,{htmlFor:"templateName",required:!0,children:"模板名稱"}),n.jsx(ie,{id:"templateName",value:K.name,onChange:i=>de("name",i.target.value),placeholder:"例如：早班問候",disabled:a})]}),n.jsxs("div",{children:[n.jsx(B,{htmlFor:"templateMessage",required:!0,children:"問候語內容"}),n.jsx(ie,{id:"templateMessage",value:K.message,onChange:i=>de("message",i.target.value),placeholder:"例如：{早班同事}，早安！今天也要加油喔！",disabled:a})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",id:"templateEnabled",checked:K.enabled,onChange:i=>de("enabled",i.target.checked),disabled:a,className:"w-5 h-5 disabled:opacity-50"}),n.jsx(B,{htmlFor:"templateEnabled",className:"!mb-0",children:"啟用此模板"})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",id:"timeRestriction",checked:K.timeRestriction,onChange:i=>de("timeRestriction",i.target.checked),disabled:a,className:"w-5 h-5 disabled:opacity-50"}),n.jsx(B,{htmlFor:"timeRestriction",className:"!mb-0",children:"啟用時間限制"})]}),K.timeRestriction&&n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx(B,{htmlFor:"startTime",required:!0,children:"限制開始時間"}),n.jsx(ie,{id:"startTime",type:"time",value:K.startTime,onChange:i=>de("startTime",i.target.value),disabled:a})]}),n.jsxs("div",{children:[n.jsx(B,{htmlFor:"endTime",required:!0,children:"限制結束時間"}),n.jsx(ie,{id:"endTime",type:"time",value:K.endTime,onChange:i=>de("endTime",i.target.value),disabled:a})]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(H,{onClick:gt,variant:"primary",disabled:a,loading:a,children:V?"更新模板":"添加模板"}),n.jsx(H,{onClick:Be,variant:"secondary",disabled:a,children:"取消"})]})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs(B,{children:["現有模板 (",t.length,"條)"]}),n.jsx(H,{onClick:xt,variant:"secondary",size:"sm",disabled:a,children:"載入預設"})]}),t.length===0?n.jsx(p,{color:"secondary",className:"text-center py-8",children:"暫無班表問候模板"}):t.map(i=>n.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",checked:i.enabled,onChange:()=>It(i.id),disabled:a,className:"w-4 h-4 disabled:opacity-50"}),n.jsx(le,{level:4,className:"!mb-0",children:i.name}),n.jsx("span",{className:`px-2 py-1 rounded text-xs ${i.enabled?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,children:i.enabled?"啟用":"停用"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(H,{onClick:()=>Ye(i),variant:"ghost",size:"sm",disabled:a,children:"編輯"}),n.jsx(H,{onClick:()=>Mt(i.id),variant:"danger",size:"sm",disabled:a,children:"刪除"})]})]}),n.jsxs(p,{size:"sm",color:"secondary",className:"mb-2",children:["原始模板：",i.message]}),i.timeRestriction&&n.jsxs(p,{size:"sm",color:"secondary",className:"mb-2",children:["時間限制：",i.startTime," - ",i.endTime]})]},i.id))]})]}),E==="dialogue"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"space-y-4 mb-6",children:[n.jsx(B,{htmlFor:"newMessage",children:"添加新對話"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(ie,{id:"newMessage",type:"text",value:ge,onChange:i=>Te(i.target.value),disabled:a,placeholder:"輸入新對話內容...",onKeyPress:i=>i.key==="Enter"&&!a&&Se()}),n.jsx(H,{onClick:()=>Se(),disabled:a||!ge.trim(),loading:a,children:a?"添加中...":"添加"})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs(B,{children:["對話列表 (",c.length,"條)"]}),n.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2 border border-white/10 rounded-lg p-3",children:c.length===0?n.jsx(p,{color:"secondary",className:"text-center py-4",children:"暫無對話內容"}):c.map((i,g)=>n.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-lg",children:[n.jsx(p,{className:"flex-1",children:i}),n.jsx(H,{onClick:()=>ve(g),variant:"ghost",size:"sm",disabled:a,className:"p-1 text-red-400 hover:text-red-300",title:"刪除",children:n.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},g))})]})]}),n.jsxs("div",{className:"mt-8 bg-gradient-to-r from-purple-500/10 to-blue-500/10 border border-purple-500/20 rounded-lg p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx(le,{level:3,className:"text-purple-400",children:"當前激活對話列表"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(H,{onClick:ut,variant:"ghost",size:"sm",disabled:re==="保存中...",className:"px-3 py-1 text-green-400 hover:text-green-300 border border-green-400/30 hover:border-green-400/50",children:re==="保存中..."?"保存中...":"保存排序"}),n.jsx(H,{onClick:ht,variant:"ghost",size:"sm",className:"px-3 py-1 text-blue-400 hover:text-blue-300 border border-blue-400/30 hover:border-blue-400/50",children:"重置排序"})]})]}),n.jsxs("div",{className:"mb-4 p-3 bg-blue-500/10 border border-blue-400/20 rounded-lg",children:[n.jsx(p,{size:"sm",className:"text-blue-300 text-center",children:"💡 拖拽對話項目可以調整顯示順序"}),q&&n.jsxs(p,{size:"sm",className:"text-gray-400 text-center mt-1",children:["最後更新：",q]})]}),re&&n.jsx("div",{className:`mb-4 p-3 rounded-lg border ${re==="保存成功！"?"bg-green-500/10 border-green-400/20":re==="保存失敗"?"bg-red-500/10 border-red-400/20":"bg-yellow-500/10 border-yellow-400/20"}`,children:n.jsx(p,{size:"sm",className:`text-center ${re==="保存成功！"?"text-green-300":re==="保存失敗"?"text-red-300":"text-yellow-300"}`,children:re})}),n.jsx("div",{className:"space-y-3",children:(()=>{if(U.length===0)return n.jsx(p,{size:"sm",className:"text-gray-400 text-center py-4",children:"目前沒有任何對話"});let i=U;return n.jsx(Nr,{sensors:be,collisionDetection:Ns,onDragEnd:Me,children:n.jsx(Lr,{items:i.map(g=>g.id),strategy:zr,children:n.jsx("div",{className:"space-y-3",children:i.map((g,x)=>n.jsx(Yr,{msg:g,index:x,onDelete:Ie},g.id))})})})})()}),n.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10",children:[n.jsx(p,{size:"sm",className:"text-blue-300 font-bold mb-2",children:"詳細調試資訊："}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-xs text-gray-400",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{children:["班表資料：",D?"已載入":"未載入"]}),n.jsxs("div",{children:["姓名資料：",Object.keys($).length>0?`已載入 ${Object.keys($).length} 個`:"未載入"]}),n.jsxs("div",{children:["今天上班同事：",D?oe(D).length:0," 人"]}),n.jsxs("div",{children:["自定義規則：",e.filter(i=>i.enabled).length," 個啟用"]}),n.jsxs("div",{children:["班表模板：",t.filter(i=>i.enabled).length," 個啟用"]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{children:["智能對話：",Ze(D,e,t,$).length," 條"]}),n.jsxs("div",{children:["普通對話：",c.length," 條"]}),n.jsxs("div",{children:["總對話數：",Ze(D,e,t,$).length+c.length," 條"]}),n.jsxs("div",{children:["當前時間：",new Date().toLocaleString()]}),n.jsxs("div",{children:["星期：",new Date().toLocaleDateString("zh-TW",{weekday:"long"})]})]})]}),n.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10",children:[n.jsx(p,{size:"sm",className:"text-blue-300 font-bold mb-2",children:"連續上班天數："}),n.jsx("div",{className:"space-y-1 text-xs text-gray-400",children:(()=>{const i=Wn(D,$,1,30);if(i.length===0)return n.jsx("div",{className:"text-gray-500",children:"無連續上班同事"});const g={};return i.forEach(x=>{g[x.consecutiveDays]||(g[x.consecutiveDays]=[]),g[x.consecutiveDays].push(x.name)}),Object.entries(g).sort(([x],[y])=>parseInt(y)-parseInt(x)).map(([x,y])=>{const A=parseInt(x);let R="text-gray-300";return A>=6?R="text-red-400":A>=4&&(R="text-yellow-400"),n.jsxs("div",{className:"bg-white/5 rounded p-2 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsxs("span",{className:`font-semibold ${R}`,children:[x,"天："]}),n.jsx("span",{className:"text-gray-300 ml-1",children:y.join("、")})]}),A>=4&&n.jsx("span",{className:`text-xs px-2 py-1 rounded ${A>=6?"bg-red-500/20 text-red-300":"bg-yellow-500/20 text-yellow-300"}`,children:A>=6?"高風險":"注意"})]},x)})})()})]}),t.filter(i=>i.enabled).length>0&&n.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10",children:[n.jsx(p,{size:"sm",className:"text-blue-300 font-bold mb-2",children:"班表模板調試："}),n.jsx("div",{className:"space-y-1 text-xs text-gray-400",children:t.filter(i=>i.enabled).map((i,g)=>{const x=oe(D),y=Un(x,$),A=i.timeRestriction?qe(i.startTime,i.endTime):!0,R=_n(i,D,$),O=R&&typeof R=="string"&&R.trim()!=="";return n.jsxs("div",{className:"bg-white/5 rounded p-2",children:[n.jsxs("div",{children:["模板：",i.name]}),n.jsxs("div",{children:["時間限制：",i.timeRestriction?`${i.startTime}-${i.endTime}`:"無"]}),n.jsxs("div",{children:["時間檢查：",A?"通過":"不通過"]}),n.jsxs("div",{children:["會顯示：",O?"是":"否"]}),O&&n.jsxs("div",{children:["處理後：",R]}),n.jsxs("div",{children:["早班同事：",y.morning.join("、")||"無"]}),n.jsxs("div",{children:["中班同事：",y.afternoon.join("、")||"無"]}),n.jsxs("div",{children:["晚班同事：",y.evening.join("、")||"無"]})]},g)})})]})]})]})]})},Gr=({showBubble:e,onShowBubbleChange:t,speechTexts:s,onSpeechTextsChange:r,intervalSeconds:a,onIntervalSecondsChange:l,smartMode:c,onSmartModeChange:d,customRules:u,onCustomRulesChange:h,scheduleTemplates:m,onScheduleTemplatesChange:f,scheduleData:w,isSaving:b})=>n.jsx("div",{className:"space-y-6",children:n.jsx(Kr,{customRules:u,scheduleTemplates:m,onRulesChange:h,onTemplatesChange:f,isSaving:b,scheduleData:w,speechTexts:s,onSpeechTextsChange:r,showBubble:e,onShowBubbleChange:t,intervalSeconds:a,onIntervalSecondsChange:l,smartMode:c,onSmartModeChange:d})}),Jr=()=>{const[e,t]=o.useState(!1),[s,r]=o.useState(!1),[a,l]=o.useState(!1),[c,d]=o.useState(60),[u,h]=o.useState("60"),[m,f]=o.useState({}),[w,b]=o.useState({}),[k,j]=o.useState(!0),[C,z]=o.useState(!1),[E,T]=o.useState(""),[M,L]=o.useState("");o.useEffect(()=>gn(Ce(ye,"nowPlayingMarquee","global"),S=>{if(S.exists()){const U=S.data(),oe=U.speed||60,K=U.weatherPhrases||{};t(U.enabled||!1),r(U.showOnlyNowPlaying||!1),l(U.showOnlyNowPlayingStrict||!1),d(oe),h(oe.toString()),f(K),b(K)}else t(!1),r(!1),l(!1),d(60),h("60"),f({}),b({});j(!1),T("")},S=>{console.error("載入跑馬燈設定失敗:",S),T("載入設定失敗"),j(!1)}),[]);const v=async N=>{var S;try{z(!0),T(""),L("");const U={enabled:e,showOnlyNowPlaying:s,showOnlyNowPlayingStrict:a,speed:c,weatherPhrases:m,...N};await _t(Ce(ye,"nowPlayingMarquee","global"),{...U,lastUpdated:xn(),updatedBy:(S=Ue.currentUser)==null?void 0:S.uid}),L("設定已更新"),setTimeout(()=>L(""),3e3)}catch(U){console.error("更新設定失敗:",U),T("更新設定失敗")}finally{z(!1)}},I=async N=>{t(N),await v({enabled:N})},D=async N=>{r(N),await v({showOnlyNowPlaying:N})},_=async N=>{l(N),await v({showOnlyNowPlayingStrict:N})},$=async N=>{const S=Math.max(10,Math.min(300,parseInt(N)||60));d(S),h(S.toString()),await v({speed:S})},W=N=>{h(N.target.value)},X=async()=>{const N=parseInt(u);if(!isNaN(N)&&N>=10&&N<=300){const S=N;d(S),await v({speed:S})}else h(c.toString())},Q=N=>{N.key==="Enter"&&N.target.blur()},ee=(N,S)=>{b({...w,[N]:S})},F=async N=>{const S=w[N]||"";if(m[N]!==S){const U={...m,[N]:S};f(U),await v({weatherPhrases:U})}};return k?n.jsx("div",{className:"flex items-center justify-center py-8",children:n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):n.jsxs("div",{className:"space-y-6",children:[M&&n.jsx("div",{className:"bg-green-500/10 border border-green-500/30 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"text-green-400",children:"✓"}),n.jsx(p,{color:"success",children:M})]})}),E&&n.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"text-red-400",children:"✗"}),n.jsx(p,{color:"danger",children:E})]})}),n.jsx(We,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(le,{level:3,className:"mb-2",children:"跑馬燈總開關"}),n.jsx(p,{size:"sm",color:"secondary",className:"mb-4",children:"控制是否啟用跑馬燈功能"})]}),n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:e,onChange:N=>I(N.target.checked),disabled:C,className:"w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary"}),n.jsx(p,{children:"啟用跑馬燈顯示"})]})]})}),n.jsx(We,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(le,{level:3,className:"mb-2",children:"播歌顯示開關"}),n.jsx(p,{size:"sm",color:"secondary",className:"mb-4",children:"控制是否在跑馬燈中顯示音樂播放資訊。即使關閉，跑馬燈仍會顯示天氣資訊。"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:s,onChange:N=>D(N.target.checked),disabled:C||!e,className:"w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary"}),n.jsx(p,{children:"顯示音樂播放資訊"})]}),s&&n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer ml-8",children:[n.jsx("input",{type:"checkbox",checked:a,onChange:N=>_(N.target.checked),disabled:C||!e,className:"w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary"}),n.jsx(p,{size:"sm",children:"只有「正在播放」時才顯示（不顯示「最近播放」）"})]})]})]})}),n.jsx(We,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(le,{level:3,className:"mb-2",children:"跑馬燈速度"}),n.jsx(p,{size:"sm",color:"secondary",className:"mb-4",children:"調整跑馬燈滾動速度（數值越小速度越快，建議範圍：10-300 秒）"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx(B,{className:"min-w-[80px]",children:"速度（秒）"}),n.jsx("input",{type:"range",min:"10",max:"300",step:"5",value:c,onChange:N=>$(N.target.value),disabled:C||!e,className:"flex-1 h-2 bg-surface rounded-lg appearance-none cursor-pointer accent-primary"}),n.jsx("input",{type:"number",min:"10",max:"300",value:u,onChange:W,onBlur:X,onKeyPress:Q,disabled:C||!e,className:"w-20 px-2 py-1 text-center bg-surface border border-white/10 rounded text-primary focus:outline-none focus:border-primary/50 disabled:opacity-50 disabled:cursor-not-allowed"})]}),n.jsxs("div",{className:"flex items-center justify-between text-xs text-text-secondary",children:[n.jsx("span",{children:"快速 (10秒)"}),n.jsx("span",{children:"中等 (60秒)"}),n.jsx("span",{children:"慢速 (300秒)"})]})]})]})}),n.jsx(We,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(le,{level:3,className:"mb-2",children:"天氣自訂用語"}),n.jsx(p,{size:"sm",color:"secondary",className:"mb-4",children:"根據不同天氣狀況設定自訂用語，會顯示在跑馬燈的天氣資訊後面。每種天氣可以設定多個用語（用換行分隔），每次會隨機顯示其中一個。"}),n.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3 mb-4",children:n.jsxs(p,{size:"xs",color:"secondary",children:[n.jsx("strong",{children:"注意："}),"天氣數據來源為",n.jsx("strong",{children:"桃園機場"}),"（經緯度：25.0797°N, 121.2342°E），自訂用語會根據桃園機場的實際天氣狀況顯示。"]})})]}),n.jsx("div",{className:"space-y-4",children:Jn.map(N=>n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(B,{className:"min-w-[100px]",children:N.label}),n.jsx("span",{className:"text-xs text-text-secondary",children:N.description})]}),n.jsx("textarea",{value:w[N.key]||"",onChange:S=>ee(N.key,S.target.value),onBlur:()=>F(N.key),disabled:C||!e,placeholder:`例如：今天不順，真的不能怪天氣
或者：天氣真好，適合出門走走`,rows:3,className:"w-full px-3 py-2 bg-surface border border-white/10 rounded text-primary placeholder-text-secondary focus:outline-none focus:border-primary/50 disabled:opacity-50 disabled:cursor-not-allowed resize-y"}),n.jsx(p,{size:"xs",color:"secondary",className:"mt-1",children:"每行一個用語，會隨機選擇其中一個顯示"})]},N.key))})]})})]})},Zr=({onLoginSuccess:e,onLoginError:t})=>{const[s,r]=o.useState(""),[a,l]=o.useState(""),[c,d]=o.useState(!1),[u,h]=o.useState(!1),[m,f]=o.useState(""),w=async b=>{if(b.preventDefault(),!s.trim()||!a.trim()){f("請輸入信箱和密碼");return}try{h(!0),f("");const k=await Zn(Ue,s.trim(),a);if(!await bn(k.user.uid)){const{signOut:C}=await pn(async()=>{const{signOut:z}=await import("./index.CE3AVWnB.js").then(E=>E.b_);return{signOut:z}},__vite__mapDeps([0,1]));await C(Ue),f("此帳號沒有管理員權限"),t&&t("此帳號沒有管理員權限");return}r(""),l(""),e&&e(k.user)}catch(k){console.error("登入失敗:",k);let j="登入失敗";switch(k.code){case"auth/user-not-found":j="找不到此帳號";break;case"auth/wrong-password":j="密碼錯誤";break;case"auth/invalid-email":j="信箱格式錯誤";break;case"auth/too-many-requests":j="登入次數過多，請稍後再試";break;case"auth/network-request-failed":j="網路連線失敗，請檢查網路連線";break;default:j="登入失敗："+(k.message||"未知錯誤")}f(j),t&&t(j)}finally{h(!1)}};return n.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:n.jsxs(We,{className:"w-full max-w-md",children:[n.jsxs("div",{className:"text-center mb-6",children:[n.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary/20 mb-4",children:n.jsx(as,{className:"w-8 h-8 text-primary"})}),n.jsx(le,{level:1,gradient:!0,className:"mb-2",children:"管理員登入"}),n.jsx(p,{size:"sm",color:"secondary",children:"請使用管理員帳號登入以存取管理設定"})]}),m&&n.jsx("div",{className:"mb-4 bg-red-500/10 border border-red-500/30 rounded-lg p-3",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"text-red-400",children:"✗"}),n.jsx(p,{color:"danger",size:"sm",children:m})]})}),n.jsxs("form",{onSubmit:w,className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(B,{htmlFor:"email",required:!0,children:"管理員信箱"}),n.jsx(ie,{id:"email",type:"email",value:s,onChange:b=>r(b.target.value),placeholder:"admin@example.com",disabled:u,autoFocus:!0,autoComplete:"email"})]}),n.jsxs("div",{children:[n.jsx(B,{htmlFor:"password",required:!0,children:"密碼"}),n.jsxs("div",{className:"relative",children:[n.jsx(ie,{id:"password",type:c?"text":"password",value:a,onChange:b=>l(b.target.value),placeholder:"請輸入密碼",disabled:u,autoComplete:"current-password",className:"pr-10"}),n.jsx("button",{type:"button",onClick:()=>d(!c),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-secondary hover:text-text-primary transition-colors",disabled:u,children:c?n.jsx(ts,{className:"w-5 h-5"}):n.jsx(ss,{className:"w-5 h-5"})})]})]}),n.jsx(H,{type:"submit",variant:"primary",size:"lg",className:"w-full",disabled:u||!s.trim()||!a.trim(),loading:u,children:u?"登入中...":"登入"})]}),n.jsx("div",{className:"mt-6 pt-6 border-t border-white/10",children:n.jsxs(p,{size:"xs",color:"secondary",className:"text-center",children:["提示：您也可以使用快捷鍵 ",n.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-xs",children:"Ctrl + Alt + A"})," 在任何頁面開啟登入"]})})]})})},ea=()=>{const[e,t]=o.useState(!1),[s,r]=o.useState([]),[a,l]=o.useState(4),[c,d]=o.useState(!1),[u,h]=o.useState(!0),[m,f]=o.useState(!1),[w,b]=o.useState(""),[k,j]=o.useState(""),[C,z]=o.useState(null),[E,T]=o.useState(!1),[M,L]=o.useState([]),[v,I]=o.useState([]),[D,_]=o.useState("catBubble"),$=Qn();o.useEffect(()=>Ue.onAuthStateChanged(async N=>{if(N)try{const S=await bn(N.uid);d(S),S?b(""):(b("您沒有管理員權限"),setTimeout(()=>$("/"),3e3))}catch(S){b("檢查權限時發生錯誤"),console.error("權限檢查失敗:",S)}else d(!1),b("");h(!1)}),[$]),o.useEffect(()=>{c&&(async()=>{try{console.log("AdminPanel: 開始載入班表資料...");const N=await et(Ce(ye,"schedule","currentMonth")),S=await et(Ce(ye,"schedule","nextMonth"));console.log("AdminPanel: currentMonthDoc.exists():",N.exists()),console.log("AdminPanel: nextMonthDoc.exists():",S.exists());let U=null;N.exists()?U=N.data():S.exists()&&(U=S.data()),z(U)}catch{}})()},[c]),o.useEffect(()=>c?gn(Ce(ye,"catSpeech","global"),N=>{if(N.exists()){const S=N.data();t(S.enabled||!1),r(S.texts||[]),l(S.intervalSeconds||4),T(S.smartMode||!1),L(S.customRules||[]),I(S.scheduleTemplates||[])}},N=>{console.error("監聽設定失敗:",N),b("載入設定失敗")}):void 0,[c]);const W=async()=>{try{h(!0);const{signOut:F}=await pn(async()=>{const{signOut:N}=await import("./index.CE3AVWnB.js").then(S=>S.b_);return{signOut:N}},__vite__mapDeps([0,1]));await F(Ue),$("/")}catch(F){console.error("登出失敗:",F),b("登出失敗"),h(!1)}},X=async F=>{var N;if(c)try{f(!0),b(""),j(""),await _t(Ce(ye,"catSpeech","global"),{...F,lastUpdated:xn(),updatedBy:(N=Ue.currentUser)==null?void 0:N.uid}),j("設定已更新"),setTimeout(()=>j(""),3e3)}catch(S){console.error("更新設定失敗:",S),b("更新設定失敗")}finally{f(!1)}},Q=async F=>{L(F),await X({texts:s,enabled:e,intervalSeconds:a,smartMode:E,customRules:F,scheduleTemplates:v})},ee=async F=>{I(F),await X({texts:s,enabled:e,intervalSeconds:a,smartMode:E,customRules:M,scheduleTemplates:F})};return u?n.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),n.jsx(p,{size:"lg",className:"mb-2",children:"載入中..."}),n.jsx(p,{size:"sm",color:"secondary",children:"正在檢查管理員權限"})]})}):c?n.jsx("div",{className:"min-h-screen bg-background",children:n.jsxs(is,{children:[n.jsx("div",{className:"text-center mb-8",children:n.jsx(le,{level:1,gradient:!0,className:"mb-2",children:"管理員設定"})}),k&&n.jsx("div",{className:"mb-6 bg-green-500/10 border border-green-500/30 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"text-green-400",children:"✓"}),n.jsx(p,{color:"success",children:k})]})}),n.jsx("div",{className:"flex justify-end mb-6",children:n.jsx(H,{onClick:W,variant:"danger",disabled:u,loading:u,children:u?"登出中...":"登出管理員"})}),n.jsxs("div",{className:"flex border-b border-white/10 mb-6",children:[n.jsx("button",{onClick:()=>_("catBubble"),className:`px-6 py-3 text-sm font-medium transition-colors ${D==="catBubble"?"text-primary border-b-2 border-primary":"text-text-secondary hover:text-text-primary"}`,children:"貓咪對話設定"}),n.jsx("button",{onClick:()=>_("marquee"),className:`px-6 py-3 text-sm font-medium transition-colors ${D==="marquee"?"text-primary border-b-2 border-primary":"text-text-secondary hover:text-text-primary"}`,children:"跑馬燈設定"})]}),D==="catBubble"&&n.jsx(Gr,{showBubble:e,onShowBubbleChange:F=>X({texts:s,enabled:F,intervalSeconds:a,smartMode:E,customRules:M,scheduleTemplates:v}),speechTexts:s,onSpeechTextsChange:F=>X({texts:F,enabled:e,intervalSeconds:a,smartMode:E,customRules:M,scheduleTemplates:v}),intervalSeconds:a,onIntervalSecondsChange:F=>X({texts:s,enabled:e,intervalSeconds:F,smartMode:E,customRules:M,scheduleTemplates:v}),smartMode:E,onSmartModeChange:F=>X({texts:s,enabled:e,intervalSeconds:a,smartMode:F,customRules:M,scheduleTemplates:v}),customRules:M,onCustomRulesChange:Q,scheduleTemplates:v,onScheduleTemplatesChange:ee,scheduleData:C,isSaving:m}),D==="marquee"&&n.jsx(Jr,{})]})}):n.jsx(Zr,{onLoginSuccess:F=>{console.log("登入成功:",F.email)},onLoginError:F=>{b(F)}})};export{ea as default};
