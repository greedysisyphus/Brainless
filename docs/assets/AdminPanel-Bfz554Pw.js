const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BpFX72zA.js","assets/index-Bn0cTHbW.css"])))=>i.map(i=>d[i]);
import{j as e,r as o,g as te,c as Fe,p as Se,a as ae,d as U,b as P,e as Re,f as Ee,v as Le,h as Ae,i as qe,k as Ie,u as Oe,l as de,m as _e,o as Pe,_ as He,s as We,n as Be}from"./index-BpFX72zA.js";const Ue=({children:n,className:c="",maxWidth:x="container-custom",padding:f="py-4 sm:py-6 lg:py-8",center:t=!0})=>e.jsx("div",{className:`${x} ${f} ${t?"mx-auto":""} ${c}`,children:n}),Ve=({children:n,className:c="",padding:x="p-4 sm:p-6",hover:f=!0})=>e.jsx("div",{className:`
      bg-surface rounded-xl shadow-lg border border-white/5 
      ${x} 
      ${f?"hover:shadow-xl hover:border-white/10 transition-all duration-200":""} 
      ${c}
    `,children:n}),y=({children:n,onClick:c,variant:x="primary",size:f="md",disabled:t=!1,loading:v=!1,className:u="",...M})=>{const L=()=>{switch(x){case"primary":return"bg-primary text-white hover:bg-primary/80 disabled:bg-primary/50";case"secondary":return"bg-white/10 text-white hover:bg-white/20 disabled:bg-white/5";case"danger":return"bg-red-500/20 text-red-400 hover:bg-red-500/30 border border-red-500/30 disabled:bg-red-500/10";case"ghost":return"text-text-secondary hover:text-text-primary hover:bg-white/5 disabled:text-gray-500";default:return"bg-primary text-white hover:bg-primary/80 disabled:bg-primary/50"}},A=()=>{switch(f){case"sm":return"px-3 py-2 text-sm";case"md":return"px-4 py-2";case"lg":return"px-6 py-3 text-lg";default:return"px-4 py-2"}};return e.jsx("button",{onClick:c,disabled:t||v,className:`
        ${L()}
        ${A()}
        rounded-lg transition-all duration-200
        disabled:opacity-50 disabled:cursor-not-allowed
        focus:outline-none focus:ring-2 focus:ring-primary/50
        ${u}
      `,...M,children:v?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),"載入中..."]}):n})},k=({value:n,onChange:c,placeholder:x="",type:f="text",disabled:t=!1,error:v=!1,className:u="",...M})=>e.jsx("input",{type:f,value:n,onChange:c,placeholder:x,disabled:t,className:`
        w-full p-3 sm:p-4
        bg-white/10 border rounded-lg
        text-white placeholder-gray-400
        focus:outline-none focus:ring-2 focus:ring-primary/50
        disabled:opacity-50 disabled:cursor-not-allowed
        ${v?"border-red-500/50 focus:ring-red-500/50":"border-white/20"}
        ${u}
      `,...M}),b=({children:n,htmlFor:c,className:x="",required:f=!1})=>e.jsx("label",{htmlFor:c,className:`
        block text-sm sm:text-base text-white mb-2
        ${f?'after:content-["*"] after:text-red-400 after:ml-1':""}
        ${x}
      `,children:n}),C=({children:n,level:c=1,className:x="",gradient:f=!1})=>{const t=()=>{switch(c){case 1:return"text-2xl sm:text-3xl lg:text-4xl";case 2:return"text-xl sm:text-2xl lg:text-3xl";case 3:return"text-lg sm:text-xl lg:text-2xl";case 4:return"text-base sm:text-lg lg:text-xl";case 5:return"text-sm sm:text-base lg:text-lg";case 6:return"text-xs sm:text-sm lg:text-base";default:return"text-xl sm:text-2xl lg:text-3xl"}},v=()=>f?"bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent":"text-white",u=`h${c}`;return e.jsx(u,{className:`font-bold ${t()} ${v()} ${x}`,children:n})},a=({children:n,size:c="base",color:x="white",className:f="",...t})=>{const v=()=>{switch(c){case"xs":return"text-xs";case"sm":return"text-sm";case"base":return"text-base";case"lg":return"text-lg";case"xl":return"text-xl";default:return"text-base"}},u=()=>{switch(x){case"white":return"text-white";case"secondary":return"text-text-secondary";case"primary":return"text-primary";case"danger":return"text-red-400";case"success":return"text-green-400";default:return"text-white"}};return e.jsx("p",{className:`${v()} ${u()} ${f}`,...t,children:n})},Xe=({customRules:n=[],scheduleTemplates:c=[],onRulesChange:x,onTemplatesChange:f,isSaving:t=!1,scheduleData:v=null,speechTexts:u=[],onSpeechTextsChange:M,showBubble:L=!1,onShowBubbleChange:A,intervalSeconds:V=4,onIntervalSecondsChange:X,smartMode:G=!1,onSmartModeChange:$})=>{const[Y,F]=o.useState(!1),[q,Q]=o.useState(null),[z,K]=o.useState("custom"),[D,Z]=o.useState(!1),[m,E]=o.useState({name:"",type:"timeRange",startTime:"08:00",endTime:"10:00",day:"一",month:1,date:1,messages:[""],enabled:!0}),[j,ee]=o.useState(null),[N,re]=o.useState({}),[J,h]=o.useState(!1),[p,g]=o.useState(!1);o.useEffect(()=>{v?ee(v):(async()=>{try{h(!0);const r=await ae(U(P,"schedule","currentMonth")),l=await ae(U(P,"schedule","nextMonth"));let d=null;r.exists()?d=r.data():l.exists()&&(d=l.data()),ee(d)}catch(r){console.error("載入班表資料失敗:",r)}finally{h(!1)}})()},[v]),o.useEffect(()=>{(async()=>{try{g(!0);const r=await Re(Ee(P,"names")),l={};r.forEach(d=>{const w=d.data();w.name&&(l[d.id]=w.name)}),re(l)}catch(r){console.error("載入同事姓名資料失敗:",r)}finally{g(!1)}})()},[]);const H=s=>{if(!s||typeof s!="object")return[];const r=[],l=new Date,d=l.getFullYear(),w=l.getMonth()+1,T=l.getDate();for(const[i,I]of Object.entries(s))if(i!=="_lastUpdated"&&I&&typeof I=="object"){for(const[ie,O]of Object.entries(I))if(O&&O.trim()&&O!=="休假"&&O!=="特休"&&O!=="月休"){const _=parseInt(ie);_===T&&r.push({id:`${i}_${_}`,date:`${d}-${String(w).padStart(2,"0")}-${String(_).padStart(2,"0")}`,shift:O,employee:i})}}return r},[S,le]=o.useState({name:"",message:"",enabled:!0,timeRestriction:!1,startTime:"08:00",endTime:"10:00"}),[W,ce]=o.useState(null),[se,oe]=o.useState(""),me=async()=>{if(se.trim()&&M){const s=[...u,se.trim()];try{await M(s),oe("")}catch(r){console.error("添加對話失敗:",r)}}},ue=async s=>{if(M){const r=u.filter((l,d)=>d!==s);try{await M(r)}catch(l){console.error("刪除對話失敗:",l)}}},xe=()=>{le({name:"",message:"",enabled:!0,timeRestriction:!1,startTime:"08:00",endTime:"10:00"}),ce(null),F(!1)},B=(s,r)=>{le(l=>({...l,[s]:r}))},be=(s,r)=>{const l=new Date,d=l.getHours(),w=l.getMinutes(),T=d*60+w,[i,I]=s.split(":").map(Number),[ie,O]=r.split(":").map(Number),_=i*60+I,ne=ie*60+O;return ne<_?T>=_||T<=ne:T>=_&&T<=ne},he=()=>{E({name:"",type:"timeRange",startTime:"08:00",endTime:"10:00",day:"一",month:1,date:1,messages:[""],enabled:!0}),Q(null),F(!1)},R=(s,r)=>{E(l=>({...l,[s]:r}))},ge=(s,r)=>{const l=[...m.messages];l[s]=r,E(d=>({...d,messages:l}))},je=()=>{E(s=>({...s,messages:[...s.messages,""]}))},pe=s=>{if(m.messages.length>1){const r=m.messages.filter((l,d)=>d!==s);E(l=>({...l,messages:r}))}},ye=()=>{if(!m.name.trim()){alert("請填寫規則名稱");return}const s=m.messages.filter(d=>d&&typeof d=="string"&&d.trim()!=="");if(s.length===0){alert("請至少添加一個對話內容");return}const r={id:q?q.id:Date.now().toString(),...m,messages:s};if(!Le(r)){alert("規則設定有誤，請檢查時間格式");return}let l;q?l=n.map(d=>d.id===q.id?r:d):l=[...n,r],x(l),he()},fe=s=>{if(window.confirm("確定要刪除這個規則嗎？")){const r=n.filter(l=>l.id!==s);x(r)}},Ne=s=>{const r=n.map(l=>l.id===s?{...l,enabled:!l.enabled}:l);x(r)},ve=s=>{E({name:s.name,type:s.type,startTime:s.startTime||"08:00",endTime:s.endTime||"10:00",day:s.day||"一",month:s.month||1,date:s.date||1,messages:s.messages||[""],enabled:s.enabled}),Q(s),F(!0)},we=()=>{window.confirm("確定要載入預設規則嗎？這會覆蓋現有的自定義規則。")&&x(Ae())},Te=()=>{if(!S.name.trim()){alert("請填寫模板名稱");return}if(!S.message.trim()){alert("請填寫問候語內容");return}const s={id:W?W.id:Date.now().toString(),...S};if(!qe(s)){alert("模板設定有誤，請檢查內容");return}let r;W?r=c.map(l=>l.id===W.id?s:l):r=[...c,s],f(r),xe()},ze=s=>{if(window.confirm("確定要刪除這個模板嗎？")){const r=c.filter(l=>l.id!==s);f(r)}},ke=s=>{const r=c.map(l=>l.id===s?{...l,enabled:!l.enabled}:l);f(r)},Ce=s=>{le({name:s.name,message:s.message,enabled:s.enabled,timeRestriction:s.timeRestriction||!1,startTime:s.startTime||"08:00",endTime:s.endTime||"10:00"}),ce(s),F(!0)},Me=()=>{const s=Ie();f(s)},De=()=>{if(J){alert("請稍候，正在載入班表資料...");return}if(p){alert("請稍候，正在載入姓名資料...");return}if(!j){alert("無班表資料，無法預覽所有智能對話。");return}Object.keys(N).length===0&&alert("無姓名資料，將顯示職員編號。");const s=te(j,n,c,N),r=s.map((l,d)=>`${d+1}. [${l.source}] ${l.message}`).join(`

`);s.length===0?alert(`目前沒有觸發的智能對話。

只會播放您設定的普通對話。`):alert(`智能對話預覽 (共${s.length}條)：

${r}

注意：這些對話會與您設定的普通對話一起輪流播放。`)},$e=()=>{switch(m.type){case"timeRange":return e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"startTime",required:!0,children:"開始時間"}),e.jsx(k,{id:"startTime",type:"time",value:m.startTime,onChange:s=>R("startTime",s.target.value),disabled:t})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"endTime",required:!0,children:"結束時間"}),e.jsx(k,{id:"endTime",type:"time",value:m.endTime,onChange:s=>R("endTime",s.target.value),disabled:t})]})]});case"dayOfWeek":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"daySelect",required:!0,children:"星期幾"}),e.jsxs("select",{id:"daySelect",value:m.day,onChange:s=>R("day",s.target.value),disabled:t,className:"w-full p-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary/50 disabled:opacity-50",children:[e.jsx("option",{value:"一",children:"星期一"}),e.jsx("option",{value:"二",children:"星期二"}),e.jsx("option",{value:"三",children:"星期三"}),e.jsx("option",{value:"四",children:"星期四"}),e.jsx("option",{value:"五",children:"星期五"}),e.jsx("option",{value:"六",children:"星期六"}),e.jsx("option",{value:"日",children:"星期日"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"startTime",required:!0,children:"開始時間"}),e.jsx(k,{id:"startTime",type:"time",value:m.startTime,onChange:s=>R("startTime",s.target.value),disabled:t})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"endTime",required:!0,children:"結束時間"}),e.jsx(k,{id:"endTime",type:"time",value:m.endTime,onChange:s=>R("endTime",s.target.value),disabled:t})]})]})]});case"specificDate":return e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"month",required:!0,children:"月份"}),e.jsx(k,{id:"month",type:"number",min:"1",max:"12",value:m.month,onChange:s=>R("month",parseInt(s.target.value)),disabled:t})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"date",required:!0,children:"日期"}),e.jsx(k,{id:"date",type:"number",min:"1",max:"31",value:m.date,onChange:s=>R("date",parseInt(s.target.value)),disabled:t})]})]});default:return null}};return e.jsxs(Ve,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx(C,{level:2,gradient:!0,children:"智能對話規則管理"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{onClick:De,variant:"secondary",size:"sm",disabled:t||J||p,children:"預覽所有對話"}),e.jsx(y,{onClick:()=>F(!0),variant:"primary",size:"sm",disabled:t,children:"添加規則"})]})]}),e.jsxs("div",{className:"bg-orange-500/10 border border-orange-500/20 rounded-lg p-4 mb-6",children:[e.jsx(C,{level:3,className:"text-orange-400 mb-4",children:"基本設定"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"bubbleToggle",checked:L,disabled:t,onChange:s=>A&&A(s.target.checked),className:"w-5 h-5 disabled:opacity-50"}),e.jsx(b,{htmlFor:"bubbleToggle",className:"!mb-0",children:"顯示對話輪播"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"smartModeToggle",checked:G,disabled:t,onChange:()=>$&&$(!G),className:"w-5 h-5 disabled:opacity-50"}),e.jsx(b,{htmlFor:"smartModeToggle",className:"!mb-0",children:"智能模式（根據自定義規則和班表問候自動顯示對話）"})]}),e.jsxs("div",{children:[e.jsxs(b,{htmlFor:"intervalSlider",children:["輪播間隔 (",V,"秒)"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"range",id:"intervalSlider",min:"1",max:"10",value:V,disabled:t,onChange:s=>X&&X(parseInt(s.target.value)),className:"flex-1 h-2 bg-white/10 rounded-lg appearance-none cursor-pointer slider disabled:opacity-50"}),e.jsxs("span",{className:"text-white min-w-[3rem] text-center",children:[V,"s"]})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[e.jsx("span",{children:"1秒"}),e.jsx("span",{children:"10秒"})]})]})]})]}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-4 mb-6",children:[e.jsx(C,{level:3,className:"text-blue-400 mb-2",children:"資料載入狀態"}),e.jsx(a,{size:"sm",className:"text-blue-300",children:J?"載入班表中...":j?`班表資料：${Object.keys(j).filter(s=>s!=="_lastUpdated").length} 位同事`:"班表資料：未載入"}),j&&j._lastUpdated&&e.jsxs(a,{size:"sm",className:"text-blue-300 mt-1",children:["最後更新：",new Date(j._lastUpdated).toLocaleString()]}),e.jsx(a,{size:"sm",className:"text-blue-300 mt-1",children:p?"載入姓名中...":Object.keys(N).length>0?`姓名對應：${Object.keys(N).length} 位同事`:"姓名對應：未載入"})]}),e.jsxs("div",{className:"flex border-b border-white/10 mb-6",children:[e.jsxs("button",{onClick:()=>K("custom"),className:`px-4 py-2 text-sm font-medium transition-colors ${z==="custom"?"text-primary border-b-2 border-primary":"text-text-secondary hover:text-text-primary"}`,children:["自定義規則 (",n.length,")"]}),e.jsxs("button",{onClick:()=>K("schedule"),className:`px-4 py-2 text-sm font-medium transition-colors ${z==="schedule"?"text-primary border-b-2 border-primary":"text-text-secondary hover:text-text-primary"}`,children:["班表問候模板 (",c.length,")"]}),e.jsxs("button",{onClick:()=>K("dialogue"),className:`px-4 py-2 text-sm font-medium transition-colors ${z==="dialogue"?"text-primary border-b-2 border-primary":"text-text-secondary hover:text-text-primary"}`,children:["對話管理 (",u.length,")"]})]}),z==="custom"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/20 rounded-lg p-4 mb-6",children:[e.jsx(C,{level:3,className:"text-purple-400 mb-2",children:"自定義規則說明"}),e.jsx(a,{size:"sm",className:"text-purple-300",children:"可以設定特定時間範圍、星期幾或特定日期的對話規則，系統會根據條件自動顯示對話。"})]}),Y&&e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4 mb-6",children:[e.jsx(C,{level:3,className:"mb-4",children:q?"編輯規則":"添加新規則"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"ruleName",required:!0,children:"規則名稱"}),e.jsx(k,{id:"ruleName",value:m.name,onChange:s=>R("name",s.target.value),placeholder:"例如：早上問候",disabled:t})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"ruleType",required:!0,children:"規則類型"}),e.jsxs("select",{id:"ruleType",value:m.type,onChange:s=>R("type",s.target.value),disabled:t,className:"w-full p-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary/50 disabled:opacity-50",children:[e.jsx("option",{value:"timeRange",children:"時間範圍"}),e.jsx("option",{value:"dayOfWeek",children:"星期幾"}),e.jsx("option",{value:"specificDate",children:"特定日期"})]})]}),$e(),e.jsxs("div",{children:[e.jsxs(b,{required:!0,children:["對話內容 (",m.messages.length,"條)"]}),e.jsxs("div",{className:"space-y-2",children:[m.messages.map((s,r)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{value:s,onChange:l=>ge(r,l.target.value),placeholder:`對話 ${r+1}...`,disabled:t}),e.jsx(y,{onClick:()=>pe(r),variant:"danger",size:"sm",disabled:t||m.messages.length<=1,className:"px-3",children:"刪除"})]},r)),e.jsx(y,{onClick:je,variant:"secondary",size:"sm",disabled:t,className:"w-full",children:"添加對話"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"ruleEnabled",checked:m.enabled,onChange:s=>R("enabled",s.target.checked),disabled:t,className:"w-5 h-5 disabled:opacity-50"}),e.jsx(b,{htmlFor:"ruleEnabled",className:"!mb-0",children:"啟用此規則"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{onClick:ye,variant:"primary",disabled:t,loading:t,children:q?"更新規則":"添加規則"}),e.jsx(y,{onClick:he,variant:"secondary",disabled:t,children:"取消"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(b,{children:["現有規則 (",n.length,"條)"]}),e.jsx(y,{onClick:we,variant:"secondary",size:"sm",disabled:t,children:"載入預設"})]}),n.length===0?e.jsx(a,{color:"secondary",className:"text-center py-8",children:"暫無自定義規則"}):n.map(s=>{var r,l;return e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:s.enabled,onChange:()=>Ne(s.id),disabled:t,className:"w-4 h-4 disabled:opacity-50"}),e.jsx(C,{level:4,className:"!mb-0",children:s.name}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${s.enabled?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,children:s.enabled?"啟用":"停用"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{onClick:()=>ve(s),variant:"ghost",size:"sm",disabled:t,children:"編輯"}),e.jsx(y,{onClick:()=>fe(s.id),variant:"danger",size:"sm",disabled:t,children:"刪除"})]})]}),e.jsxs(a,{size:"sm",color:"secondary",className:"mb-2",children:["類型：",s.type==="timeRange"?"時間範圍":s.type==="dayOfWeek"?"星期幾":"特定日期"]}),s.type==="timeRange"&&e.jsxs(a,{size:"sm",color:"secondary",className:"mb-2",children:["時間：",s.startTime," - ",s.endTime]}),s.type==="dayOfWeek"&&e.jsxs(a,{size:"sm",color:"secondary",className:"mb-2",children:["星期",s.day," ",s.startTime," - ",s.endTime]}),s.type==="specificDate"&&e.jsxs(a,{size:"sm",color:"secondary",className:"mb-2",children:[s.month,"月",s.date,"日"]}),e.jsxs(a,{size:"sm",color:"secondary",className:"mb-2",children:["對話數量：",((r=s.messages)==null?void 0:r.length)||0," 條"]}),e.jsx("div",{className:"space-y-1",children:(l=s.messages)==null?void 0:l.map((d,w)=>e.jsx(a,{className:"bg-white/5 rounded p-2 text-sm",children:d},w))})]},s.id)})]})]}),z==="schedule"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(C,{level:3,className:"text-blue-400",children:"可用變數說明"}),e.jsxs(y,{onClick:()=>Z(!D),variant:"secondary",size:"sm",className:"flex items-center gap-2",children:[D?"隱藏說明":"顯示說明",e.jsx("span",{className:"text-xs",children:D?"▼":"▶"})]})]}),D&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsx(a,{size:"sm",className:"text-blue-300 font-bold mb-3 text-center",children:"📋 班次變數"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","{早班同事}"," - 早班同事名字"]}),e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","{中班同事}"," - 中班同事名字"]}),e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","{晚班同事}"," - 晚班同事名字"]}),e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","{所有同事}"," - 所有上班同事名字"]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsx(a,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"💡 使用範例："}),e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","{早班同事}，早安！"," → 小明、小華，早安！"]}),e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","{所有同事}，工作辛苦了！"," → 小明、小華、小美，工作辛苦了！"]})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsx(a,{size:"sm",className:"text-blue-300 font-bold mb-3 text-center",children:"👥 人數變數"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","{早班人數}"," - 早班人數"]}),e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","{中班人數}"," - 中班人數"]}),e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","{晚班人數}"," - 晚班人數"]}),e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","{總人數}"," - 總上班人數"]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsx(a,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"💡 使用範例："}),e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","今天有{總人數}位同事上班"," → 今天有5位同事上班"]}),e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","早班{早班人數}人，晚班{晚班人數}人"," → 早班2人，晚班3人"]})]})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsx(a,{size:"sm",className:"text-blue-300 font-bold mb-4 text-center",children:"⏰ 連續上班變數"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(a,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"🔧 基本變數"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","{連續上班同事}"," - 連續上班4-6天的同事（顯示名字+天數）"]}),e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","{連續上班同事數量}"," - 連續上班4-6天的同事數量"]})]})]}),e.jsxs("div",{children:[e.jsx(a,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"🎯 指定天數變數"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","{連續上班X天同事}"," - 指定天數的同事名字（X為數字，只顯示名字）"]}),e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","{連續上班X天同事數量}"," - 指定天數的同事數量"]})]})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsx(a,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"💡 使用範例"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","{連續上班同事}，辛苦了！"]}),e.jsx(a,{size:"sm",className:"text-gray-400 text-xs",children:"→ 小明連續上班5天、小華連續上班4天，辛苦了！"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","{連續上班6天同事}，請務必休息"]}),e.jsx(a,{size:"sm",className:"text-gray-400 text-xs",children:"→ 紅葉，請務必休息"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(a,{size:"sm",className:"text-blue-300",children:["• ","今天有{連續上班同事數量}位同事需要關心"]}),e.jsx(a,{size:"sm",className:"text-gray-400 text-xs",children:"→ 今天有2位同事需要關心"})]})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsx(a,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"⚙️ 功能說明"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(a,{size:"sm",className:"text-blue-300",children:"• 自動計算：從今天開始往前計算，遇到休假為止"}),e.jsx(a,{size:"sm",className:"text-blue-300",children:"• 智能顯示：沒有符合條件的同事時，模板不會顯示"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(a,{size:"sm",className:"text-blue-300",children:"• 適用場景：關心同事、提醒休息、表揚勤奮"}),e.jsx(a,{size:"sm",className:"text-blue-300",children:"• 注意事項：需要先在姓名管理中設定同事姓名對應"})]})]})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(y,{onClick:()=>F(!0),variant:"primary",size:"sm",disabled:t,children:"添加規則"})})]})]}),Y&&e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4 mb-6",children:[e.jsx(C,{level:3,className:"mb-4",children:W?"編輯模板":"添加新模板"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"templateName",required:!0,children:"模板名稱"}),e.jsx(k,{id:"templateName",value:S.name,onChange:s=>B("name",s.target.value),placeholder:"例如：早班問候",disabled:t})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"templateMessage",required:!0,children:"問候語內容"}),e.jsx(k,{id:"templateMessage",value:S.message,onChange:s=>B("message",s.target.value),placeholder:"例如：{早班同事}，早安！今天也要加油喔！",disabled:t})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"templateEnabled",checked:S.enabled,onChange:s=>B("enabled",s.target.checked),disabled:t,className:"w-5 h-5 disabled:opacity-50"}),e.jsx(b,{htmlFor:"templateEnabled",className:"!mb-0",children:"啟用此模板"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"timeRestriction",checked:S.timeRestriction,onChange:s=>B("timeRestriction",s.target.checked),disabled:t,className:"w-5 h-5 disabled:opacity-50"}),e.jsx(b,{htmlFor:"timeRestriction",className:"!mb-0",children:"啟用時間限制"})]}),S.timeRestriction&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"startTime",required:!0,children:"限制開始時間"}),e.jsx(k,{id:"startTime",type:"time",value:S.startTime,onChange:s=>B("startTime",s.target.value),disabled:t})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"endTime",required:!0,children:"限制結束時間"}),e.jsx(k,{id:"endTime",type:"time",value:S.endTime,onChange:s=>B("endTime",s.target.value),disabled:t})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{onClick:Te,variant:"primary",disabled:t,loading:t,children:W?"更新模板":"添加模板"}),e.jsx(y,{onClick:xe,variant:"secondary",disabled:t,children:"取消"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(b,{children:["現有模板 (",c.length,"條)"]}),e.jsx(y,{onClick:Me,variant:"secondary",size:"sm",disabled:t,children:"載入預設"})]}),c.length===0?e.jsx(a,{color:"secondary",className:"text-center py-8",children:"暫無班表問候模板"}):c.map(s=>e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:s.enabled,onChange:()=>ke(s.id),disabled:t,className:"w-4 h-4 disabled:opacity-50"}),e.jsx(C,{level:4,className:"!mb-0",children:s.name}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${s.enabled?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,children:s.enabled?"啟用":"停用"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{onClick:()=>Ce(s),variant:"ghost",size:"sm",disabled:t,children:"編輯"}),e.jsx(y,{onClick:()=>ze(s.id),variant:"danger",size:"sm",disabled:t,children:"刪除"})]})]}),e.jsxs(a,{size:"sm",color:"secondary",className:"mb-2",children:["原始模板：",s.message]}),s.timeRestriction&&e.jsxs(a,{size:"sm",color:"secondary",className:"mb-2",children:["時間限制：",s.startTime," - ",s.endTime]})]},s.id))]})]}),z==="dialogue"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx(b,{htmlFor:"newMessage",children:"添加新對話"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{id:"newMessage",type:"text",value:se,onChange:s=>oe(s.target.value),disabled:t,placeholder:"輸入新對話內容...",onKeyPress:s=>s.key==="Enter"&&!t&&me()}),e.jsx(y,{onClick:()=>me(),disabled:t||!se.trim(),loading:t,children:t?"添加中...":"添加"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(b,{children:["對話列表 (",u.length,"條)"]}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2 border border-white/10 rounded-lg p-3",children:u.length===0?e.jsx(a,{color:"secondary",className:"text-center py-4",children:"暫無對話內容"}):u.map((s,r)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-lg",children:[e.jsx(a,{className:"flex-1",children:s}),e.jsx(y,{onClick:()=>ue(r),variant:"ghost",size:"sm",disabled:t,className:"p-1 text-red-400 hover:text-red-300",title:"刪除",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},r))})]})]}),e.jsxs("div",{className:"mt-8 bg-gradient-to-r from-purple-500/10 to-blue-500/10 border border-purple-500/20 rounded-lg p-6",children:[e.jsx(C,{level:3,className:"text-purple-400 mb-4 text-center",children:"所有對話列表"}),e.jsx("div",{className:"space-y-3",children:(()=>{const s=te(j,n,c,N),r=s.map(i=>i.message).filter(i=>i&&typeof i=="string"&&i.trim()!==""),l=u.filter(i=>i&&typeof i=="string"&&i.trim()!==""&&!r.includes(i)),d=[...s.map(i=>({...i,isNormal:!1})),...l.map(i=>({type:"normal",priority:999,message:i,source:"普通對話",isNormal:!0}))],w=[],T=new Set;for(const i of d)T.has(i.message)||(w.push(i),T.add(i.message));return w.length===0?e.jsx(a,{size:"sm",className:"text-gray-400 text-center py-4",children:"目前沒有任何對話"}):w.map((i,I)=>e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(a,{size:"sm",className:"text-green-400 font-bold",children:[I+1,". ",i.source]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${i.type==="custom"?"bg-purple-500/20 text-purple-400":i.type==="schedule"?"bg-blue-500/20 text-blue-400":i.type==="normal"?"bg-orange-500/20 text-orange-400":"bg-gray-500/20 text-gray-400"}`,children:i.type==="custom"?"自定義規則":i.type==="schedule"?"班表模板":i.type==="normal"?"普通對話":"其他"})]}),e.jsx(a,{className:"text-white",children:i.message})]},I))})()}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10",children:[e.jsx(a,{size:"sm",className:"text-blue-300 font-bold mb-2",children:"詳細調試資訊："}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-xs text-gray-400",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["班表資料：",j?"已載入":"未載入"]}),e.jsxs("div",{children:["姓名資料：",Object.keys(N).length>0?`已載入 ${Object.keys(N).length} 個`:"未載入"]}),e.jsxs("div",{children:["今天上班同事：",j?H(j).length:0," 人"]}),e.jsxs("div",{children:["自定義規則：",n.filter(s=>s.enabled).length," 個啟用"]}),e.jsxs("div",{children:["班表模板：",c.filter(s=>s.enabled).length," 個啟用"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["智能對話：",te(j,n,c,N).length," 條"]}),e.jsxs("div",{children:["普通對話：",u.length," 條"]}),e.jsxs("div",{children:["總對話數：",te(j,n,c,N).length+u.length," 條"]}),e.jsxs("div",{children:["當前時間：",new Date().toLocaleString()]}),e.jsxs("div",{children:["星期：",new Date().toLocaleDateString("zh-TW",{weekday:"long"})]})]})]}),c.filter(s=>s.enabled).length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10",children:[e.jsx(a,{size:"sm",className:"text-blue-300 font-bold mb-2",children:"班表模板調試："}),e.jsx("div",{className:"space-y-1 text-xs text-gray-400",children:c.filter(s=>s.enabled).map((s,r)=>{const l=H(j),d=Fe(l,N),w=s.timeRestriction?be(s.startTime,s.endTime):!0,T=Se(s,j,N),i=T&&typeof T=="string"&&T.trim()!=="";return e.jsxs("div",{className:"bg-white/5 rounded p-2",children:[e.jsxs("div",{children:["模板：",s.name]}),e.jsxs("div",{children:["時間限制：",s.timeRestriction?`${s.startTime}-${s.endTime}`:"無"]}),e.jsxs("div",{children:["時間檢查：",w?"通過":"不通過"]}),e.jsxs("div",{children:["會顯示：",i?"是":"否"]}),i&&e.jsxs("div",{children:["處理後：",T]}),e.jsxs("div",{children:["早班同事：",d.morning.join("、")||"無"]}),e.jsxs("div",{children:["中班同事：",d.afternoon.join("、")||"無"]}),e.jsxs("div",{children:["晚班同事：",d.evening.join("、")||"無"]})]},r)})})]})]})]})]})},Ye=()=>{const[n,c]=o.useState(!1),[x,f]=o.useState([]),[t,v]=o.useState(4),[u,M]=o.useState(!1),[L,A]=o.useState(!0),[V,X]=o.useState(!1),[G,$]=o.useState(""),[Y,F]=o.useState(""),[q,Q]=o.useState(null),[z,K]=o.useState(!1),[D,Z]=o.useState([]),[m,E]=o.useState([]),j=Oe();o.useEffect(()=>de.onAuthStateChanged(async p=>{if(p)try{const g=await _e(p.uid);M(g),g||($("您沒有管理員權限"),setTimeout(()=>j("/"),3e3))}catch(g){$("檢查權限時發生錯誤"),console.error("權限檢查失敗:",g)}else M(!1),$("請先登入"),setTimeout(()=>j("/"),2e3);A(!1)}),[j]),o.useEffect(()=>{u&&(async()=>{try{console.log("AdminPanel: 開始載入班表資料...");const p=await ae(U(P,"schedule","currentMonth")),g=await ae(U(P,"schedule","nextMonth"));console.log("AdminPanel: currentMonthDoc.exists():",p.exists()),console.log("AdminPanel: nextMonthDoc.exists():",g.exists());let H=null;p.exists()?H=p.data():g.exists()&&(H=g.data()),Q(H)}catch{}})()},[u]),o.useEffect(()=>u?Pe(U(P,"catSpeech","global"),p=>{if(p.exists()){const g=p.data();c(g.enabled||!1),f(g.texts||[]),v(g.intervalSeconds||4),K(g.smartMode||!1),Z(g.customRules||[]),E(g.scheduleTemplates||[])}},p=>{console.error("監聽設定失敗:",p),$("載入設定失敗")}):void 0,[u]);const ee=async()=>{try{A(!0);const{signOut:h}=await He(async()=>{const{signOut:p}=await import("./index-BpFX72zA.js").then(g=>g.w);return{signOut:p}},__vite__mapDeps([0,1]));await h(de),j("/")}catch(h){console.error("登出失敗:",h),$("登出失敗"),A(!1)}},N=async h=>{var p;if(u)try{X(!0),$(""),F(""),await We(U(P,"catSpeech","global"),{...h,lastUpdated:Be(),updatedBy:(p=de.currentUser)==null?void 0:p.uid}),F("設定已更新"),setTimeout(()=>F(""),3e3)}catch(g){console.error("更新設定失敗:",g),$("更新設定失敗")}finally{X(!1)}},re=async h=>{Z(h),await N({texts:x,enabled:n,intervalSeconds:t,smartMode:z,customRules:h,scheduleTemplates:m})},J=async h=>{E(h),await N({texts:x,enabled:n,intervalSeconds:t,smartMode:z,customRules:D,scheduleTemplates:h})};return L?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx(a,{size:"lg",className:"mb-2",children:"載入中..."}),e.jsx(a,{size:"sm",color:"secondary",children:"正在檢查管理員權限"})]})}):G?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md mx-auto",children:[e.jsx("div",{className:"text-red-400 text-4xl mb-4",children:"⚠️"}),e.jsx(C,{level:2,className:"mb-4",children:"發生錯誤"}),e.jsx(a,{className:"mb-6",children:G}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{onClick:()=>j("/"),variant:"primary",size:"lg",className:"w-full",children:"返回首頁"}),e.jsx(y,{onClick:()=>window.location.reload(),variant:"secondary",size:"lg",className:"w-full",children:"重新載入"})]})]})}):u?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs(Ue,{children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(C,{level:1,gradient:!0,className:"mb-2",children:"管理員設定"}),e.jsx(a,{color:"secondary",children:"管理貓咪對話和系統設定"})]}),Y&&e.jsx("div",{className:"mb-6 bg-green-500/10 border border-green-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-green-400",children:"✓"}),e.jsx(a,{color:"success",children:Y})]})}),e.jsx("div",{className:"flex justify-end mb-6",children:e.jsx(y,{onClick:ee,variant:"danger",disabled:L,loading:L,children:L?"登出中...":"登出管理員"})}),e.jsx(Xe,{customRules:D,scheduleTemplates:m,onRulesChange:re,onTemplatesChange:J,isSaving:V,scheduleData:q,speechTexts:x,onSpeechTextsChange:h=>N({texts:h,enabled:n,intervalSeconds:t,smartMode:z,customRules:D,scheduleTemplates:m}),showBubble:n,onShowBubbleChange:h=>N({texts:x,enabled:h,intervalSeconds:t,smartMode:z,customRules:D,scheduleTemplates:m}),intervalSeconds:t,onIntervalSecondsChange:h=>N({texts:x,enabled:n,intervalSeconds:h,smartMode:z,customRules:D,scheduleTemplates:m}),smartMode:z,onSmartModeChange:h=>N({texts:x,enabled:n,intervalSeconds:t,smartMode:h,customRules:D,scheduleTemplates:m})})]})}):null};export{Ye as default};
