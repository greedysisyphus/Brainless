const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.BdHW5VF-.js","assets/index.0zZ4fKQh.css"])))=>i.map(i=>d[i]);
import{r as o,j as n,aL as ue,aM as Ze,aN as Je,aO as Un,aP as Wn,aQ as Xn,aR as Qe,aS as De,aT as ye,aU as _n,aV as Hn,aW as Xt,aX as Yn,aY as Vn,aZ as Kn,a_ as Gn,a$ as gn,b0 as xn,b1 as Ue,b2 as Jn,b3 as bn,_ as pn,b4 as Zn}from"./index.BdHW5VF-.js";function Qn({title:e,titleId:t,...s},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?o.createElement("title",{id:t},e):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"}))}const es=o.forwardRef(Qn);function ts({title:e,titleId:t,...s},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?o.createElement("title",{id:t},e):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const ns=o.forwardRef(ts);function ss({title:e,titleId:t,...s},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?o.createElement("title",{id:t},e):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"}))}const rs=o.forwardRef(ss),as=({children:e,className:t="",maxWidth:s="container-custom",padding:r="py-4 sm:py-6 lg:py-8",center:a=!0})=>n.jsx("div",{className:`${s} ${r} ${a?"mx-auto":""} ${t}`,children:e}),yt=({children:e,className:t="",padding:s="p-4 sm:p-6",hover:r=!0})=>n.jsx("div",{className:`
      bg-surface rounded-xl shadow-lg border border-white/5 
      ${s} 
      ${r?"hover:shadow-xl hover:border-white/10 transition-all duration-200":""} 
      ${t}
    `,children:e}),X=({children:e,onClick:t,variant:s="primary",size:r="md",disabled:a=!1,loading:l=!1,className:c="",...d})=>{const u=()=>{switch(s){case"primary":return"bg-primary text-white hover:bg-primary/80 disabled:bg-primary/50";case"secondary":return"bg-white/10 text-white hover:bg-white/20 disabled:bg-white/5";case"danger":return"bg-red-500/20 text-red-400 hover:bg-red-500/30 border border-red-500/30 disabled:bg-red-500/10";case"ghost":return"text-text-secondary hover:text-text-primary hover:bg-white/5 disabled:text-gray-500";default:return"bg-primary text-white hover:bg-primary/80 disabled:bg-primary/50"}},h=()=>{switch(r){case"sm":return"px-3 py-2 text-sm";case"md":return"px-4 py-2";case"lg":return"px-6 py-3 text-lg";default:return"px-4 py-2"}};return n.jsx("button",{onClick:t,disabled:a||l,className:`
        ${u()}
        ${h()}
        rounded-lg transition-all duration-200
        disabled:opacity-50 disabled:cursor-not-allowed
        focus:outline-none focus:ring-2 focus:ring-primary/50
        ${c}
      `,...d,children:l?n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),"載入中..."]}):e})},ne=({value:e,onChange:t,placeholder:s="",type:r="text",disabled:a=!1,error:l=!1,className:c="",...d})=>n.jsx("input",{type:r,value:e,onChange:t,placeholder:s,disabled:a,className:`
        w-full p-3 sm:p-4
        bg-white/10 border rounded-lg
        text-white placeholder-gray-400
        focus:outline-none focus:ring-2 focus:ring-primary/50
        disabled:opacity-50 disabled:cursor-not-allowed
        ${l?"border-red-500/50 focus:ring-red-500/50":"border-white/20"}
        ${c}
      `,...d}),P=({children:e,htmlFor:t,className:s="",required:r=!1})=>n.jsx("label",{htmlFor:t,className:`
        block text-sm sm:text-base text-white mb-2
        ${r?'after:content-["*"] after:text-red-400 after:ml-1':""}
        ${s}
      `,children:e}),de=({children:e,level:t=1,className:s="",gradient:r=!1})=>{const a=()=>{switch(t){case 1:return"text-2xl sm:text-3xl lg:text-4xl";case 2:return"text-xl sm:text-2xl lg:text-3xl";case 3:return"text-lg sm:text-xl lg:text-2xl";case 4:return"text-base sm:text-lg lg:text-xl";case 5:return"text-sm sm:text-base lg:text-lg";case 6:return"text-xs sm:text-sm lg:text-base";default:return"text-xl sm:text-2xl lg:text-3xl"}},l=()=>r?"bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent":"text-white",c=`h${t}`;return n.jsx(c,{className:`font-bold ${a()} ${l()} ${s}`,children:e})},y=({children:e,size:t="base",color:s="white",className:r="",...a})=>{const l=()=>{switch(t){case"xs":return"text-xs";case"sm":return"text-sm";case"base":return"text-base";case"lg":return"text-lg";case"xl":return"text-xl";default:return"text-base"}},c=()=>{switch(s){case"white":return"text-white";case"secondary":return"text-text-secondary";case"primary":return"text-primary";case"danger":return"text-red-400";case"success":return"text-green-400";default:return"text-white"}};return n.jsx("p",{className:`${l()} ${c()} ${r}`,...a,children:e})};function is(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return o.useMemo(()=>r=>{t.forEach(a=>a(r))},t)}const Ct=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Xe(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function _t(e){return"nodeType"in e}function he(e){var t,s;return e?Xe(e)?e:_t(e)&&(t=(s=e.ownerDocument)==null?void 0:s.defaultView)!=null?t:window:window}function Ht(e){const{Document:t}=he(e);return e instanceof t}function lt(e){return Xe(e)?!1:e instanceof he(e).HTMLElement}function vn(e){return e instanceof he(e).SVGElement}function _e(e){return e?Xe(e)?e.document:_t(e)?Ht(e)?e:lt(e)||vn(e)?e.ownerDocument:document:document:document}const Ce=Ct?o.useLayoutEffect:o.useEffect;function Yt(e){const t=o.useRef(e);return Ce(()=>{t.current=e}),o.useCallback(function(){for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return t.current==null?void 0:t.current(...r)},[])}function ls(){const e=o.useRef(null),t=o.useCallback((r,a)=>{e.current=setInterval(r,a)},[]),s=o.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,s]}function st(e,t){t===void 0&&(t=[e]);const s=o.useRef(e);return Ce(()=>{s.current!==e&&(s.current=e)},t),s}function ot(e,t){const s=o.useRef();return o.useMemo(()=>{const r=e(s.current);return s.current=r,r},[...t])}function wt(e){const t=Yt(e),s=o.useRef(null),r=o.useCallback(a=>{a!==s.current&&(t==null||t(a,s.current)),s.current=a},[]);return[s,r]}function Pt(e){const t=o.useRef();return o.useEffect(()=>{t.current=e},[e]),t.current}let At={};function ct(e,t){return o.useMemo(()=>{if(t)return t;const s=At[e]==null?0:At[e]+1;return At[e]=s,e+"-"+s},[e,t])}function yn(e){return function(t){for(var s=arguments.length,r=new Array(s>1?s-1:0),a=1;a<s;a++)r[a-1]=arguments[a];return r.reduce((l,c)=>{const d=Object.entries(c);for(const[u,h]of d){const m=l[u];m!=null&&(l[u]=m+e*h)}return l},{...t})}}const We=yn(1),rt=yn(-1);function os(e){return"clientX"in e&&"clientY"in e}function Vt(e){if(!e)return!1;const{KeyboardEvent:t}=he(e.target);return t&&e instanceof t}function cs(e){if(!e)return!1;const{TouchEvent:t}=he(e.target);return t&&e instanceof t}function Bt(e){if(cs(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:s}=e.touches[0];return{x:t,y:s}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:s}=e.changedTouches[0];return{x:t,y:s}}}return os(e)?{x:e.clientX,y:e.clientY}:null}const at=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:s}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(s?Math.round(s):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:s}=e;return"scaleX("+t+") scaleY("+s+")"}},Transform:{toString(e){if(e)return[at.Translate.toString(e),at.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:s,easing:r}=e;return t+" "+s+"ms "+r}}}),en="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function ds(e){return e.matches(en)?e:e.querySelector(en)}const us={display:"none"};function hs(e){let{id:t,value:s}=e;return ue.createElement("div",{id:t,style:us},s)}function fs(e){let{id:t,announcement:s,ariaLiveType:r="assertive"}=e;const a={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return ue.createElement("div",{id:t,style:a,role:"status","aria-live":r,"aria-atomic":!0},s)}function ms(){const[e,t]=o.useState("");return{announce:o.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const wn=o.createContext(null);function gs(e){const t=o.useContext(wn);o.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function xs(){const[e]=o.useState(()=>new Set),t=o.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[o.useCallback(r=>{let{type:a,event:l}=r;e.forEach(c=>{var d;return(d=c[a])==null?void 0:d.call(c,l)})},[e]),t]}const bs={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},ps={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:s}=e;return s?"Draggable item "+t.id+" was moved over droppable area "+s.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:s}=e;return s?"Draggable item "+t.id+" was dropped over droppable area "+s.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function vs(e){let{announcements:t=ps,container:s,hiddenTextDescribedById:r,screenReaderInstructions:a=bs}=e;const{announce:l,announcement:c}=ms(),d=ct("DndLiveRegion"),[u,h]=o.useState(!1);if(o.useEffect(()=>{h(!0)},[]),gs(o.useMemo(()=>({onDragStart(f){let{active:w}=f;l(t.onDragStart({active:w}))},onDragMove(f){let{active:w,over:b}=f;t.onDragMove&&l(t.onDragMove({active:w,over:b}))},onDragOver(f){let{active:w,over:b}=f;l(t.onDragOver({active:w,over:b}))},onDragEnd(f){let{active:w,over:b}=f;l(t.onDragEnd({active:w,over:b}))},onDragCancel(f){let{active:w,over:b}=f;l(t.onDragCancel({active:w,over:b}))}}),[l,t])),!u)return null;const m=ue.createElement(ue.Fragment,null,ue.createElement(hs,{id:r,value:a.draggable}),ue.createElement(fs,{id:d,announcement:c}));return s?Ze.createPortal(m,s):m}var G;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(G||(G={}));function jt(){}function tn(e,t){return o.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function ys(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return o.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const we=Object.freeze({x:0,y:0});function jn(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Nn(e,t){let{data:{value:s}}=e,{data:{value:r}}=t;return s-r}function ws(e,t){let{data:{value:s}}=e,{data:{value:r}}=t;return r-s}function nn(e){let{left:t,top:s,height:r,width:a}=e;return[{x:t,y:s},{x:t+a,y:s},{x:t,y:s+r},{x:t+a,y:s+r}]}function Dn(e,t){if(!e||e.length===0)return null;const[s]=e;return s[t]}function sn(e,t,s){return t===void 0&&(t=e.left),s===void 0&&(s=e.top),{x:t+e.width*.5,y:s+e.height*.5}}const js=e=>{let{collisionRect:t,droppableRects:s,droppableContainers:r}=e;const a=sn(t,t.left,t.top),l=[];for(const c of r){const{id:d}=c,u=s.get(d);if(u){const h=jn(sn(u),a);l.push({id:d,data:{droppableContainer:c,value:h}})}}return l.sort(Nn)},Ns=e=>{let{collisionRect:t,droppableRects:s,droppableContainers:r}=e;const a=nn(t),l=[];for(const c of r){const{id:d}=c,u=s.get(d);if(u){const h=nn(u),m=a.reduce((w,b,E)=>w+jn(h[E],b),0),f=Number((m/4).toFixed(4));l.push({id:d,data:{droppableContainer:c,value:f}})}}return l.sort(Nn)};function Ds(e,t){const s=Math.max(t.top,e.top),r=Math.max(t.left,e.left),a=Math.min(t.left+t.width,e.left+e.width),l=Math.min(t.top+t.height,e.top+e.height),c=a-r,d=l-s;if(r<a&&s<l){const u=t.width*t.height,h=e.width*e.height,m=c*d,f=m/(u+h-m);return Number(f.toFixed(4))}return 0}const Cs=e=>{let{collisionRect:t,droppableRects:s,droppableContainers:r}=e;const a=[];for(const l of r){const{id:c}=l,d=s.get(c);if(d){const u=Ds(d,t);u>0&&a.push({id:c,data:{droppableContainer:l,value:u}})}}return a.sort(ws)};function Ss(e,t,s){return{...e,scaleX:t&&s?t.width/s.width:1,scaleY:t&&s?t.height/s.height:1}}function Cn(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:we}function Rs(e){return function(s){for(var r=arguments.length,a=new Array(r>1?r-1:0),l=1;l<r;l++)a[l-1]=arguments[l];return a.reduce((c,d)=>({...c,top:c.top+e*d.y,bottom:c.bottom+e*d.y,left:c.left+e*d.x,right:c.right+e*d.x}),{...s})}}const Es=Rs(1);function Ts(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Ms(e,t,s){const r=Ts(t);if(!r)return e;const{scaleX:a,scaleY:l,x:c,y:d}=r,u=e.left-c-(1-a)*parseFloat(s),h=e.top-d-(1-l)*parseFloat(s.slice(s.indexOf(" ")+1)),m=a?e.width/a:e.width,f=l?e.height/l:e.height;return{width:m,height:f,top:h,right:u+m,bottom:h+f,left:u}}const ks={ignoreTransform:!1};function He(e,t){t===void 0&&(t=ks);let s=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:h,transformOrigin:m}=he(e).getComputedStyle(e);h&&(s=Ms(s,h,m))}const{top:r,left:a,width:l,height:c,bottom:d,right:u}=s;return{top:r,left:a,width:l,height:c,bottom:d,right:u}}function rn(e){return He(e,{ignoreTransform:!0})}function Is(e){const t=e.innerWidth,s=e.innerHeight;return{top:0,left:0,right:t,bottom:s,width:t,height:s}}function Os(e,t){return t===void 0&&(t=he(e).getComputedStyle(e)),t.position==="fixed"}function zs(e,t){t===void 0&&(t=he(e).getComputedStyle(e));const s=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(a=>{const l=t[a];return typeof l=="string"?s.test(l):!1})}function St(e,t){const s=[];function r(a){if(t!=null&&s.length>=t||!a)return s;if(Ht(a)&&a.scrollingElement!=null&&!s.includes(a.scrollingElement))return s.push(a.scrollingElement),s;if(!lt(a)||vn(a)||s.includes(a))return s;const l=he(e).getComputedStyle(a);return a!==e&&zs(a,l)&&s.push(a),Os(a,l)?s:r(a.parentNode)}return e?r(e):s}function Sn(e){const[t]=St(e,1);return t??null}function Lt(e){return!Ct||!e?null:Xe(e)?e:_t(e)?Ht(e)||e===_e(e).scrollingElement?window:lt(e)?e:null:null}function Rn(e){return Xe(e)?e.scrollX:e.scrollLeft}function En(e){return Xe(e)?e.scrollY:e.scrollTop}function qt(e){return{x:Rn(e),y:En(e)}}var Z;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(Z||(Z={}));function Tn(e){return!Ct||!e?!1:e===document.scrollingElement}function Mn(e){const t={x:0,y:0},s=Tn(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-s.width,y:e.scrollHeight-s.height},a=e.scrollTop<=t.y,l=e.scrollLeft<=t.x,c=e.scrollTop>=r.y,d=e.scrollLeft>=r.x;return{isTop:a,isLeft:l,isBottom:c,isRight:d,maxScroll:r,minScroll:t}}const As={x:.2,y:.2};function Ls(e,t,s,r,a){let{top:l,left:c,right:d,bottom:u}=s;r===void 0&&(r=10),a===void 0&&(a=As);const{isTop:h,isBottom:m,isLeft:f,isRight:w}=Mn(e),b={x:0,y:0},E={x:0,y:0},p={height:t.height*a.y,width:t.width*a.x};return!h&&l<=t.top+p.height?(b.y=Z.Backward,E.y=r*Math.abs((t.top+p.height-l)/p.height)):!m&&u>=t.bottom-p.height&&(b.y=Z.Forward,E.y=r*Math.abs((t.bottom-p.height-u)/p.height)),!w&&d>=t.right-p.width?(b.x=Z.Forward,E.x=r*Math.abs((t.right-p.width-d)/p.width)):!f&&c<=t.left+p.width&&(b.x=Z.Backward,E.x=r*Math.abs((t.left+p.width-c)/p.width)),{direction:b,speed:E}}function $s(e){if(e===document.scrollingElement){const{innerWidth:l,innerHeight:c}=window;return{top:0,left:0,right:l,bottom:c,width:l,height:c}}const{top:t,left:s,right:r,bottom:a}=e.getBoundingClientRect();return{top:t,left:s,right:r,bottom:a,width:e.clientWidth,height:e.clientHeight}}function kn(e){return e.reduce((t,s)=>We(t,qt(s)),we)}function Fs(e){return e.reduce((t,s)=>t+Rn(s),0)}function Ps(e){return e.reduce((t,s)=>t+En(s),0)}function Bs(e,t){if(t===void 0&&(t=He),!e)return;const{top:s,left:r,bottom:a,right:l}=t(e);Sn(e)&&(a<=0||l<=0||s>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const qs=[["x",["left","right"],Fs],["y",["top","bottom"],Ps]];class Kt{constructor(t,s){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=St(s),a=kn(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[l,c,d]of qs)for(const u of c)Object.defineProperty(this,u,{get:()=>{const h=d(r),m=a[l]-h;return this.rect[u]+m},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class et{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(s=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...s)})},this.target=t}add(t,s,r){var a;(a=this.target)==null||a.addEventListener(t,s,r),this.listeners.push([t,s,r])}}function Us(e){const{EventTarget:t}=he(e);return e instanceof t?e:_e(e)}function $t(e,t){const s=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(s**2+r**2)>t:"x"in t&&"y"in t?s>t.x&&r>t.y:"x"in t?s>t.x:"y"in t?r>t.y:!1}var pe;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(pe||(pe={}));function an(e){e.preventDefault()}function Ws(e){e.stopPropagation()}var F;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(F||(F={}));const In={start:[F.Space,F.Enter],cancel:[F.Esc],end:[F.Space,F.Enter,F.Tab]},Xs=(e,t)=>{let{currentCoordinates:s}=t;switch(e.code){case F.Right:return{...s,x:s.x+25};case F.Left:return{...s,x:s.x-25};case F.Down:return{...s,y:s.y+25};case F.Up:return{...s,y:s.y-25}}};class Gt{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:s}}=t;this.props=t,this.listeners=new et(_e(s)),this.windowListeners=new et(he(s)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(pe.Resize,this.handleCancel),this.windowListeners.add(pe.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(pe.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:s}=this.props,r=t.node.current;r&&Bs(r),s(we)}handleKeyDown(t){if(Vt(t)){const{active:s,context:r,options:a}=this.props,{keyboardCodes:l=In,coordinateGetter:c=Xs,scrollBehavior:d="smooth"}=a,{code:u}=t;if(l.end.includes(u)){this.handleEnd(t);return}if(l.cancel.includes(u)){this.handleCancel(t);return}const{collisionRect:h}=r.current,m=h?{x:h.left,y:h.top}:we;this.referenceCoordinates||(this.referenceCoordinates=m);const f=c(t,{active:s,context:r.current,currentCoordinates:m});if(f){const w=rt(f,m),b={x:0,y:0},{scrollableAncestors:E}=r.current;for(const p of E){const N=t.code,{isTop:R,isRight:S,isLeft:M,isBottom:k,maxScroll:L,minScroll:j}=Mn(p),I=$s(p),C={x:Math.min(N===F.Right?I.right-I.width/2:I.right,Math.max(N===F.Right?I.left:I.left+I.width/2,f.x)),y:Math.min(N===F.Down?I.bottom-I.height/2:I.bottom,Math.max(N===F.Down?I.top:I.top+I.height/2,f.y))},W=N===F.Right&&!S||N===F.Left&&!M,z=N===F.Down&&!k||N===F.Up&&!R;if(W&&C.x!==f.x){const q=p.scrollLeft+w.x,_=N===F.Right&&q<=L.x||N===F.Left&&q>=j.x;if(_&&!w.y){p.scrollTo({left:q,behavior:d});return}_?b.x=p.scrollLeft-q:b.x=N===F.Right?p.scrollLeft-L.x:p.scrollLeft-j.x,b.x&&p.scrollBy({left:-b.x,behavior:d});break}else if(z&&C.y!==f.y){const q=p.scrollTop+w.y,_=N===F.Down&&q<=L.y||N===F.Up&&q>=j.y;if(_&&!w.x){p.scrollTo({top:q,behavior:d});return}_?b.y=p.scrollTop-q:b.y=N===F.Down?p.scrollTop-L.y:p.scrollTop-j.y,b.y&&p.scrollBy({top:-b.y,behavior:d});break}}this.handleMove(t,We(rt(f,this.referenceCoordinates),b))}}}handleMove(t,s){const{onMove:r}=this.props;t.preventDefault(),r(s)}handleEnd(t){const{onEnd:s}=this.props;t.preventDefault(),this.detach(),s()}handleCancel(t){const{onCancel:s}=this.props;t.preventDefault(),this.detach(),s()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Gt.activators=[{eventName:"onKeyDown",handler:(e,t,s)=>{let{keyboardCodes:r=In,onActivation:a}=t,{active:l}=s;const{code:c}=e.nativeEvent;if(r.start.includes(c)){const d=l.activatorNode.current;return d&&e.target!==d?!1:(e.preventDefault(),a==null||a({event:e.nativeEvent}),!0)}return!1}}];function ln(e){return!!(e&&"distance"in e)}function on(e){return!!(e&&"delay"in e)}class Jt{constructor(t,s,r){var a;r===void 0&&(r=Us(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=s;const{event:l}=t,{target:c}=l;this.props=t,this.events=s,this.document=_e(c),this.documentListeners=new et(this.document),this.listeners=new et(r),this.windowListeners=new et(he(c)),this.initialCoordinates=(a=Bt(l))!=null?a:we,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:s,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(pe.Resize,this.handleCancel),this.windowListeners.add(pe.DragStart,an),this.windowListeners.add(pe.VisibilityChange,this.handleCancel),this.windowListeners.add(pe.ContextMenu,an),this.documentListeners.add(pe.Keydown,this.handleKeydown),s){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(on(s)){this.timeoutId=setTimeout(this.handleStart,s.delay),this.handlePending(s);return}if(ln(s)){this.handlePending(s);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,s){const{active:r,onPending:a}=this.props;a(r,t,this.initialCoordinates,s)}handleStart(){const{initialCoordinates:t}=this,{onStart:s}=this.props;t&&(this.activated=!0,this.documentListeners.add(pe.Click,Ws,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(pe.SelectionChange,this.removeTextSelection),s(t))}handleMove(t){var s;const{activated:r,initialCoordinates:a,props:l}=this,{onMove:c,options:{activationConstraint:d}}=l;if(!a)return;const u=(s=Bt(t))!=null?s:we,h=rt(a,u);if(!r&&d){if(ln(d)){if(d.tolerance!=null&&$t(h,d.tolerance))return this.handleCancel();if($t(h,d.distance))return this.handleStart()}if(on(d)&&$t(h,d.tolerance))return this.handleCancel();this.handlePending(d,h);return}t.cancelable&&t.preventDefault(),c(u)}handleEnd(){const{onAbort:t,onEnd:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleCancel(){const{onAbort:t,onCancel:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleKeydown(t){t.code===F.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const _s={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Zt extends Jt{constructor(t){const{event:s}=t,r=_e(s.target);super(t,_s,r)}}Zt.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:r}=t;return!s.isPrimary||s.button!==0?!1:(r==null||r({event:s}),!0)}}];const Hs={move:{name:"mousemove"},end:{name:"mouseup"}};var Ut;(function(e){e[e.RightClick=2]="RightClick"})(Ut||(Ut={}));class Ys extends Jt{constructor(t){super(t,Hs,_e(t.event.target))}}Ys.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:r}=t;return s.button===Ut.RightClick?!1:(r==null||r({event:s}),!0)}}];const Ft={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Vs extends Jt{constructor(t){super(t,Ft)}static setup(){return window.addEventListener(Ft.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Ft.move.name,t)};function t(){}}}Vs.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:r}=t;const{touches:a}=s;return a.length>1?!1:(r==null||r({event:s}),!0)}}];var tt;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(tt||(tt={}));var Nt;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(Nt||(Nt={}));function Ks(e){let{acceleration:t,activator:s=tt.Pointer,canScroll:r,draggingRect:a,enabled:l,interval:c=5,order:d=Nt.TreeOrder,pointerCoordinates:u,scrollableAncestors:h,scrollableAncestorRects:m,delta:f,threshold:w}=e;const b=Js({delta:f,disabled:!l}),[E,p]=ls(),N=o.useRef({x:0,y:0}),R=o.useRef({x:0,y:0}),S=o.useMemo(()=>{switch(s){case tt.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case tt.DraggableRect:return a}},[s,a,u]),M=o.useRef(null),k=o.useCallback(()=>{const j=M.current;if(!j)return;const I=N.current.x*R.current.x,C=N.current.y*R.current.y;j.scrollBy(I,C)},[]),L=o.useMemo(()=>d===Nt.TreeOrder?[...h].reverse():h,[d,h]);o.useEffect(()=>{if(!l||!h.length||!S){p();return}for(const j of L){if((r==null?void 0:r(j))===!1)continue;const I=h.indexOf(j),C=m[I];if(!C)continue;const{direction:W,speed:z}=Ls(j,C,S,t,w);for(const q of["x","y"])b[q][W[q]]||(z[q]=0,W[q]=0);if(z.x>0||z.y>0){p(),M.current=j,E(k,c),N.current=z,R.current=W;return}}N.current={x:0,y:0},R.current={x:0,y:0},p()},[t,k,r,p,l,c,JSON.stringify(S),JSON.stringify(b),E,h,L,m,JSON.stringify(w)])}const Gs={x:{[Z.Backward]:!1,[Z.Forward]:!1},y:{[Z.Backward]:!1,[Z.Forward]:!1}};function Js(e){let{delta:t,disabled:s}=e;const r=Pt(t);return ot(a=>{if(s||!r||!a)return Gs;const l={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[Z.Backward]:a.x[Z.Backward]||l.x===-1,[Z.Forward]:a.x[Z.Forward]||l.x===1},y:{[Z.Backward]:a.y[Z.Backward]||l.y===-1,[Z.Forward]:a.y[Z.Forward]||l.y===1}}},[s,t,r])}function Zs(e,t){const s=t!=null?e.get(t):void 0,r=s?s.node.current:null;return ot(a=>{var l;return t==null?null:(l=r??a)!=null?l:null},[r,t])}function Qs(e,t){return o.useMemo(()=>e.reduce((s,r)=>{const{sensor:a}=r,l=a.activators.map(c=>({eventName:c.eventName,handler:t(c.handler,r)}));return[...s,...l]},[]),[e,t])}var it;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(it||(it={}));var Wt;(function(e){e.Optimized="optimized"})(Wt||(Wt={}));const cn=new Map;function er(e,t){let{dragging:s,dependencies:r,config:a}=t;const[l,c]=o.useState(null),{frequency:d,measure:u,strategy:h}=a,m=o.useRef(e),f=N(),w=st(f),b=o.useCallback(function(R){R===void 0&&(R=[]),!w.current&&c(S=>S===null?R:S.concat(R.filter(M=>!S.includes(M))))},[w]),E=o.useRef(null),p=ot(R=>{if(f&&!s)return cn;if(!R||R===cn||m.current!==e||l!=null){const S=new Map;for(let M of e){if(!M)continue;if(l&&l.length>0&&!l.includes(M.id)&&M.rect.current){S.set(M.id,M.rect.current);continue}const k=M.node.current,L=k?new Kt(u(k),k):null;M.rect.current=L,L&&S.set(M.id,L)}return S}return R},[e,l,s,f,u]);return o.useEffect(()=>{m.current=e},[e]),o.useEffect(()=>{f||b()},[s,f]),o.useEffect(()=>{l&&l.length>0&&c(null)},[JSON.stringify(l)]),o.useEffect(()=>{f||typeof d!="number"||E.current!==null||(E.current=setTimeout(()=>{b(),E.current=null},d))},[d,f,b,...r]),{droppableRects:p,measureDroppableContainers:b,measuringScheduled:l!=null};function N(){switch(h){case it.Always:return!1;case it.BeforeDragging:return s;default:return!s}}}function On(e,t){return ot(s=>e?s||(typeof t=="function"?t(e):e):null,[t,e])}function tr(e,t){return On(e,t)}function nr(e){let{callback:t,disabled:s}=e;const r=Yt(t),a=o.useMemo(()=>{if(s||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:l}=window;return new l(r)},[r,s]);return o.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function Rt(e){let{callback:t,disabled:s}=e;const r=Yt(t),a=o.useMemo(()=>{if(s||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:l}=window;return new l(r)},[s]);return o.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function sr(e){return new Kt(He(e),e)}function dn(e,t,s){t===void 0&&(t=sr);const[r,a]=o.useState(null);function l(){a(u=>{if(!e)return null;if(e.isConnected===!1){var h;return(h=u??s)!=null?h:null}const m=t(e);return JSON.stringify(u)===JSON.stringify(m)?u:m})}const c=nr({callback(u){if(e)for(const h of u){const{type:m,target:f}=h;if(m==="childList"&&f instanceof HTMLElement&&f.contains(e)){l();break}}}}),d=Rt({callback:l});return Ce(()=>{l(),e?(d==null||d.observe(e),c==null||c.observe(document.body,{childList:!0,subtree:!0})):(d==null||d.disconnect(),c==null||c.disconnect())},[e]),r}function rr(e){const t=On(e);return Cn(e,t)}const un=[];function ar(e){const t=o.useRef(e),s=ot(r=>e?r&&r!==un&&e&&t.current&&e.parentNode===t.current.parentNode?r:St(e):un,[e]);return o.useEffect(()=>{t.current=e},[e]),s}function ir(e){const[t,s]=o.useState(null),r=o.useRef(e),a=o.useCallback(l=>{const c=Lt(l.target);c&&s(d=>d?(d.set(c,qt(c)),new Map(d)):null)},[]);return o.useEffect(()=>{const l=r.current;if(e!==l){c(l);const d=e.map(u=>{const h=Lt(u);return h?(h.addEventListener("scroll",a,{passive:!0}),[h,qt(h)]):null}).filter(u=>u!=null);s(d.length?new Map(d):null),r.current=e}return()=>{c(e),c(l)};function c(d){d.forEach(u=>{const h=Lt(u);h==null||h.removeEventListener("scroll",a)})}},[a,e]),o.useMemo(()=>e.length?t?Array.from(t.values()).reduce((l,c)=>We(l,c),we):kn(e):we,[e,t])}function hn(e,t){t===void 0&&(t=[]);const s=o.useRef(null);return o.useEffect(()=>{s.current=null},t),o.useEffect(()=>{const r=e!==we;r&&!s.current&&(s.current=e),!r&&s.current&&(s.current=null)},[e]),s.current?rt(e,s.current):we}function lr(e){o.useEffect(()=>{if(!Ct)return;const t=e.map(s=>{let{sensor:r}=s;return r.setup==null?void 0:r.setup()});return()=>{for(const s of t)s==null||s()}},e.map(t=>{let{sensor:s}=t;return s}))}function or(e,t){return o.useMemo(()=>e.reduce((s,r)=>{let{eventName:a,handler:l}=r;return s[a]=c=>{l(c,t)},s},{}),[e,t])}function zn(e){return o.useMemo(()=>e?Is(e):null,[e])}const fn=[];function cr(e,t){t===void 0&&(t=He);const[s]=e,r=zn(s?he(s):null),[a,l]=o.useState(fn);function c(){l(()=>e.length?e.map(u=>Tn(u)?r:new Kt(t(u),u)):fn)}const d=Rt({callback:c});return Ce(()=>{d==null||d.disconnect(),c(),e.forEach(u=>d==null?void 0:d.observe(u))},[e]),a}function dr(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return lt(t)?t:e}function ur(e){let{measure:t}=e;const[s,r]=o.useState(null),a=o.useCallback(h=>{for(const{target:m}of h)if(lt(m)){r(f=>{const w=t(m);return f?{...f,width:w.width,height:w.height}:w});break}},[t]),l=Rt({callback:a}),c=o.useCallback(h=>{const m=dr(h);l==null||l.disconnect(),m&&(l==null||l.observe(m)),r(m?t(m):null)},[t,l]),[d,u]=wt(c);return o.useMemo(()=>({nodeRef:d,rect:s,setRef:u}),[s,d,u])}const hr=[{sensor:Zt,options:{}},{sensor:Gt,options:{}}],fr={current:{}},vt={draggable:{measure:rn},droppable:{measure:rn,strategy:it.WhileDragging,frequency:Wt.Optimized},dragOverlay:{measure:He}};class nt extends Map{get(t){var s;return t!=null&&(s=super.get(t))!=null?s:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:s}=t;return!s})}getNodeFor(t){var s,r;return(s=(r=this.get(t))==null?void 0:r.node.current)!=null?s:void 0}}const mr={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new nt,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:jt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:vt,measureDroppableContainers:jt,windowRect:null,measuringScheduled:!1},gr={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:jt,draggableNodes:new Map,over:null,measureDroppableContainers:jt},Et=o.createContext(gr),An=o.createContext(mr);function xr(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new nt}}}function br(e,t){switch(t.type){case G.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case G.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case G.DragEnd:case G.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case G.RegisterDroppable:{const{element:s}=t,{id:r}=s,a=new nt(e.droppable.containers);return a.set(r,s),{...e,droppable:{...e.droppable,containers:a}}}case G.SetDroppableDisabled:{const{id:s,key:r,disabled:a}=t,l=e.droppable.containers.get(s);if(!l||r!==l.key)return e;const c=new nt(e.droppable.containers);return c.set(s,{...l,disabled:a}),{...e,droppable:{...e.droppable,containers:c}}}case G.UnregisterDroppable:{const{id:s,key:r}=t,a=e.droppable.containers.get(s);if(!a||r!==a.key)return e;const l=new nt(e.droppable.containers);return l.delete(s),{...e,droppable:{...e.droppable,containers:l}}}default:return e}}function pr(e){let{disabled:t}=e;const{active:s,activatorEvent:r,draggableNodes:a}=o.useContext(Et),l=Pt(r),c=Pt(s==null?void 0:s.id);return o.useEffect(()=>{if(!t&&!r&&l&&c!=null){if(!Vt(l)||document.activeElement===l.target)return;const d=a.get(c);if(!d)return;const{activatorNode:u,node:h}=d;if(!u.current&&!h.current)return;requestAnimationFrame(()=>{for(const m of[u.current,h.current]){if(!m)continue;const f=ds(m);if(f){f.focus();break}}})}},[r,t,a,c,l]),null}function vr(e,t){let{transform:s,...r}=t;return e!=null&&e.length?e.reduce((a,l)=>l({transform:a,...r}),s):s}function yr(e){return o.useMemo(()=>({draggable:{...vt.draggable,...e==null?void 0:e.draggable},droppable:{...vt.droppable,...e==null?void 0:e.droppable},dragOverlay:{...vt.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function wr(e){let{activeNode:t,measure:s,initialRect:r,config:a=!0}=e;const l=o.useRef(!1),{x:c,y:d}=typeof a=="boolean"?{x:a,y:a}:a;Ce(()=>{if(!c&&!d||!t){l.current=!1;return}if(l.current||!r)return;const h=t==null?void 0:t.node.current;if(!h||h.isConnected===!1)return;const m=s(h),f=Cn(m,r);if(c||(f.x=0),d||(f.y=0),l.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const w=Sn(h);w&&w.scrollBy({top:f.y,left:f.x})}},[t,c,d,r,s])}const Ln=o.createContext({...we,scaleX:1,scaleY:1});var $e;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})($e||($e={}));const jr=o.memo(function(t){var s,r,a,l;let{id:c,accessibility:d,autoScroll:u=!0,children:h,sensors:m=hr,collisionDetection:f=Cs,measuring:w,modifiers:b,...E}=t;const p=o.useReducer(br,void 0,xr),[N,R]=p,[S,M]=xs(),[k,L]=o.useState($e.Uninitialized),j=k===$e.Initialized,{draggable:{active:I,nodes:C,translate:W},droppable:{containers:z}}=N,q=I!=null?C.get(I):null,_=o.useRef({initial:null,translated:null}),se=o.useMemo(()=>{var v;return I!=null?{id:I,data:(v=q==null?void 0:q.data)!=null?v:fr,rect:_}:null},[I,q]),re=o.useRef(null),[$,U]=o.useState(null),[A,ae]=o.useState(null),fe=st(E,Object.values(E)),ie=ct("DndDescribedBy",c),Ee=o.useMemo(()=>z.getEnabled(),[z]),H=yr(w),{droppableRects:me,measureDroppableContainers:ge,measuringScheduled:Te}=er(Ee,{dragging:j,dependencies:[W.x,W.y],config:H.droppable}),Q=Zs(C,I),xe=o.useMemo(()=>A?Bt(A):null,[A]),ee=x(),le=tr(Q,H.draggable.measure);wr({activeNode:I!=null?C.get(I):null,config:ee.layoutShiftCompensation,initialRect:le,measure:H.draggable.measure});const B=dn(Q,H.draggable.measure,le),Me=dn(Q?Q.parentElement:null),be=o.useRef({activatorEvent:null,active:null,activeNode:Q,collisionRect:null,collisions:null,droppableRects:me,draggableNodes:C,draggingNode:null,draggingNodeRect:null,droppableContainers:z,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Se=z.getNodeFor((s=be.current.over)==null?void 0:s.id),ve=ur({measure:H.dragOverlay.measure}),ke=(r=ve.nodeRef.current)!=null?r:Q,Ie=j?(a=ve.rect)!=null?a:B:null,dt=!!(ve.nodeRef.current&&ve.rect),ut=rr(dt?null:B),Be=zn(ke?he(ke):null),oe=ar(j?Se??Q:null),qe=cr(oe),Fe=vr(b,{transform:{x:W.x-ut.x,y:W.y-ut.y,scaleX:1,scaleY:1},activatorEvent:A,active:se,activeNodeRect:B,containerNodeRect:Me,draggingNodeRect:Ie,over:be.current.over,overlayNodeRect:ve.rect,scrollableAncestors:oe,scrollableAncestorRects:qe,windowRect:Be}),V=xe?We(xe,W):null,ht=ir(oe),Tt=hn(ht),Mt=hn(ht,[B]),Oe=We(Fe,Tt),ze=Ie?Es(Ie,Fe):null,Pe=se&&ze?f({active:se,collisionRect:ze,droppableRects:me,droppableContainers:Ee,pointerCoordinates:V}):null,ft=Dn(Pe,"id"),[je,mt]=o.useState(null),kt=dt?Fe:We(Fe,Mt),It=Ss(kt,(l=je==null?void 0:je.rect)!=null?l:null,B),Ye=o.useRef(null),gt=o.useCallback((v,O)=>{let{sensor:D,options:T}=O;if(re.current==null)return;const J=C.get(re.current);if(!J)return;const te=v.nativeEvent,K=new D({active:re.current,activeNode:J,event:te,options:T,context:be,onAbort(Y){if(!C.get(Y))return;const{onDragAbort:Ne}=fe.current,Re={id:Y};Ne==null||Ne(Re),S({type:"onDragAbort",event:Re})},onPending(Y,Ae,Ne,Re){if(!C.get(Y))return;const{onDragPending:Ke}=fe.current,Le={id:Y,constraint:Ae,initialCoordinates:Ne,offset:Re};Ke==null||Ke(Le),S({type:"onDragPending",event:Le})},onStart(Y){const Ae=re.current;if(Ae==null)return;const Ne=C.get(Ae);if(!Ne)return;const{onDragStart:Re}=fe.current,Ve={activatorEvent:te,active:{id:Ae,data:Ne.data,rect:_}};Ze.unstable_batchedUpdates(()=>{Re==null||Re(Ve),L($e.Initializing),R({type:G.DragStart,initialCoordinates:Y,active:Ae}),S({type:"onDragStart",event:Ve}),U(Ye.current),ae(te)})},onMove(Y){R({type:G.DragMove,coordinates:Y})},onEnd:ce(G.DragEnd),onCancel:ce(G.DragCancel)});Ye.current=K;function ce(Y){return async function(){const{active:Ne,collisions:Re,over:Ve,scrollAdjustedTranslate:Ke}=be.current;let Le=null;if(Ne&&Ke){const{cancelDrop:Ge}=fe.current;Le={activatorEvent:te,active:Ne,collisions:Re,delta:Ke,over:Ve},Y===G.DragEnd&&typeof Ge=="function"&&await Promise.resolve(Ge(Le))&&(Y=G.DragCancel)}re.current=null,Ze.unstable_batchedUpdates(()=>{R({type:Y}),L($e.Uninitialized),mt(null),U(null),ae(null),Ye.current=null;const Ge=Y===G.DragEnd?"onDragEnd":"onDragCancel";if(Le){const zt=fe.current[Ge];zt==null||zt(Le),S({type:Ge,event:Le})}})}}},[C]),Ot=o.useCallback((v,O)=>(D,T)=>{const J=D.nativeEvent,te=C.get(T);if(re.current!==null||!te||J.dndKit||J.defaultPrevented)return;const K={active:te};v(D,O.options,K)===!0&&(J.dndKit={capturedBy:O.sensor},re.current=T,gt(D,O))},[C,gt]),xt=Qs(m,Ot);lr(m),Ce(()=>{B&&k===$e.Initializing&&L($e.Initialized)},[B,k]),o.useEffect(()=>{const{onDragMove:v}=fe.current,{active:O,activatorEvent:D,collisions:T,over:J}=be.current;if(!O||!D)return;const te={active:O,activatorEvent:D,collisions:T,delta:{x:Oe.x,y:Oe.y},over:J};Ze.unstable_batchedUpdates(()=>{v==null||v(te),S({type:"onDragMove",event:te})})},[Oe.x,Oe.y]),o.useEffect(()=>{const{active:v,activatorEvent:O,collisions:D,droppableContainers:T,scrollAdjustedTranslate:J}=be.current;if(!v||re.current==null||!O||!J)return;const{onDragOver:te}=fe.current,K=T.get(ft),ce=K&&K.rect.current?{id:K.id,rect:K.rect.current,data:K.data,disabled:K.disabled}:null,Y={active:v,activatorEvent:O,collisions:D,delta:{x:J.x,y:J.y},over:ce};Ze.unstable_batchedUpdates(()=>{mt(ce),te==null||te(Y),S({type:"onDragOver",event:Y})})},[ft]),Ce(()=>{be.current={activatorEvent:A,active:se,activeNode:Q,collisionRect:ze,collisions:Pe,droppableRects:me,draggableNodes:C,draggingNode:ke,draggingNodeRect:Ie,droppableContainers:z,over:je,scrollableAncestors:oe,scrollAdjustedTranslate:Oe},_.current={initial:Ie,translated:ze}},[se,Q,Pe,ze,C,ke,Ie,me,z,je,oe,Oe]),Ks({...ee,delta:W,draggingRect:ze,pointerCoordinates:V,scrollableAncestors:oe,scrollableAncestorRects:qe});const i=o.useMemo(()=>({active:se,activeNode:Q,activeNodeRect:B,activatorEvent:A,collisions:Pe,containerNodeRect:Me,dragOverlay:ve,draggableNodes:C,droppableContainers:z,droppableRects:me,over:je,measureDroppableContainers:ge,scrollableAncestors:oe,scrollableAncestorRects:qe,measuringConfiguration:H,measuringScheduled:Te,windowRect:Be}),[se,Q,B,A,Pe,Me,ve,C,z,me,je,ge,oe,qe,H,Te,Be]),g=o.useMemo(()=>({activatorEvent:A,activators:xt,active:se,activeNodeRect:B,ariaDescribedById:{draggable:ie},dispatch:R,draggableNodes:C,over:je,measureDroppableContainers:ge}),[A,xt,se,B,R,ie,C,je,ge]);return ue.createElement(wn.Provider,{value:M},ue.createElement(Et.Provider,{value:g},ue.createElement(An.Provider,{value:i},ue.createElement(Ln.Provider,{value:It},h)),ue.createElement(pr,{disabled:(d==null?void 0:d.restoreFocus)===!1})),ue.createElement(vs,{...d,hiddenTextDescribedById:ie}));function x(){const v=($==null?void 0:$.autoScrollEnabled)===!1,O=typeof u=="object"?u.enabled===!1:u===!1,D=j&&!v&&!O;return typeof u=="object"?{...u,enabled:D}:{enabled:D}}}),Nr=o.createContext(null),mn="button",Dr="Draggable";function Cr(e){let{id:t,data:s,disabled:r=!1,attributes:a}=e;const l=ct(Dr),{activators:c,activatorEvent:d,active:u,activeNodeRect:h,ariaDescribedById:m,draggableNodes:f,over:w}=o.useContext(Et),{role:b=mn,roleDescription:E="draggable",tabIndex:p=0}=a??{},N=(u==null?void 0:u.id)===t,R=o.useContext(N?Ln:Nr),[S,M]=wt(),[k,L]=wt(),j=or(c,t),I=st(s);Ce(()=>(f.set(t,{id:t,key:l,node:S,activatorNode:k,data:I}),()=>{const W=f.get(t);W&&W.key===l&&f.delete(t)}),[f,t]);const C=o.useMemo(()=>({role:b,tabIndex:p,"aria-disabled":r,"aria-pressed":N&&b===mn?!0:void 0,"aria-roledescription":E,"aria-describedby":m.draggable}),[r,b,p,N,E,m.draggable]);return{active:u,activatorEvent:d,activeNodeRect:h,attributes:C,isDragging:N,listeners:r?void 0:j,node:S,over:w,setNodeRef:M,setActivatorNodeRef:L,transform:R}}function Sr(){return o.useContext(An)}const Rr="Droppable",Er={timeout:25};function Tr(e){let{data:t,disabled:s=!1,id:r,resizeObserverConfig:a}=e;const l=ct(Rr),{active:c,dispatch:d,over:u,measureDroppableContainers:h}=o.useContext(Et),m=o.useRef({disabled:s}),f=o.useRef(!1),w=o.useRef(null),b=o.useRef(null),{disabled:E,updateMeasurementsFor:p,timeout:N}={...Er,...a},R=st(p??r),S=o.useCallback(()=>{if(!f.current){f.current=!0;return}b.current!=null&&clearTimeout(b.current),b.current=setTimeout(()=>{h(Array.isArray(R.current)?R.current:[R.current]),b.current=null},N)},[N]),M=Rt({callback:S,disabled:E||!c}),k=o.useCallback((C,W)=>{M&&(W&&(M.unobserve(W),f.current=!1),C&&M.observe(C))},[M]),[L,j]=wt(k),I=st(t);return o.useEffect(()=>{!M||!L.current||(M.disconnect(),f.current=!1,M.observe(L.current))},[L,M]),o.useEffect(()=>(d({type:G.RegisterDroppable,element:{id:r,key:l,disabled:s,node:L,rect:w,data:I}}),()=>d({type:G.UnregisterDroppable,key:l,id:r})),[r]),o.useEffect(()=>{s!==m.current.disabled&&(d({type:G.SetDroppableDisabled,id:r,key:l,disabled:s}),m.current.disabled=s)},[r,l,s,d]),{active:c,rect:w,isOver:(u==null?void 0:u.id)===r,node:L,over:u,setNodeRef:j}}function Qt(e,t,s){const r=e.slice();return r.splice(s<0?r.length+s:s,0,r.splice(t,1)[0]),r}function Mr(e,t){return e.reduce((s,r,a)=>{const l=t.get(r);return l&&(s[a]=l),s},Array(e.length))}function bt(e){return e!==null&&e>=0}function kr(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}function Ir(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const $n=e=>{let{rects:t,activeIndex:s,overIndex:r,index:a}=e;const l=Qt(t,r,s),c=t[a],d=l[a];return!d||!c?null:{x:d.left-c.left,y:d.top-c.top,scaleX:d.width/c.width,scaleY:d.height/c.height}},pt={scaleX:1,scaleY:1},Or=e=>{var t;let{activeIndex:s,activeNodeRect:r,index:a,rects:l,overIndex:c}=e;const d=(t=l[s])!=null?t:r;if(!d)return null;if(a===s){const h=l[c];return h?{x:0,y:s<c?h.top+h.height-(d.top+d.height):h.top-d.top,...pt}:null}const u=zr(l,a,s);return a>s&&a<=c?{x:0,y:-d.height-u,...pt}:a<s&&a>=c?{x:0,y:d.height+u,...pt}:{x:0,y:0,...pt}};function zr(e,t,s){const r=e[t],a=e[t-1],l=e[t+1];return r?s<t?a?r.top-(a.top+a.height):l?l.top-(r.top+r.height):0:l?l.top-(r.top+r.height):a?r.top-(a.top+a.height):0:0}const Fn="Sortable",Pn=ue.createContext({activeIndex:-1,containerId:Fn,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:$n,disabled:{draggable:!1,droppable:!1}});function Ar(e){let{children:t,id:s,items:r,strategy:a=$n,disabled:l=!1}=e;const{active:c,dragOverlay:d,droppableRects:u,over:h,measureDroppableContainers:m}=Sr(),f=ct(Fn,s),w=d.rect!==null,b=o.useMemo(()=>r.map(j=>typeof j=="object"&&"id"in j?j.id:j),[r]),E=c!=null,p=c?b.indexOf(c.id):-1,N=h?b.indexOf(h.id):-1,R=o.useRef(b),S=!kr(b,R.current),M=N!==-1&&p===-1||S,k=Ir(l);Ce(()=>{S&&E&&m(b)},[S,b,E,m]),o.useEffect(()=>{R.current=b},[b]);const L=o.useMemo(()=>({activeIndex:p,containerId:f,disabled:k,disableTransforms:M,items:b,overIndex:N,useDragOverlay:w,sortedRects:Mr(b,u),strategy:a}),[p,f,k.draggable,k.droppable,M,b,N,u,w,a]);return ue.createElement(Pn.Provider,{value:L},t)}const Lr=e=>{let{id:t,items:s,activeIndex:r,overIndex:a}=e;return Qt(s,r,a).indexOf(t)},$r=e=>{let{containerId:t,isSorting:s,wasDragging:r,index:a,items:l,newIndex:c,previousItems:d,previousContainerId:u,transition:h}=e;return!h||!r||d!==l&&a===c?!1:s?!0:c!==a&&t===u},Fr={duration:200,easing:"ease"},Bn="transform",Pr=at.Transition.toString({property:Bn,duration:0,easing:"linear"}),Br={roleDescription:"sortable"};function qr(e){let{disabled:t,index:s,node:r,rect:a}=e;const[l,c]=o.useState(null),d=o.useRef(s);return Ce(()=>{if(!t&&s!==d.current&&r.current){const u=a.current;if(u){const h=He(r.current,{ignoreTransform:!0}),m={x:u.left-h.left,y:u.top-h.top,scaleX:u.width/h.width,scaleY:u.height/h.height};(m.x||m.y)&&c(m)}}s!==d.current&&(d.current=s)},[t,s,r,a]),o.useEffect(()=>{l&&c(null)},[l]),l}function Ur(e){let{animateLayoutChanges:t=$r,attributes:s,disabled:r,data:a,getNewIndex:l=Lr,id:c,strategy:d,resizeObserverConfig:u,transition:h=Fr}=e;const{items:m,containerId:f,activeIndex:w,disabled:b,disableTransforms:E,sortedRects:p,overIndex:N,useDragOverlay:R,strategy:S}=o.useContext(Pn),M=Wr(r,b),k=m.indexOf(c),L=o.useMemo(()=>({sortable:{containerId:f,index:k,items:m},...a}),[f,a,k,m]),j=o.useMemo(()=>m.slice(m.indexOf(c)),[m,c]),{rect:I,node:C,isOver:W,setNodeRef:z}=Tr({id:c,data:L,disabled:M.droppable,resizeObserverConfig:{updateMeasurementsFor:j,...u}}),{active:q,activatorEvent:_,activeNodeRect:se,attributes:re,setNodeRef:$,listeners:U,isDragging:A,over:ae,setActivatorNodeRef:fe,transform:ie}=Cr({id:c,data:L,attributes:{...Br,...s},disabled:M.draggable}),Ee=is(z,$),H=!!q,me=H&&!E&&bt(w)&&bt(N),ge=!R&&A,Te=ge&&me?ie:null,xe=me?Te??(d??S)({rects:p,activeNodeRect:se,activeIndex:w,overIndex:N,index:k}):null,ee=bt(w)&&bt(N)?l({id:c,items:m,activeIndex:w,overIndex:N}):k,le=q==null?void 0:q.id,B=o.useRef({activeId:le,items:m,newIndex:ee,containerId:f}),Me=m!==B.current.items,be=t({active:q,containerId:f,isDragging:A,isSorting:H,id:c,index:k,items:m,newIndex:B.current.newIndex,previousItems:B.current.items,previousContainerId:B.current.containerId,transition:h,wasDragging:B.current.activeId!=null}),Se=qr({disabled:!be,index:k,node:C,rect:I});return o.useEffect(()=>{H&&B.current.newIndex!==ee&&(B.current.newIndex=ee),f!==B.current.containerId&&(B.current.containerId=f),m!==B.current.items&&(B.current.items=m)},[H,ee,f,m]),o.useEffect(()=>{if(le===B.current.activeId)return;if(le!=null&&B.current.activeId==null){B.current.activeId=le;return}const ke=setTimeout(()=>{B.current.activeId=le},50);return()=>clearTimeout(ke)},[le]),{active:q,activeIndex:w,attributes:re,data:L,rect:I,index:k,newIndex:ee,items:m,isOver:W,isSorting:H,isDragging:A,listeners:U,node:C,overIndex:N,over:ae,setNodeRef:Ee,setActivatorNodeRef:fe,setDroppableNodeRef:z,setDraggableNodeRef:$,transform:Se??xe,transition:ve()};function ve(){if(Se||Me&&B.current.newIndex===k)return Pr;if(!(ge&&!Vt(_)||!h)&&(H||be))return at.Transition.toString({...h,property:Bn})}}function Wr(e,t){var s,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(s=e==null?void 0:e.draggable)!=null?s:t.draggable,droppable:(r=e==null?void 0:e.droppable)!=null?r:t.droppable}}function Dt(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const Xr=[F.Down,F.Right,F.Up,F.Left],_r=(e,t)=>{let{context:{active:s,collisionRect:r,droppableRects:a,droppableContainers:l,over:c,scrollableAncestors:d}}=t;if(Xr.includes(e.code)){if(e.preventDefault(),!s||!r)return;const u=[];l.getEnabled().forEach(f=>{if(!f||f!=null&&f.disabled)return;const w=a.get(f.id);if(w)switch(e.code){case F.Down:r.top<w.top&&u.push(f);break;case F.Up:r.top>w.top&&u.push(f);break;case F.Left:r.left>w.left&&u.push(f);break;case F.Right:r.left<w.left&&u.push(f);break}});const h=Ns({active:s,collisionRect:r,droppableRects:a,droppableContainers:u,pointerCoordinates:null});let m=Dn(h,"id");if(m===(c==null?void 0:c.id)&&h.length>1&&(m=h[1].id),m!=null){const f=l.get(s.id),w=l.get(m),b=w?a.get(w.id):null,E=w==null?void 0:w.node.current;if(E&&b&&f&&w){const N=St(E).some((j,I)=>d[I]!==j),R=qn(f,w),S=Hr(f,w),M=N||!R?{x:0,y:0}:{x:S?r.width-b.width:0,y:S?r.height-b.height:0},k={x:b.left,y:b.top};return M.x&&M.y?k:rt(k,M)}}}};function qn(e,t){return!Dt(e)||!Dt(t)?!1:e.data.current.sortable.containerId===t.data.current.sortable.containerId}function Hr(e,t){return!Dt(e)||!Dt(t)||!qn(e,t)?!1:e.data.current.sortable.index<t.data.current.sortable.index}const Yr=({msg:e,index:t,onDelete:s})=>{const{attributes:r,listeners:a,setNodeRef:l,transform:c,transition:d,isDragging:u}=Ur({id:e.id||t}),h={transform:at.Transform.toString(c),transition:d,opacity:u?.5:1};return n.jsxs("div",{ref:l,style:h,className:`border rounded-lg p-3 cursor-move hover:bg-white/10 transition-all ${e.isCurrentlyTriggered?"bg-green-500/10 border-green-400/30":"bg-white/5 border-white/10"}`,...r,...a,children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:`w-6 h-6 rounded -full flex items-center justify-center text-xs text-white ${e.isCurrentlyTriggered?"bg-green-600":"bg-gray-600"}`,children:t+1}),n.jsxs(y,{size:"sm",className:`font-bold ${e.isCurrentlyTriggered?"text-green-400":"text-gray-400"}`,children:[e.source,e.isCurrentlyTriggered&&n.jsx("span",{className:"ml-1 text-xs",children:"(當前觸發)"})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:`px-2 py-1 rounded text-xs ${e.type==="custom"?"bg-purple-500/20 text-purple-400":e.type==="schedule"?"bg-blue-500/20 text-blue-400":e.type==="normal"?"bg-orange-500/20 text-orange-400":"bg-gray-500/20 text-gray-400"}`,children:e.type==="custom"?"自定義規則":e.type==="schedule"?"班表模板":e.type==="normal"?"普通對話":"其他"}),s&&n.jsx(X,{onClick:m=>{m.stopPropagation(),m.preventDefault(),s(t,e.id)},variant:"ghost",size:"sm",className:"p-1 text-red-400 hover:text-red-300",title:"刪除",children:n.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),n.jsx(y,{className:`${e.isCurrentlyTriggered?"text-green-200":"text-white"}`,children:e.message})]})},Vr=({customRules:e=[],scheduleTemplates:t=[],onRulesChange:s,onTemplatesChange:r,isSaving:a=!1,scheduleData:l=null,speechTexts:c=[],onSpeechTextsChange:d,showBubble:u=!1,onShowBubbleChange:h,intervalSeconds:m=4,onIntervalSecondsChange:f,smartMode:w=!1,onSmartModeChange:b})=>{const[E,p]=o.useState(!1),[N,R]=o.useState(null),[S,M]=o.useState("custom"),[k,L]=o.useState(!1),[j,I]=o.useState({name:"",type:"timeRange",startTime:"08:00",endTime:"10:00",day:"一",month:1,date:1,allDay:!1,messages:[""],enabled:!0}),[C,W]=o.useState(null),[z,q]=o.useState({}),[_,se]=o.useState(!1),[re,$]=o.useState(!1),[U,A]=o.useState(new Set);o.useEffect(()=>{l?W(l):(async()=>{try{se(!0);const g=await Qe(De(ye,"schedule","currentMonth")),x=await Qe(De(ye,"schedule","nextMonth"));let v=null;g.exists()?v=g.data():x.exists()&&(v=x.data()),W(v)}catch(g){console.error("載入班表資料失敗:",g)}finally{se(!1)}})()},[l]),o.useEffect(()=>{(async()=>{try{$(!0);const g=await _n(Hn(ye,"names")),x={};g.forEach(v=>{const O=v.data();O.name&&(x[v.id]=O.name)}),q(x)}catch(g){console.error("載入同事姓名資料失敗:",g)}finally{$(!1)}})()},[]),o.useEffect(()=>{(async()=>{try{const g=await Qe(De(ye,"catSpeech","dialogueOrder"));if(g.exists()){const v=g.data();if(v.dialogues&&Array.isArray(v.dialogues)){xe(v.dialogues),Me(v.lastUpdated?new Date(v.lastUpdated).toLocaleString():"未知");return}}const x=localStorage.getItem("dialogueOrder");if(x){const v=JSON.parse(x);xe(v)}}catch(g){console.error("載入對話排序失敗:",g);try{const x=localStorage.getItem("dialogueOrder");if(x){const v=JSON.parse(x);xe(v)}}catch(x){console.error("本地備份載入也失敗:",x)}}})()},[]);const ae=o.useMemo(()=>{const i=Je(C,e,t,z),g=[];i.forEach((D,T)=>{g.push({...D,id:D.id||`${D.type}-${D.message.substring(0,10)}`,priority:3,isCurrentlyTriggered:!0})}),c.filter(D=>D.trim()!=="").forEach((D,T)=>{g.push({id:`normal-${D}`,type:"normal",priority:999,message:D,source:"普通對話",isNormal:!0,isCurrentlyTriggered:!1})});const v=[],O=new Set;return g.forEach(D=>{!O.has(D.id)&&!U.has(D.id)&&(O.add(D.id),v.push(D))}),v},[e,t,C,z,c,U]);o.useEffect(()=>{ae.length>0&&xe(i=>{if(i.length===0)return ae;const g=new Set(i.map(D=>D.id)),x=new Set(ae.map(D=>D.id)),v=i.filter(D=>!U.has(D.id)&&x.has(D.id)),O=ae.filter(D=>!g.has(D.id));return[...v,...O]})},[ae,U]);const fe=i=>{if(!i||typeof i!="object")return[];const g=[],x=new Date,v=x.getFullYear(),O=x.getMonth()+1,D=x.getDate();for(const[T,J]of Object.entries(i))if(T!=="_lastUpdated"&&J&&typeof J=="object"){for(const[te,K]of Object.entries(J))if(K&&K.trim()&&K!=="休假"&&K!=="特休"&&K!=="月休"){const ce=parseInt(te);ce===D&&g.push({id:`${T}_${ce}`,date:`${v}-${String(O).padStart(2,"0")}-${String(ce).padStart(2,"0")}`,shift:K,employee:T})}}return g},[ie,Ee]=o.useState({name:"",message:"",enabled:!0,timeRestriction:!1,startTime:"08:00",endTime:"10:00"}),[H,me]=o.useState(null),[ge,Te]=o.useState(""),[Q,xe]=o.useState([]),[ee,le]=o.useState(""),[B,Me]=o.useState(""),be=ys(tn(Zt),tn(Gt,{coordinateGetter:_r})),Se=async()=>{if(ge.trim()&&d){const i=[...c,ge.trim()];try{await d(i),Te("")}catch(g){console.error("添加對話失敗:",g)}}},ve=async i=>{if(d){const g=c.filter((x,v)=>v!==i);try{await d(g)}catch(x){console.error("刪除對話失敗:",x)}}},ke=i=>{const{active:g,over:x}=i;g.id!==x.id&&xe(v=>{const O=v.findIndex(T=>T.id===g.id),D=v.findIndex(T=>T.id===x.id);return Qt(v,O,D)})},Ie=(i,g)=>{!g&&Q[i]&&(g=Q[i].id),g&&(A(x=>new Set([...x,g])),xe(x=>x.filter((v,O)=>O!==i)))},dt=async()=>{try{le("保存中...");const i={dialogues:Q,lastUpdated:new Date().toISOString(),version:"1.0"};await Xt(De(ye,"catSpeech","dialogueOrder"),i),localStorage.setItem("dialogueOrder",JSON.stringify(Q)),le("保存成功！"),Me(new Date().toLocaleString()),setTimeout(()=>{le("")},3e3)}catch(i){le("保存失敗"),console.error("保存對話排序失敗:",i),setTimeout(()=>{le("")},3e3)}},ut=()=>{A(new Set);const i=Je(C,e,t,z),g=i.map(T=>T.message).filter(T=>T&&typeof T=="string"&&T.trim()!==""),x=c.filter(T=>T&&typeof T=="string"&&T.trim()!==""&&!g.includes(T)),v=[...i.map(T=>({...T,id:`smart-${T.source}-${T.message.substring(0,10)}`,isNormal:!1})),...x.map(T=>({id:`normal-${T.substring(0,10)}`,type:"normal",priority:999,message:T,source:"普通對話",isNormal:!0}))],O=[],D=new Set;for(const T of v)D.has(T.message)||(O.push(T),D.add(T.message));xe(O)},Be=()=>{Ee({name:"",message:"",enabled:!0,timeRestriction:!1,startTime:"08:00",endTime:"10:00"}),me(null),p(!1)},oe=(i,g)=>{Ee(x=>({...x,[i]:g}))},qe=(i,g)=>{const x=new Date,v=x.getHours(),O=x.getMinutes(),D=v*60+O,[T,J]=i.split(":").map(Number),[te,K]=g.split(":").map(Number),ce=T*60+J,Y=te*60+K;return Y<ce?D>=ce||D<=Y:D>=ce&&D<=Y},Fe=()=>{I({name:"",type:"timeRange",startTime:"08:00",endTime:"10:00",day:"一",month:1,date:1,allDay:!1,messages:[""],enabled:!0}),R(null),p(!1)},V=(i,g)=>{I(x=>({...x,[i]:g}))},ht=(i,g)=>{const x=[...j.messages];x[i]=g,I(v=>({...v,messages:x}))},Tt=()=>{I(i=>({...i,messages:[...i.messages,""]}))},Mt=i=>{if(j.messages.length>1){const g=j.messages.filter((x,v)=>v!==i);I(x=>({...x,messages:g}))}},Oe=()=>{if(!j.name.trim()){alert("請填寫規則名稱");return}const i=j.messages.filter(v=>v&&typeof v=="string"&&v.trim()!=="");if(i.length===0){alert("請至少添加一個對話內容");return}const g={id:N?N.id:Date.now().toString(),...j,messages:i};if(!Yn(g)){alert("規則設定有誤，請檢查時間格式");return}let x;N?x=e.map(v=>v.id===N.id?g:v):x=[...e,g],s(x),Fe()},ze=i=>{if(window.confirm("確定要刪除這個規則嗎？")){const g=e.filter(x=>x.id!==i);s(g)}},Pe=i=>{const g=e.map(x=>x.id===i?{...x,enabled:!x.enabled}:x);s(g)},ft=i=>{I({name:i.name,type:i.type,startTime:i.startTime||"08:00",endTime:i.endTime||"10:00",day:i.day||"一",month:i.month||1,date:i.date||1,allDay:i.allDay||!1,messages:i.messages||[""],enabled:i.enabled}),R(i),p(!0)},je=()=>{window.confirm("確定要載入預設規則嗎？這會覆蓋現有的自定義規則。")&&s(Vn())},mt=()=>{if(!ie.name.trim()){alert("請填寫模板名稱");return}if(!ie.message.trim()){alert("請填寫問候語內容");return}const i={id:H?H.id:Date.now().toString(),...ie};if(!Kn(i)){alert("模板設定有誤，請檢查內容");return}let g;H?g=t.map(x=>x.id===H.id?i:x):g=[...t,i],r(g),Be()},kt=i=>{if(window.confirm("確定要刪除這個模板嗎？")){const g=t.filter(x=>x.id!==i);r(g)}},It=i=>{const g=t.map(x=>x.id===i?{...x,enabled:!x.enabled}:x);r(g)},Ye=i=>{Ee({name:i.name,message:i.message,enabled:i.enabled,timeRestriction:i.timeRestriction||!1,startTime:i.startTime||"08:00",endTime:i.endTime||"10:00"}),me(i),p(!0)},gt=()=>{const i=Gn();r(i)},Ot=()=>{if(_){alert("請稍候，正在載入班表資料...");return}if(re){alert("請稍候，正在載入姓名資料...");return}if(!C){alert("無班表資料，無法預覽所有智能對話。");return}Object.keys(z).length===0&&alert("無姓名資料，將顯示職員編號。");const i=Je(C,e,t,z),g=i.map((x,v)=>`${v+1}. [${x.source}] ${x.message}`).join(`

`);i.length===0?alert(`目前沒有觸發的智能對話。

只會播放您設定的普通對話。`):alert(`智能對話預覽 (共${i.length}條)：

${g}

注意：這些對話會與您設定的普通對話一起輪流播放。`)},xt=()=>{switch(j.type){case"timeRange":return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",id:"allDay",checked:j.allDay,onChange:i=>V("allDay",i.target.checked),disabled:a,className:"w-5 h-5 disabled:opacity-50"}),n.jsx(P,{htmlFor:"allDay",className:"!mb-0",children:"全天（24小時）"})]}),!j.allDay&&n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx(P,{htmlFor:"startTime",required:!0,children:"開始時間"}),n.jsx(ne,{id:"startTime",type:"time",value:j.startTime,onChange:i=>V("startTime",i.target.value),disabled:a})]}),n.jsxs("div",{children:[n.jsx(P,{htmlFor:"endTime",required:!0,children:"結束時間"}),n.jsx(ne,{id:"endTime",type:"time",value:j.endTime,onChange:i=>V("endTime",i.target.value),disabled:a})]})]})]});case"dayOfWeek":return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(P,{htmlFor:"daySelect",required:!0,children:"星期幾"}),n.jsxs("select",{id:"daySelect",value:j.day,onChange:i=>V("day",i.target.value),disabled:a,className:"w-full p-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary/50 disabled:opacity-50",children:[n.jsx("option",{value:"一",children:"星期一"}),n.jsx("option",{value:"二",children:"星期二"}),n.jsx("option",{value:"三",children:"星期三"}),n.jsx("option",{value:"四",children:"星期四"}),n.jsx("option",{value:"五",children:"星期五"}),n.jsx("option",{value:"六",children:"星期六"}),n.jsx("option",{value:"日",children:"星期日"})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",id:"allDay",checked:j.allDay,onChange:i=>V("allDay",i.target.checked),disabled:a,className:"w-5 h-5 disabled:opacity-50"}),n.jsx(P,{htmlFor:"allDay",className:"!mb-0",children:"全天（24小時）"})]}),!j.allDay&&n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx(P,{htmlFor:"startTime",required:!0,children:"開始時間"}),n.jsx(ne,{id:"startTime",type:"time",value:j.startTime,onChange:i=>V("startTime",i.target.value),disabled:a})]}),n.jsxs("div",{children:[n.jsx(P,{htmlFor:"endTime",required:!0,children:"結束時間"}),n.jsx(ne,{id:"endTime",type:"time",value:j.endTime,onChange:i=>V("endTime",i.target.value),disabled:a})]})]})]});case"specificDate":return n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx(P,{htmlFor:"month",required:!0,children:"月份"}),n.jsx(ne,{id:"month",type:"number",min:"1",max:"12",value:j.month||"",onChange:i=>{const g=i.target.value,x=g===""?1:parseInt(g);V("month",isNaN(x)?1:x)},disabled:a})]}),n.jsxs("div",{children:[n.jsx(P,{htmlFor:"date",required:!0,children:"日期"}),n.jsx(ne,{id:"date",type:"number",min:"1",max:"31",value:j.date||"",onChange:i=>{const g=i.target.value,x=g===""?1:parseInt(g);V("date",isNaN(x)?1:x)},disabled:a})]})]});case"monthlyDate":return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(P,{htmlFor:"monthlyDate",required:!0,children:"每月幾號"}),n.jsx("div",{className:"grid grid-cols-7 gap-1 bg-white/5 rounded-lg p-3 border border-white/10",children:Array.from({length:31},(i,g)=>g+1).map(i=>n.jsx("button",{type:"button",onClick:()=>V("date",i),disabled:a,className:`p-2 text-sm rounded transition-colors ${j.date===i?"bg-primary text-white":"bg-white/10 text-gray-300 hover:bg-white/20"} disabled:opacity-50`,children:i},i))})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",id:"allDay",checked:j.allDay,onChange:i=>V("allDay",i.target.checked),disabled:a,className:"w-5 h-5 disabled:opacity-50"}),n.jsx(P,{htmlFor:"allDay",className:"!mb-0",children:"全天（24小時）"})]}),!j.allDay&&n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx(P,{htmlFor:"startTime",required:!0,children:"開始時間"}),n.jsx(ne,{id:"startTime",type:"time",value:j.startTime,onChange:i=>V("startTime",i.target.value),disabled:a})]}),n.jsxs("div",{children:[n.jsx(P,{htmlFor:"endTime",required:!0,children:"結束時間"}),n.jsx(ne,{id:"endTime",type:"time",value:j.endTime,onChange:i=>V("endTime",i.target.value),disabled:a})]})]})]});default:return null}};return n.jsxs(yt,{children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx(de,{level:2,gradient:!0,children:"智能對話規則管理"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(X,{onClick:Ot,variant:"secondary",size:"sm",disabled:a||_||re,children:"預覽所有對話"}),n.jsx(X,{onClick:()=>p(!0),variant:"primary",size:"sm",disabled:a,children:"添加規則"})]})]}),n.jsxs("div",{className:"bg-orange-500/10 border border-orange-500/20 rounded-lg p-4 mb-6",children:[n.jsx(de,{level:3,className:"text-orange-400 mb-4",children:"基本設定"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",id:"bubbleToggle",checked:u,disabled:a,onChange:i=>h&&h(i.target.checked),className:"w-5 h-5 disabled:opacity-50"}),n.jsx(P,{htmlFor:"bubbleToggle",className:"!mb-0",children:"顯示對話輪播"})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",id:"smartModeToggle",checked:w,disabled:a,onChange:()=>b&&b(!w),className:"w-5 h-5 disabled:opacity-50"}),n.jsx(P,{htmlFor:"smartModeToggle",className:"!mb-0",children:"智能模式（根據自定義規則和班表問候自動顯示對話）"})]}),n.jsxs("div",{children:[n.jsxs(P,{htmlFor:"intervalSlider",children:["輪播間隔 (",m,"秒)"]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"range",id:"intervalSlider",min:"1",max:"10",value:m,disabled:a,onChange:i=>f&&f(parseInt(i.target.value)),className:"flex-1 h-2 bg-white/10 rounded-lg appearance-none cursor-pointer slider disabled:opacity-50"}),n.jsxs("span",{className:"text-white min-w-[3rem] text-center",children:[m,"s"]})]}),n.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[n.jsx("span",{children:"1秒"}),n.jsx("span",{children:"10秒"})]})]})]})]}),n.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-4 mb-6",children:[n.jsx(de,{level:3,className:"text-blue-400 mb-2",children:"資料載入狀態"}),n.jsx(y,{size:"sm",className:"text-blue-300",children:_?"載入班表中...":C?`班表資料：${Object.keys(C).filter(i=>i!=="_lastUpdated").length} 位同事`:"班表資料：未載入"}),C&&C._lastUpdated&&n.jsxs(y,{size:"sm",className:"text-blue-300 mt-1",children:["最後更新：",new Date(C._lastUpdated).toLocaleString()]}),n.jsx(y,{size:"sm",className:"text-blue-300 mt-1",children:re?"載入姓名中...":Object.keys(z).length>0?`姓名對應：${Object.keys(z).length} 位同事`:"姓名對應：未載入"})]}),n.jsxs("div",{className:"flex border-b border-white/10 mb-6",children:[n.jsxs("button",{onClick:()=>M("custom"),className:`px-4 py-2 text-sm font-medium transition-colors ${S==="custom"?"text-primary border-b-2 border-primary":"text-text-secondary hover:text-text-primary"}`,children:["自定義規則 (",e.length,")"]}),n.jsxs("button",{onClick:()=>M("schedule"),className:`px-4 py-2 text-sm font-medium transition-colors ${S==="schedule"?"text-primary border-b-2 border-primary":"text-text-secondary hover:text-text-primary"}`,children:["班表問候模板 (",t.length,")"]}),n.jsxs("button",{onClick:()=>M("dialogue"),className:`px-4 py-2 text-sm font-medium transition-colors ${S==="dialogue"?"text-primary border-b-2 border-primary":"text-text-secondary hover:text-text-primary"}`,children:["對話管理 (",c.length,")"]})]}),S==="custom"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/20 rounded-lg p-4 mb-6",children:[n.jsx(de,{level:3,className:"text-purple-400 mb-2",children:"自定義規則說明"}),n.jsx(y,{size:"sm",className:"text-purple-300",children:"可以設定特定時間範圍、星期幾或特定日期的對話規則，系統會根據條件自動顯示對話。"})]}),E&&n.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4 mb-6",children:[n.jsx(de,{level:3,className:"mb-4",children:N?"編輯規則":"添加新規則"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(P,{htmlFor:"ruleName",required:!0,children:"規則名稱"}),n.jsx(ne,{id:"ruleName",value:j.name,onChange:i=>V("name",i.target.value),placeholder:"例如：早上問候",disabled:a})]}),n.jsxs("div",{children:[n.jsx(P,{htmlFor:"ruleType",required:!0,children:"規則類型"}),n.jsxs("select",{id:"ruleType",value:j.type,onChange:i=>V("type",i.target.value),disabled:a,className:"w-full p-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary/50 disabled:opacity-50",children:[n.jsx("option",{value:"timeRange",children:"時間範圍"}),n.jsx("option",{value:"dayOfWeek",children:"星期幾"}),n.jsx("option",{value:"specificDate",children:"特定日期"}),n.jsx("option",{value:"monthlyDate",children:"每月幾號"})]})]}),xt(),n.jsxs("div",{children:[n.jsxs(P,{required:!0,children:["對話內容 (",j.messages.length,"條)"]}),n.jsxs("div",{className:"space-y-2",children:[j.messages.map((i,g)=>n.jsxs("div",{className:"flex gap-2",children:[n.jsx(ne,{value:i,onChange:x=>ht(g,x.target.value),placeholder:`對話 ${g+1}...`,disabled:a}),n.jsx(X,{onClick:()=>Mt(g),variant:"danger",size:"sm",disabled:a||j.messages.length<=1,className:"px-3",children:"刪除"})]},g)),n.jsx(X,{onClick:Tt,variant:"secondary",size:"sm",disabled:a,className:"w-full",children:"添加對話"})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",id:"ruleEnabled",checked:j.enabled,onChange:i=>V("enabled",i.target.checked),disabled:a,className:"w-5 h-5 disabled:opacity-50"}),n.jsx(P,{htmlFor:"ruleEnabled",className:"!mb-0",children:"啟用此規則"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(X,{onClick:Oe,variant:"primary",disabled:a,loading:a,children:N?"更新規則":"添加規則"}),n.jsx(X,{onClick:Fe,variant:"secondary",disabled:a,children:"取消"})]})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs(P,{children:["現有規則 (",e.length,"條)"]}),n.jsx(X,{onClick:je,variant:"secondary",size:"sm",disabled:a,children:"載入預設"})]}),e.length===0?n.jsx(y,{color:"secondary",className:"text-center py-8",children:"暫無自定義規則"}):e.map(i=>{var g,x;return n.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",checked:i.enabled,onChange:()=>Pe(i.id),disabled:a,className:"w-4 h-4 disabled:opacity-50"}),n.jsx(de,{level:4,className:"!mb-0",children:i.name}),n.jsx("span",{className:`px-2 py-1 rounded text-xs ${i.enabled?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,children:i.enabled?"啟用":"停用"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(X,{onClick:()=>ft(i),variant:"ghost",size:"sm",disabled:a,children:"編輯"}),n.jsx(X,{onClick:()=>ze(i.id),variant:"danger",size:"sm",disabled:a,children:"刪除"})]})]}),n.jsxs(y,{size:"sm",color:"secondary",className:"mb-2",children:["類型：",i.type==="timeRange"?"時間範圍":i.type==="dayOfWeek"?"星期幾":i.type==="specificDate"?"特定日期":i.type==="monthlyDate"?"每月幾號":"未知類型"]}),i.type==="timeRange"&&n.jsxs(y,{size:"sm",color:"secondary",className:"mb-2",children:["時間：",i.allDay?"全天":`${i.startTime} - ${i.endTime}`]}),i.type==="dayOfWeek"&&n.jsxs(y,{size:"sm",color:"secondary",className:"mb-2",children:["星期",i.day," ",i.allDay?"全天":`${i.startTime} - ${i.endTime}`]}),i.type==="specificDate"&&n.jsxs(y,{size:"sm",color:"secondary",className:"mb-2",children:[i.month,"月",i.date,"日"]}),i.type==="monthlyDate"&&n.jsxs(y,{size:"sm",color:"secondary",className:"mb-2",children:["每月",i.date,"日 ",i.allDay?"全天":`${i.startTime} - ${i.endTime}`]}),n.jsxs(y,{size:"sm",color:"secondary",className:"mb-2",children:["對話數量：",((g=i.messages)==null?void 0:g.length)||0," 條"]}),n.jsx("div",{className:"space-y-1",children:(x=i.messages)==null?void 0:x.map((v,O)=>n.jsx(y,{className:"bg-white/5 rounded p-2 text-sm",children:v},O))})]},i.id)})]})]}),S==="schedule"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"mb-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx(de,{level:3,className:"text-blue-400",children:"可用變數說明"}),n.jsxs(X,{onClick:()=>L(!k),variant:"secondary",size:"sm",className:"flex items-center gap-2",children:[k?"隱藏說明":"顯示說明",n.jsx("span",{className:"text-xs",children:k?"▼":"▶"})]})]}),k&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[n.jsx(y,{size:"sm",className:"text-blue-300 font-bold mb-3 text-center",children:"📋 班次變數"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","{早班同事}"," - 早班同事名字"]}),n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","{中班同事}"," - 中班同事名字"]}),n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","{晚班同事}"," - 晚班同事名字"]}),n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","{所有同事}"," - 所有上班同事名字"]})]}),n.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[n.jsx(y,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"💡 使用範例："}),n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","{早班同事}，早安！"," → 小明、小華，早安！"]}),n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","{所有同事}，工作辛苦了！"," → 小明、小華、小美，工作辛苦了！"]})]})]}),n.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[n.jsx(y,{size:"sm",className:"text-blue-300 font-bold mb-3 text-center",children:"👥 人數變數"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","{早班人數}"," - 早班人數"]}),n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","{中班人數}"," - 中班人數"]}),n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","{晚班人數}"," - 晚班人數"]}),n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","{總人數}"," - 總上班人數"]})]}),n.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[n.jsx(y,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"💡 使用範例："}),n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","今天有{總人數}位同事上班"," → 今天有5位同事上班"]}),n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","早班{早班人數}人，晚班{晚班人數}人"," → 早班2人，晚班3人"]})]})]})]}),n.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[n.jsx(y,{size:"sm",className:"text-blue-300 font-bold mb-4 text-center",children:"⏰ 連續上班變數"}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx(y,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"🔧 基本變數"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","{連續上班同事}"," - 連續上班4-6天的同事（顯示名字+天數）"]}),n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","{連續上班同事數量}"," - 連續上班4-6天的同事數量"]})]})]}),n.jsxs("div",{children:[n.jsx(y,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"🎯 指定天數變數"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","{連續上班X天同事}"," - 指定天數的同事名字（X為數字，只顯示名字）"]}),n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","{連續上班X天同事數量}"," - 指定天數的同事數量"]})]})]})]}),n.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[n.jsx(y,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"💡 使用範例"}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","{連續上班同事}，辛苦了！"]}),n.jsx(y,{size:"sm",className:"text-gray-400 text-xs",children:"→ 小明連續上班5天、小華連續上班4天，辛苦了！"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","{連續上班6天同事}，請務必休息"]}),n.jsx(y,{size:"sm",className:"text-gray-400 text-xs",children:"→ 紅葉，請務必休息"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs(y,{size:"sm",className:"text-blue-300",children:["• ","今天有{連續上班同事數量}位同事需要關心"]}),n.jsx(y,{size:"sm",className:"text-gray-400 text-xs",children:"→ 今天有2位同事需要關心"})]})]})]}),n.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[n.jsx(y,{size:"sm",className:"text-blue-300 font-semibold mb-2",children:"⚙️ 功能說明"}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx(y,{size:"sm",className:"text-blue-300",children:"• 自動計算：從今天開始往前計算，遇到休假為止"}),n.jsx(y,{size:"sm",className:"text-blue-300",children:"• 智能顯示：沒有符合條件的同事時，模板不會顯示"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(y,{size:"sm",className:"text-blue-300",children:"• 適用場景：關心同事、提醒休息、表揚勤奮"}),n.jsx(y,{size:"sm",className:"text-blue-300",children:"• 注意事項：需要先在姓名管理中設定同事姓名對應"})]})]})]})]}),n.jsx("div",{className:"flex justify-center",children:n.jsx(X,{onClick:()=>p(!0),variant:"primary",size:"sm",disabled:a,children:"添加規則"})})]})]}),E&&n.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4 mb-6",children:[n.jsx(de,{level:3,className:"mb-4",children:H?"編輯模板":"添加新模板"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(P,{htmlFor:"templateName",required:!0,children:"模板名稱"}),n.jsx(ne,{id:"templateName",value:ie.name,onChange:i=>oe("name",i.target.value),placeholder:"例如：早班問候",disabled:a})]}),n.jsxs("div",{children:[n.jsx(P,{htmlFor:"templateMessage",required:!0,children:"問候語內容"}),n.jsx(ne,{id:"templateMessage",value:ie.message,onChange:i=>oe("message",i.target.value),placeholder:"例如：{早班同事}，早安！今天也要加油喔！",disabled:a})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",id:"templateEnabled",checked:ie.enabled,onChange:i=>oe("enabled",i.target.checked),disabled:a,className:"w-5 h-5 disabled:opacity-50"}),n.jsx(P,{htmlFor:"templateEnabled",className:"!mb-0",children:"啟用此模板"})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",id:"timeRestriction",checked:ie.timeRestriction,onChange:i=>oe("timeRestriction",i.target.checked),disabled:a,className:"w-5 h-5 disabled:opacity-50"}),n.jsx(P,{htmlFor:"timeRestriction",className:"!mb-0",children:"啟用時間限制"})]}),ie.timeRestriction&&n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx(P,{htmlFor:"startTime",required:!0,children:"限制開始時間"}),n.jsx(ne,{id:"startTime",type:"time",value:ie.startTime,onChange:i=>oe("startTime",i.target.value),disabled:a})]}),n.jsxs("div",{children:[n.jsx(P,{htmlFor:"endTime",required:!0,children:"限制結束時間"}),n.jsx(ne,{id:"endTime",type:"time",value:ie.endTime,onChange:i=>oe("endTime",i.target.value),disabled:a})]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(X,{onClick:mt,variant:"primary",disabled:a,loading:a,children:H?"更新模板":"添加模板"}),n.jsx(X,{onClick:Be,variant:"secondary",disabled:a,children:"取消"})]})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs(P,{children:["現有模板 (",t.length,"條)"]}),n.jsx(X,{onClick:gt,variant:"secondary",size:"sm",disabled:a,children:"載入預設"})]}),t.length===0?n.jsx(y,{color:"secondary",className:"text-center py-8",children:"暫無班表問候模板"}):t.map(i=>n.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",checked:i.enabled,onChange:()=>It(i.id),disabled:a,className:"w-4 h-4 disabled:opacity-50"}),n.jsx(de,{level:4,className:"!mb-0",children:i.name}),n.jsx("span",{className:`px-2 py-1 rounded text-xs ${i.enabled?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,children:i.enabled?"啟用":"停用"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(X,{onClick:()=>Ye(i),variant:"ghost",size:"sm",disabled:a,children:"編輯"}),n.jsx(X,{onClick:()=>kt(i.id),variant:"danger",size:"sm",disabled:a,children:"刪除"})]})]}),n.jsxs(y,{size:"sm",color:"secondary",className:"mb-2",children:["原始模板：",i.message]}),i.timeRestriction&&n.jsxs(y,{size:"sm",color:"secondary",className:"mb-2",children:["時間限制：",i.startTime," - ",i.endTime]})]},i.id))]})]}),S==="dialogue"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"space-y-4 mb-6",children:[n.jsx(P,{htmlFor:"newMessage",children:"添加新對話"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(ne,{id:"newMessage",type:"text",value:ge,onChange:i=>Te(i.target.value),disabled:a,placeholder:"輸入新對話內容...",onKeyPress:i=>i.key==="Enter"&&!a&&Se()}),n.jsx(X,{onClick:()=>Se(),disabled:a||!ge.trim(),loading:a,children:a?"添加中...":"添加"})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs(P,{children:["對話列表 (",c.length,"條)"]}),n.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2 border border-white/10 rounded-lg p-3",children:c.length===0?n.jsx(y,{color:"secondary",className:"text-center py-4",children:"暫無對話內容"}):c.map((i,g)=>n.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-lg",children:[n.jsx(y,{className:"flex-1",children:i}),n.jsx(X,{onClick:()=>ve(g),variant:"ghost",size:"sm",disabled:a,className:"p-1 text-red-400 hover:text-red-300",title:"刪除",children:n.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},g))})]})]}),n.jsxs("div",{className:"mt-8 bg-gradient-to-r from-purple-500/10 to-blue-500/10 border border-purple-500/20 rounded-lg p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx(de,{level:3,className:"text-purple-400",children:"當前激活對話列表"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(X,{onClick:dt,variant:"ghost",size:"sm",disabled:ee==="保存中...",className:"px-3 py-1 text-green-400 hover:text-green-300 border border-green-400/30 hover:border-green-400/50",children:ee==="保存中..."?"保存中...":"保存排序"}),n.jsx(X,{onClick:ut,variant:"ghost",size:"sm",className:"px-3 py-1 text-blue-400 hover:text-blue-300 border border-blue-400/30 hover:border-blue-400/50",children:"重置排序"})]})]}),n.jsxs("div",{className:"mb-4 p-3 bg-blue-500/10 border border-blue-400/20 rounded-lg",children:[n.jsx(y,{size:"sm",className:"text-blue-300 text-center",children:"💡 拖拽對話項目可以調整顯示順序"}),B&&n.jsxs(y,{size:"sm",className:"text-gray-400 text-center mt-1",children:["最後更新：",B]})]}),ee&&n.jsx("div",{className:`mb-4 p-3 rounded-lg border ${ee==="保存成功！"?"bg-green-500/10 border-green-400/20":ee==="保存失敗"?"bg-red-500/10 border-red-400/20":"bg-yellow-500/10 border-yellow-400/20"}`,children:n.jsx(y,{size:"sm",className:`text-center ${ee==="保存成功！"?"text-green-300":ee==="保存失敗"?"text-red-300":"text-yellow-300"}`,children:ee})}),n.jsx("div",{className:"space-y-3",children:(()=>{if(ae.length===0)return n.jsx(y,{size:"sm",className:"text-gray-400 text-center py-4",children:"目前沒有任何對話"});let i=ae;return n.jsx(jr,{sensors:be,collisionDetection:js,onDragEnd:ke,children:n.jsx(Ar,{items:i.map(g=>g.id),strategy:Or,children:n.jsx("div",{className:"space-y-3",children:i.map((g,x)=>n.jsx(Yr,{msg:g,index:x,onDelete:Ie},g.id))})})})})()}),n.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10",children:[n.jsx(y,{size:"sm",className:"text-blue-300 font-bold mb-2",children:"詳細調試資訊："}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-xs text-gray-400",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{children:["班表資料：",C?"已載入":"未載入"]}),n.jsxs("div",{children:["姓名資料：",Object.keys(z).length>0?`已載入 ${Object.keys(z).length} 個`:"未載入"]}),n.jsxs("div",{children:["今天上班同事：",C?fe(C).length:0," 人"]}),n.jsxs("div",{children:["自定義規則：",e.filter(i=>i.enabled).length," 個啟用"]}),n.jsxs("div",{children:["班表模板：",t.filter(i=>i.enabled).length," 個啟用"]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{children:["智能對話：",Je(C,e,t,z).length," 條"]}),n.jsxs("div",{children:["普通對話：",c.length," 條"]}),n.jsxs("div",{children:["總對話數：",Je(C,e,t,z).length+c.length," 條"]}),n.jsxs("div",{children:["當前時間：",new Date().toLocaleString()]}),n.jsxs("div",{children:["星期：",new Date().toLocaleDateString("zh-TW",{weekday:"long"})]})]})]}),n.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10",children:[n.jsx(y,{size:"sm",className:"text-blue-300 font-bold mb-2",children:"連續上班天數："}),n.jsx("div",{className:"space-y-1 text-xs text-gray-400",children:(()=>{const i=Un(C,z,1,30);if(i.length===0)return n.jsx("div",{className:"text-gray-500",children:"無連續上班同事"});const g={};return i.forEach(x=>{g[x.consecutiveDays]||(g[x.consecutiveDays]=[]),g[x.consecutiveDays].push(x.name)}),Object.entries(g).sort(([x],[v])=>parseInt(v)-parseInt(x)).map(([x,v])=>{const O=parseInt(x);let D="text-gray-300";return O>=6?D="text-red-400":O>=4&&(D="text-yellow-400"),n.jsxs("div",{className:"bg-white/5 rounded p-2 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsxs("span",{className:`font-semibold ${D}`,children:[x,"天："]}),n.jsx("span",{className:"text-gray-300 ml-1",children:v.join("、")})]}),O>=4&&n.jsx("span",{className:`text-xs px-2 py-1 rounded ${O>=6?"bg-red-500/20 text-red-300":"bg-yellow-500/20 text-yellow-300"}`,children:O>=6?"高風險":"注意"})]},x)})})()})]}),t.filter(i=>i.enabled).length>0&&n.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10",children:[n.jsx(y,{size:"sm",className:"text-blue-300 font-bold mb-2",children:"班表模板調試："}),n.jsx("div",{className:"space-y-1 text-xs text-gray-400",children:t.filter(i=>i.enabled).map((i,g)=>{const x=fe(C),v=Wn(x,z),O=i.timeRestriction?qe(i.startTime,i.endTime):!0,D=Xn(i,C,z),T=D&&typeof D=="string"&&D.trim()!=="";return n.jsxs("div",{className:"bg-white/5 rounded p-2",children:[n.jsxs("div",{children:["模板：",i.name]}),n.jsxs("div",{children:["時間限制：",i.timeRestriction?`${i.startTime}-${i.endTime}`:"無"]}),n.jsxs("div",{children:["時間檢查：",O?"通過":"不通過"]}),n.jsxs("div",{children:["會顯示：",T?"是":"否"]}),T&&n.jsxs("div",{children:["處理後：",D]}),n.jsxs("div",{children:["早班同事：",v.morning.join("、")||"無"]}),n.jsxs("div",{children:["中班同事：",v.afternoon.join("、")||"無"]}),n.jsxs("div",{children:["晚班同事：",v.evening.join("、")||"無"]})]},g)})})]})]})]})]})},Kr=({showBubble:e,onShowBubbleChange:t,speechTexts:s,onSpeechTextsChange:r,intervalSeconds:a,onIntervalSecondsChange:l,smartMode:c,onSmartModeChange:d,customRules:u,onCustomRulesChange:h,scheduleTemplates:m,onScheduleTemplatesChange:f,scheduleData:w,isSaving:b})=>n.jsx("div",{className:"space-y-6",children:n.jsx(Vr,{customRules:u,scheduleTemplates:m,onRulesChange:h,onTemplatesChange:f,isSaving:b,scheduleData:w,speechTexts:s,onSpeechTextsChange:r,showBubble:e,onShowBubbleChange:t,intervalSeconds:a,onIntervalSecondsChange:l,smartMode:c,onSmartModeChange:d})}),Gr=()=>{const[e,t]=o.useState(!1),[s,r]=o.useState(!1),[a,l]=o.useState(!0),[c,d]=o.useState(!1),[u,h]=o.useState(""),[m,f]=o.useState("");o.useEffect(()=>gn(De(ye,"nowPlayingMarquee","global"),N=>{if(N.exists()){const R=N.data();t(R.enabled||!1),r(R.showOnlyNowPlaying||!1)}else t(!1),r(!1);l(!1),h("")},N=>{console.error("載入跑馬燈設定失敗:",N),h("載入設定失敗"),l(!1)}),[]);const w=async p=>{var N;try{d(!0),h(""),f("");const R={enabled:e,showOnlyNowPlaying:s,...p};await Xt(De(ye,"nowPlayingMarquee","global"),{...R,lastUpdated:xn(),updatedBy:(N=Ue.currentUser)==null?void 0:N.uid}),f("設定已更新"),setTimeout(()=>f(""),3e3)}catch(R){console.error("更新設定失敗:",R),h("更新設定失敗")}finally{d(!1)}},b=async p=>{t(p),await w({enabled:p})},E=async p=>{r(p),await w({showOnlyNowPlaying:p})};return a?n.jsx("div",{className:"flex items-center justify-center py-8",children:n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):n.jsxs("div",{className:"space-y-6",children:[m&&n.jsx("div",{className:"bg-green-500/10 border border-green-500/30 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"text-green-400",children:"✓"}),n.jsx(y,{color:"success",children:m})]})}),u&&n.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"text-red-400",children:"✗"}),n.jsx(y,{color:"danger",children:u})]})}),n.jsx(yt,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(de,{level:3,className:"mb-2",children:"跑馬燈總開關"}),n.jsx(y,{size:"sm",color:"secondary",className:"mb-4",children:"控制是否啟用跑馬燈功能"})]}),n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:e,onChange:p=>b(p.target.checked),disabled:c,className:"w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary"}),n.jsx(y,{children:"啟用跑馬燈顯示"})]})]})}),n.jsx(yt,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(de,{level:3,className:"mb-2",children:"播歌顯示開關"}),n.jsx(y,{size:"sm",color:"secondary",className:"mb-4",children:"控制是否在跑馬燈中顯示音樂播放資訊"})]}),n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:s,onChange:p=>E(p.target.checked),disabled:c||!e,className:"w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary"}),n.jsx(y,{children:"顯示音樂播放資訊"})]})]})})]})},Jr=({onLoginSuccess:e,onLoginError:t})=>{const[s,r]=o.useState(""),[a,l]=o.useState(""),[c,d]=o.useState(!1),[u,h]=o.useState(!1),[m,f]=o.useState(""),w=async b=>{if(b.preventDefault(),!s.trim()||!a.trim()){f("請輸入信箱和密碼");return}try{h(!0),f("");const E=await Jn(Ue,s.trim(),a);if(!await bn(E.user.uid)){const{signOut:N}=await pn(async()=>{const{signOut:R}=await import("./index.BdHW5VF-.js").then(S=>S.bF);return{signOut:R}},__vite__mapDeps([0,1]));await N(Ue),f("此帳號沒有管理員權限"),t&&t("此帳號沒有管理員權限");return}r(""),l(""),e&&e(E.user)}catch(E){console.error("登入失敗:",E);let p="登入失敗";switch(E.code){case"auth/user-not-found":p="找不到此帳號";break;case"auth/wrong-password":p="密碼錯誤";break;case"auth/invalid-email":p="信箱格式錯誤";break;case"auth/too-many-requests":p="登入次數過多，請稍後再試";break;case"auth/network-request-failed":p="網路連線失敗，請檢查網路連線";break;default:p="登入失敗："+(E.message||"未知錯誤")}f(p),t&&t(p)}finally{h(!1)}};return n.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:n.jsxs(yt,{className:"w-full max-w-md",children:[n.jsxs("div",{className:"text-center mb-6",children:[n.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary/20 mb-4",children:n.jsx(rs,{className:"w-8 h-8 text-primary"})}),n.jsx(de,{level:1,gradient:!0,className:"mb-2",children:"管理員登入"}),n.jsx(y,{size:"sm",color:"secondary",children:"請使用管理員帳號登入以存取管理設定"})]}),m&&n.jsx("div",{className:"mb-4 bg-red-500/10 border border-red-500/30 rounded-lg p-3",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"text-red-400",children:"✗"}),n.jsx(y,{color:"danger",size:"sm",children:m})]})}),n.jsxs("form",{onSubmit:w,className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(P,{htmlFor:"email",required:!0,children:"管理員信箱"}),n.jsx(ne,{id:"email",type:"email",value:s,onChange:b=>r(b.target.value),placeholder:"admin@example.com",disabled:u,autoFocus:!0,autoComplete:"email"})]}),n.jsxs("div",{children:[n.jsx(P,{htmlFor:"password",required:!0,children:"密碼"}),n.jsxs("div",{className:"relative",children:[n.jsx(ne,{id:"password",type:c?"text":"password",value:a,onChange:b=>l(b.target.value),placeholder:"請輸入密碼",disabled:u,autoComplete:"current-password",className:"pr-10"}),n.jsx("button",{type:"button",onClick:()=>d(!c),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-secondary hover:text-text-primary transition-colors",disabled:u,children:c?n.jsx(es,{className:"w-5 h-5"}):n.jsx(ns,{className:"w-5 h-5"})})]})]}),n.jsx(X,{type:"submit",variant:"primary",size:"lg",className:"w-full",disabled:u||!s.trim()||!a.trim(),loading:u,children:u?"登入中...":"登入"})]}),n.jsx("div",{className:"mt-6 pt-6 border-t border-white/10",children:n.jsxs(y,{size:"xs",color:"secondary",className:"text-center",children:["提示：您也可以使用快捷鍵 ",n.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-xs",children:"Ctrl + Alt + A"})," 在任何頁面開啟登入"]})})]})})},Qr=()=>{const[e,t]=o.useState(!1),[s,r]=o.useState([]),[a,l]=o.useState(4),[c,d]=o.useState(!1),[u,h]=o.useState(!0),[m,f]=o.useState(!1),[w,b]=o.useState(""),[E,p]=o.useState(""),[N,R]=o.useState(null),[S,M]=o.useState(!1),[k,L]=o.useState([]),[j,I]=o.useState([]),[C,W]=o.useState("catBubble"),z=Zn();o.useEffect(()=>Ue.onAuthStateChanged(async U=>{if(U)try{const A=await bn(U.uid);d(A),A?b(""):(b("您沒有管理員權限"),setTimeout(()=>z("/"),3e3))}catch(A){b("檢查權限時發生錯誤"),console.error("權限檢查失敗:",A)}else d(!1),b("");h(!1)}),[z]),o.useEffect(()=>{c&&(async()=>{try{console.log("AdminPanel: 開始載入班表資料...");const U=await Qe(De(ye,"schedule","currentMonth")),A=await Qe(De(ye,"schedule","nextMonth"));console.log("AdminPanel: currentMonthDoc.exists():",U.exists()),console.log("AdminPanel: nextMonthDoc.exists():",A.exists());let ae=null;U.exists()?ae=U.data():A.exists()&&(ae=A.data()),R(ae)}catch{}})()},[c]),o.useEffect(()=>c?gn(De(ye,"catSpeech","global"),U=>{if(U.exists()){const A=U.data();t(A.enabled||!1),r(A.texts||[]),l(A.intervalSeconds||4),M(A.smartMode||!1),L(A.customRules||[]),I(A.scheduleTemplates||[])}},U=>{console.error("監聽設定失敗:",U),b("載入設定失敗")}):void 0,[c]);const q=async()=>{try{h(!0);const{signOut:$}=await pn(async()=>{const{signOut:U}=await import("./index.BdHW5VF-.js").then(A=>A.bF);return{signOut:U}},__vite__mapDeps([0,1]));await $(Ue),z("/")}catch($){console.error("登出失敗:",$),b("登出失敗"),h(!1)}},_=async $=>{var U;if(c)try{f(!0),b(""),p(""),await Xt(De(ye,"catSpeech","global"),{...$,lastUpdated:xn(),updatedBy:(U=Ue.currentUser)==null?void 0:U.uid}),p("設定已更新"),setTimeout(()=>p(""),3e3)}catch(A){console.error("更新設定失敗:",A),b("更新設定失敗")}finally{f(!1)}},se=async $=>{L($),await _({texts:s,enabled:e,intervalSeconds:a,smartMode:S,customRules:$,scheduleTemplates:j})},re=async $=>{I($),await _({texts:s,enabled:e,intervalSeconds:a,smartMode:S,customRules:k,scheduleTemplates:$})};return u?n.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),n.jsx(y,{size:"lg",className:"mb-2",children:"載入中..."}),n.jsx(y,{size:"sm",color:"secondary",children:"正在檢查管理員權限"})]})}):c?n.jsx("div",{className:"min-h-screen bg-background",children:n.jsxs(as,{children:[n.jsx("div",{className:"text-center mb-8",children:n.jsx(de,{level:1,gradient:!0,className:"mb-2",children:"管理員設定"})}),E&&n.jsx("div",{className:"mb-6 bg-green-500/10 border border-green-500/30 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"text-green-400",children:"✓"}),n.jsx(y,{color:"success",children:E})]})}),n.jsx("div",{className:"flex justify-end mb-6",children:n.jsx(X,{onClick:q,variant:"danger",disabled:u,loading:u,children:u?"登出中...":"登出管理員"})}),n.jsxs("div",{className:"flex border-b border-white/10 mb-6",children:[n.jsx("button",{onClick:()=>W("catBubble"),className:`px-6 py-3 text-sm font-medium transition-colors ${C==="catBubble"?"text-primary border-b-2 border-primary":"text-text-secondary hover:text-text-primary"}`,children:"貓咪對話設定"}),n.jsx("button",{onClick:()=>W("marquee"),className:`px-6 py-3 text-sm font-medium transition-colors ${C==="marquee"?"text-primary border-b-2 border-primary":"text-text-secondary hover:text-text-primary"}`,children:"跑馬燈設定"})]}),C==="catBubble"&&n.jsx(Kr,{showBubble:e,onShowBubbleChange:$=>_({texts:s,enabled:$,intervalSeconds:a,smartMode:S,customRules:k,scheduleTemplates:j}),speechTexts:s,onSpeechTextsChange:$=>_({texts:$,enabled:e,intervalSeconds:a,smartMode:S,customRules:k,scheduleTemplates:j}),intervalSeconds:a,onIntervalSecondsChange:$=>_({texts:s,enabled:e,intervalSeconds:$,smartMode:S,customRules:k,scheduleTemplates:j}),smartMode:S,onSmartModeChange:$=>_({texts:s,enabled:e,intervalSeconds:a,smartMode:$,customRules:k,scheduleTemplates:j}),customRules:k,onCustomRulesChange:se,scheduleTemplates:j,onScheduleTemplatesChange:re,scheduleData:N,isSaving:m}),C==="marquee"&&n.jsx(Gr,{})]})}):n.jsx(Jr,{onLoginSuccess:$=>{console.log("登入成功:",$.email)},onLoginError:$=>{b($)}})};export{Qr as default};
